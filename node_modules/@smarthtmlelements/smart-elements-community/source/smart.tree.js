
/* Smart HTML Elements v4.6.0 (2019-Oct) 
Copyright (c) 2011-2019 jQWidgets. 
License: https://htmlelements.com/license/ */

Smart("smart-tree-item",class extends Smart.MenuItem{static get properties(){return{selected:{value:!1,type:"boolean"}}}ready(){Object.defineProperty(this,"hasStyleObserver",{get:function(){return!1}}),super.ready()}propertyChangedHandler(e,t,r){const l=this,o=l.menu;if("level"===e)return void(l.level=t);if("disabled"!==e&&"separator"!==e&&o){const n=o.context;switch(o.context=o,e){case"label":{const e=o.sorted&&o.autoSort;l.firstElementChild.firstElementChild.firstElementChild.innerHTML=r,e&&(o._unsortItems(o.$.mainContainer),o._applyGrouping(o.$.mainContainer)),o._state.filter&&o._applyFilter(o._state.filter);break}case"selected":l.selected=t,r?o.select(l):o.unselect(l);break;case"shortcut":{let e=l.firstElementChild.children[1];e||(e=document.createElement("div"),e.className="smart-tree-item-shortcut",l.firstElementChild.appendChild(e)),e.innerHTML=r;break}case"value":o.sort&&o.sorted&&o.autoSort&&o._refreshSorting();}o.context=n}}}),Smart("smart-tree-items-group",class extends Smart.MenuItemsGroup{static get properties(){return{selected:{value:!1,type:"boolean"}}}ready(){Object.defineProperty(this,"hasStyleObserver",{get:function(){return!1}}),super.ready()}propertyChangedHandler(e,t,r){const l=this,o=l.menu;if("level"===e)return void(l.level=t);if("disabled"!==e&&"separator"!==e&&o){const n=o.context;switch(o.context=o,e){case"expanded":{l.expanded=t,r?o.expandItem(l):o.collapseItem(l);break}case"label":{const e=o.sorted&&o.autoSort;l.firstElementChild.firstElementChild.firstElementChild.innerHTML=r,e&&(o._unsortItems(o.$.mainContainer),o._applyGrouping(o.$.mainContainer)),o._state.filter&&o._applyFilter(o._state.filter);break}case"selected":l.selected=t,r?o.select(l):o.unselect(l);break;case"value":o.sort&&o.sorted&&o.autoSort&&o._refreshSorting();}o.context=n}}}),Smart("smart-tree",class extends Smart.Menu{static get properties(){return{allowDrag:{value:!1,type:"boolean"},allowDrop:{value:!1,type:"boolean"},autoHideToggleElement:{value:!1,type:"boolean"},autoLoadState:{value:!1,type:"boolean"},autoSaveState:{value:!1,type:"boolean"},autoSort:{value:!0,type:"boolean"},displayLoadingIndicator:{value:!1,type:"boolean"},dragFeedbackFormatFunction:{value:null,type:"function?"},dragOffset:{value:[10,10],type:"array"},editable:{value:!1,type:"boolean"},filterable:{value:!1,type:"boolean"},filterInputPlaceholder:{value:"",type:"string"},filterMode:{value:"containsIgnoreCase",allowedValues:["contains","containsIgnoreCase","doesNotContain","doesNotContainIgnoreCase","equals","equalsIgnoreCase","startsWith","startsWithIgnoreCase","endsWith","endsWithIgnoreCase"],type:"string"},hasThreeStates:{value:!1,type:"boolean"},loadingIndicatorPlaceholder:{value:"Loading...",type:"string"},loadingIndicatorPosition:{value:"center",allowedValues:["bottom","center","top"],type:"string"},messages:{value:{en:{noId:"smart-tree: Saving and loading the element's state are not available if the element has no id."}},type:"object",extend:!0},scrollMode:{value:"scrollbar",allowedValues:["scrollbar","scrollButtons"],type:"string"},selectedIndexes:{value:[],type:"array"},selectionDisplayMode:{value:"row",allowedValues:["row","label"],type:"string"},selectionMode:{value:"one",allowedValues:["none","oneOrManyExtended","zeroOrMany","oneOrMany","zeroOrOne","one","checkBox","radioButton"],type:"string"},showLines:{value:!1,type:"boolean"},showRootLines:{value:!1,type:"boolean"},sort:{value:null,type:"function?"},sortDirection:{value:"asc",allowedValues:["asc","desc"],type:"string"},sorted:{value:!1,type:"boolean"},toggleElementPosition:{value:"near",allowedValues:["near","far"],type:"string"},toggleMode:{value:"dblclick",allowedValues:["click","dblclick","arrow"],type:"string"}}}static get listeners(){return{blur:"_blurHandler",focus:"_focusHandler",keydown:"_keydownHandler",mouseenter:"_mouseenterHandler",mouseleave:"_mouseleaveHandler",resize:"_checkOverflow",styleChanged:"_styleChangedHandler",transitionend:"_overriddenMenuHandler","container.click":"_overriddenMenuHandler","container.mouseout":"_overriddenMenuHandler","container.mouseover":"_overriddenMenuHandler","editInput.blur":"_editInputBlurHandler","filterInput.keydown":"_filterInputKeydownHandler","filterInput.keyup":"_filterInputKeyupHandler","mainContainer.click":"_overriddenMenuHandler","mainContainer.mouseleave":"_overriddenMenuHandler","mainContainer.mouseout":"_overriddenMenuHandler","mainContainer.mouseover":"_overriddenMenuHandler","mainContainer.swipeleft":"_mainContainerSwipeHandler","mainContainer.swiperight":"_mainContainerSwipeHandler","scrollButtonFar.click":"_scrollButtonFarClickHandler","scrollButtonNear.click":"_scrollButtonNearClickHandler","scrollViewer.down":"_scrollViewerDownHandler","scrollViewer.kineticScroll":"_scrollViewerWheelHandler","mainContainer.wheel":"_scrollViewerWheelHandler","document.move":"_moveHandler","document.up":"_documentUpHandler"}}static get requires(){return{"Smart.ScrollBar":"smart.scrollbar.js"}}static get styleUrls(){return["smart.scrollbar.css","smart.scrollviewer.css","smart.tree.css"]}template(){return`<div id="container">
                    <div class="smart-tree-filter-input-container">
                        <input id="filterInput" class="smart-filter-input" disabled="[[disabled]]" placeholder="[[filterInputPlaceholder]]" type="text" />
                    </div>
                    <smart-repeat-button id="scrollButtonNear" class="smart-tree-scroll-button smart-spin-button smart-scroll-button-near smart-hidden" animation="[[animation]]" unfocusable>
                        <div id="arrowNear" class="smart-arrow smart-arrow-up"></div>
                    </smart-repeat-button>
                    <smart-scroll-viewer id="scrollViewer" animation="[[animation]]" horizontal-scroll-bar-visibility="hidden" right-to-left="[[right-to-left]]">
                        <div id="mainContainer" class="smart-tree-main-container">
                            <content></content>
                        </div>
                        <input type="text" id="editInput" class="smart-tree-edit-input smart-hidden" />
                    </smart-scroll-viewer>
                    <smart-repeat-button id="scrollButtonFar" class="smart-tree-scroll-button smart-spin-button smart-scroll-button-far smart-hidden" animation="[[animation]]" unfocusable>
                        <div id="arrowFar" class="smart-arrow smart-arrow-down"></div>
                    </smart-repeat-button>
                    <div id="loadingIndicatorContainer" class="smart-loader-container smart-hidden">
                        <span id="loadingIndicator" class="smart-loader"></span>
                        <span id="loadingIndicatorPlaceHolder" class="smart-loader-label smart-hidden">[[loadingIndicatorPlaceholder]]</span>
                    </div>
                </div>`}addAfter(e,t){const r=this;t=r.getItem(t);void 0===t||r.addTo(e,t.parentItem,t,!0)}addBefore(e,t){const r=this;t=r.getItem(t);void 0===t||r.addTo(e,t.parentItem,t)}addTo(e,t){const r=this;if(!(e instanceof Smart.TreeItem||e instanceof Smart.TreeItemsGroup))return;let l,o;if(void 0===t)t=r.$.mainContainer,l=1,o=t;else{if(t=r.getItem(t),!1==t instanceof Smart.TreeItemsGroup)return;l=t.level+1,o=t.itemContainer}r._createItemHTMLStructure(e,l,t,o.childElementCount,0);const n=r.sorted&&r.autoSort,a=r._state.filter,s=r.selectedIndexes.slice(0);n&&r._unsortItems(r.$.mainContainer),e instanceof Smart.TreeItemsGroup&&r._processHTML(e,l+1,!1);let i=arguments[2];i&&arguments[3]&&(i=i.nextElementSibling),i?(o.insertBefore(e,i),r._menuItems={},r._refreshItemPaths(r.$.mainContainer,!0,void 0,r.sorted&&!r.autoSort)):o.appendChild(e),n&&r._applyGrouping(r.$.mainContainer),a&&r._applyFilter(a),r._checkOverflow(),r._expandItemsByDefault(),r.selectedIndexes=[],r._applySelection(!0,s)}clearSelection(){const e=this,t=e.selectedIndexes.slice(0);e.selectedIndexes=[],e._applySelection(!1,t)}collapseAll(e){const t=this,r=t.animation,l=!1===e&&t.hasAnimation;l&&(t.animation="none"),t._collapseAll(!0),l&&(t.animation=r)}ensureVisible(e){const t=this;if(e=t.getItem(e),void 0===e||e.hidden)return;let r=!1;1<e.level&&!t._isBranchExpanded(e)&&(super.expandItem(e.parentItem,void 0,!1),r=t.hasAnimation,r&&(t._ensureVisibleOnTransitionend=e)),r||t._ensureVisible(e)}expandAll(e){const t=this,r=t.animation,l=!1===e&&t.hasAnimation;let o=1,n=(t.enableShadowDOM?t.shadowRoot:t).querySelectorAll("smart-tree-items-group[level=\"1\"]");for(l&&(t.animation="none");0<n.length;){for(let e=0;e<n.length;e++){const r=n[e];r.expanded||t._menuItemsGroupSelectionHandler(r,{target:r,type:"expand"})}o++,n=(t.enableShadowDOM?t.shadowRoot:t).querySelectorAll("smart-tree-items-group[level=\""+o+"\"]")}l&&(t.animation=r)}expandItem(e,t){const r=this;if(e=r.getItem(e),!(void 0===e||!1==e instanceof Smart.TreeItemsGroup||r._isContainerOpened(e.container.level,e.container))){const l=!1===t&&r.hasAnimation,o=r.animation;l&&(r.animation="none"),r._discardKeyboardHover(),r._menuItemsGroupSelectionHandler(e,{target:e,type:"expand"},arguments[2]),l&&(r.animation=o)}}filter(e){const t=this;t.filterable&&(t._applyFilter(e),t.$.filterInput.value=e)}getState(){return JSON.parse(JSON.stringify(this._state))}insert(e,t){function r(e){const t=e[l.itemsMember]||[],o="smart-tree-items-group"===e.tagName||0<t.length?"smart-tree-items-group":"smart-tree-item",n=document.createElement(o);if(e.disabled&&(n.disabled=!0),e[l.displayMember]&&(n.label=e[l.displayMember]),e.separator&&(n.separator=!0),e[l.valueMember]&&(n.value=e[l.valueMember]),"smart-tree-items-group"==o){e.expanded&&(n.expanded=!0);for(let e=0;e<t.length;e++)n.appendChild(r(t[e]))}else e.shortcut&&(n.shortcut=e.shortcut);return n}const l=this;let o;if(e instanceof Smart.TreeItem||e instanceof Smart.TreeItemsGroup){if(l.contains(e))return;o=e}else if("object"==typeof e&&e.constructor===Object)o=r(e);else return;if(void 0===t)return void l.addTo(o);if("number"==typeof t)t=t.toString();else if(t instanceof Smart.TreeItem||t instanceof Smart.TreeItemsGroup){if(!l.contains(t))return;t=t.path}else if("string"!=typeof t)return;const n=t.split(".");let a,s;1===n.length?(s=l._menuItems[n[0]],s?l.addBefore(o,s):l.addTo(o)):(s=l._menuItems[t],a=l._menuItems[n.slice(0,n.length-1).join(".")],s?l.addBefore(o,s):a&&a instanceof Smart.TreeItemsGroup&&l.addTo(o,a))}loadState(e){const t=this,r=t.selectedIndexes.slice(0),l=[];if(!e){if(!t.id)return void t.warn(t.localize("noId"));e=window.localStorage.getItem("smartTree"+t.id)}"string"==typeof e&&(e=JSON.parse(e)),e.filter&&!t.filterable&&(e.filter="");let o=e.filter!==t._state.filter,n=e.sorted!==t.sorted;n?(t.sorted=e.sorted,t._updateState("sorted",t.sorted),e.sorted?t._applyGrouping(t.$.mainContainer):t._unsortItems(t.$.mainContainer),(e.filter||o)&&(t._applyFilter(e.filter),t.$.filterInput.value=e.filter)):o&&(t._applyFilter(e.filter),t.$.filterInput.value=e.filter),t._menuItemsGroupsToExpand=[];for(let r=0;r<e.expanded.length;r++){const l=t.getItem(e.expanded[r]);l&&t._menuItemsGroupsToExpand.push(l)}t._expandItemsByDefault(!0);for(let r=0;r<e.selected.length;r++){const o=t.getItem(e.selected[r]);o&&l.push(o.path)}t.selectedIndexes=l,t._applySelection(!1,r)}moveDown(e){const t=this;e=t.getItem(e);const r=e.nextElementSibling;void 0===e||!r||t.sorted||(t._moveTreeItem(e,r,2,[t]),t.filterable&&t._state.filter&&t._applyFilter(t._state.filter))}moveUp(e){const t=this;e=t.getItem(e);const r=e.previousElementSibling;void 0===e||!r||t.sorted||(t._moveTreeItem(e,r,0,[t]),t.filterable&&t._state.filter&&t._applyFilter(t._state.filter))}refresh(){this._checkOverflow()}removeItem(e){const t=this;if(e=t.getItem(e),void 0!==e){if(e instanceof Smart.TreeItemsGroup){const r=e.container;t._isContainerOpened(r.level,r)&&t._closeSubContainersTreeMode(r.level,r)}const r=t.sorted&&t.autoSort;r&&t._unsortItems(t.$.mainContainer),e.parentElement.removeChild(e),t._menuItems={},t._refreshItemPaths(t.$.mainContainer,!0,void 0,t.sorted&&!t.autoSort),r&&t._applyGrouping(t.$.mainContainer);const l=t._state.filter,o=t.selectedIndexes.slice(0);l&&t._applyFilter(l),t._checkOverflow(),t.selectedIndexes=[],t._applySelection(!0,o)}}saveState(){const e=this;return e.id?window.localStorage.setItem("smartTree"+e.id,JSON.stringify(e._state)):e.warn(e.localize("noId")),JSON.parse(JSON.stringify(e._state))}select(e){const t=this;e=t.getItem(e);void 0===e||e.selected||e.templateApplied||t._handleSelection(e,{type:"programmatic"})}unselect(e){const t=this;e=t.getItem(e);void 0===e||!e.selected||e.templateApplied||t._handleSelection(e,{type:"programmatic"})}updateItem(e,t){const r=this;if(e=r.getItem(e),void 0!==e&&void 0!==t){const r=e instanceof Smart.TreeItem;for(let l in t)if(t.hasOwnProperty(l)){if(r){if(-1===["disabled","label","level","selected","separator","shortcut","value"].indexOf(l))continue;}else if(-1===["disabled","expanded","label","level","selected","separator","value"].indexOf(l))continue;e[l]=t[l]}}}propertyChangedHandler(e,t,r){const l=this;switch(e){case"allowDrag":case"allowDrop":case"autoLoadState":case"autoSort":case"editable":case"filterInputPlaceholder":case"loadingIndicatorPlaceholder":case"selectionDisplayMode":case"showLines":case"showRootLines":case"toggleElementPosition":case"toggleMode":break;case"autoHideToggleElement":r?l.$mainContainer.addClass("hidden-arrows"):l.$mainContainer.removeClass("hidden-arrows");break;case"autoSaveState":if(!r)return;if(!l.id)return l.warn(l.localize("noId")),void(l.autoSaveState=!1);window.localStorage.setItem("smartTree"+l.id,JSON.stringify(l._state));break;case"dataSource":{const e=l.selectedIndexes.slice(0);l.selectedIndexes=[],l._menuItems={},l._processDataSource(),l._checkOverflow(),l._expandItemsByDefault(),l._applySelection(!0,e);const t=l._state.filter;t&&l._applyFilter(t);break}case"disabled":l._setFocusable(),l.$.scrollButtonNear.disabled=r,l.$.scrollButtonFar.disabled=r,r||l._updateScrollButtonVisibility();break;case"displayLoadingIndicator":r?(l._discardKeyboardHover(!0),l.$loadingIndicatorContainer.removeClass("smart-hidden")):l.$loadingIndicatorContainer.addClass("smart-hidden");break;case"filterable":!1===r&&(l._applyFilter(""),l.$.filterInput.value=""),l._checkOverflow();break;case"filterMode":l.filterable&&l._state.filter&&l._applyFilter(l._state.filter);break;case"hasThreeStates":if("checkBox"!==l.selectionMode)return;if(r)l._applySelection(!1);else{const e=(l.enableShadowDOM?l.shadowRoot:l).querySelectorAll("[indeterminate]");for(let t=0;t<e.length;t++)e[t].removeAttribute("indeterminate")}break;case"loadingIndicatorPosition":"center"===r?l.$loadingIndicatorPlaceHolder.addClass("smart-hidden"):l.$loadingIndicatorPlaceHolder.removeClass("smart-hidden");break;case"overflow":if("scrollbar"===l.scrollMode)return void(l.$.scrollViewer.verticalScrollBarVisibility="scroll"===r?"visible":"auto");l.$.scrollViewer.scrollTop=0,"hidden"===r?(l.$scrollViewer.removeClass("scroll-buttons-shown"),l.$scrollButtonNear.addClass("smart-hidden"),l.$scrollButtonFar.addClass("smart-hidden")):(l.$.scrollButtonNear.disabled=l.disabled,l.$.scrollButtonFar.disabled=l.disabled,"auto"===r?(l.$scrollButtonNear.addClass("smart-hidden"),l.$scrollButtonFar.addClass("smart-hidden"),l._checkOverflow()):(l.$scrollViewer.addClass("scroll-buttons-shown"),l.$scrollViewer.removeClass("one-button-shown"),l.$scrollButtonNear.removeClass("smart-hidden"),l.$scrollButtonFar.removeClass("smart-hidden"),l._updateScrollButtonVisibility())),l.$.scrollViewer.refresh();break;case"rightToLeft":{let e,t;for(let o in r?(e="paddingLeft",t="paddingRight"):(e="paddingRight",t="paddingLeft"),l._menuItems)if(l._menuItems.hasOwnProperty(o)){const r=l._menuItems[o],n=r.firstElementChild;n.style[e]="",l._setIndentation(n,r.level,t)}break}case"scrollMode":if("hidden"===l.overflow)return;if(l.$.scrollViewer.scrollTop=0,"scrollButtons"===r)return"scroll"===l.overflow&&(l.$scrollViewer.addClass("scroll-buttons-shown"),l.$scrollButtonNear.removeClass("smart-hidden"),l.$scrollButtonFar.removeClass("smart-hidden")),l.$.scrollViewer.verticalScrollBarVisibility="auto",void l._checkOverflow();l.$scrollViewer.removeClass("scroll-buttons-shown"),l.$scrollViewer.removeClass("one-button-shown"),l.$scrollButtonNear.addClass("smart-hidden"),l.$scrollButtonFar.addClass("smart-hidden"),l.$.scrollViewer.verticalScrollBarVisibility="auto"===l.overflow?"auto":"visible";break;case"selectedIndexes":l._applySelection(!1,t);break;case"selectionMode":if(void 0===l._menuItems[0])return;if("one"===t&&"none"!==r&&"checkBox"!==r&&"radioButton"!==r||-1!==t.indexOf("oneOrMany")&&-1!==r.indexOf("oneOrMany")||"none"===t&&(-1!==r.indexOf("zero")||"checkBox"===r)||"zeroOrMany"===r&&"checkBox"!==t||"radioButton"===t&&-1!==r.indexOf("Many")||!l.hasThreeStates&&("checkBox"===r||"checkBox"===t&&"zeroOrMany"===r))return void(l._lastSelectedItem="one"===r||"oneOrManyExtended"===r?l._menuItems[l.selectedIndexes[l.selectedIndexes.length-1]]:void 0);if(l.hasThreeStates&&"checkBox"===t){const e=(l.enableShadowDOM?l.shadowRoot:l).querySelectorAll("[indeterminate]");for(let t=0;t<e.length;t++)e[t].removeAttribute("indeterminate")}l._applySelection(!1);break;case"sort":{if(!l.sorted)return;l._refreshSorting();break}case"sortDirection":l.sorted&&!l.sort&&(l._unsortItems(l.$.mainContainer),l._applyGrouping(l.$.mainContainer));break;case"sorted":{if(!r&&!l.autoSort)return l._refreshItemPathsAndSelection(),void l._updateState("sorted",!1);r?l._applyGrouping(l.$.mainContainer):l._unsortItems(l.$.mainContainer);const e=l._state.filter;e&&l._applyFilter(e),l._updateState("sorted",r),l._checkOverflow();break}case"unfocusable":l._setFocusable();}}_addDragFeedback(){const e=this,t=document.createElement("div");return t.className="smart-tree-item-feedback",t.setAttribute("parent-tree-id",e.id),e.theme&&t.classList.add(e.theme),e.dragFeedbackFormatFunction?t.innerHTML=e.dragFeedbackFormatFunction(e._dragDetails.Items):1===e._dragDetails.Items.length?t.innerHTML=e._dragDetails.Item.label:(t.classList.add("multiple"),t.innerHTML="&#xf0c5;"),document.body.appendChild(t),t}_applyFilter(e){function t(e,t){e?(t.hidden&&t.$.removeClass("smart-hidden"),t.hidden=!1):(!t.hidden&&t.$.addClass("smart-hidden"),t.hidden=!0)}function r(o,n){let a,s=!1,d=0;n=Array.from(n);for(let c=0;c<n.length;c++){const o=n[c];o instanceof Smart.TreeItem?t(l._findItem(o,e),o):r(o,o.itemContainer.children),o.hidden||(d++,a=o),s=s||!o.hidden}if(o!==l.$.mainContainer){const r=l._findItem(o,e);t(s||r,o),s&&null===r?o.$.addClass("filtered-child"):o.$.removeClass("filtered-child"),!s&&0<n.length?(o.hiddenChildren=!0,o.$.addClass("hidden-children"),l.collapseItem(o,void 0,!1)):(o.hiddenChildren=!1,o.$.removeClass("hidden-children"))}""!==e&&0<d&&a.$.addClass("last-filtered-child")}const l=this;if(""!==e||l.hasAttribute("filter-applied")){const t=Array.from(l.$.mainContainer.getElementsByClassName("last-filtered-child"));for(let e=0;e<t.length;e++)t[e].$.removeClass("last-filtered-child");r(l.$.mainContainer,l.$.mainContainer.children),""===e?l.removeAttribute("filter-applied"):l.setAttribute("filter-applied",""),l._updateState("filter",e),l._checkOverflow()}}_applyHierarchicalSelection(e,t){const r=this,l=e!==r.$.mainContainer,o=l?e.itemContainer.children:e.children;let n=0,a=0;for(let s=0;s<o.length;s++){const i=o[s];e.selected&&i.set("selected",!0),i instanceof Smart.TreeItemsGroup?r._applyHierarchicalSelection(i,t):i.selected&&t.push(i.path),l&&(i.selected?n++:i.hasAttribute("indeterminate")&&a++)}l&&(r._setThreeStateCheckbox(e,n,a),e.selected&&t.push(e.path))}_applyRadioButtonSelection(e,t,r){const l=this,o=e===l.$.mainContainer?e.children:e.itemContainer.children,n=[];let a;for(let a=0;a<o.length;a++){const e=o[a];e instanceof Smart.TreeItemsGroup&&l._applyRadioButtonSelection(e,t,r),e.set("selected",!1),-1!==t.indexOf(e.path)&&n.push(e)}a=0===n.length?o[0]:n[n.length-1],a.set("selected",!0),r.push(a.path)}_applySelection(e,t){const r=this;let l=r.selectedIndexes.slice(0);if(void 0===t&&(t=l.slice(0)),void 0===r._menuItems[0])return r.selectedIndexes=[],r._lastSelectedItem=void 0,void(r.isRendered&&JSON.stringify(t)!==JSON.stringify([])&&r.$.fireEvent("change",{selectedIndexes:r.selectedIndexes,oldSelectedIndexes:t}));const o=r.selectionMode,n=Array.from((r.shadowRoot||r).querySelectorAll("smart-tree-item[selected], smart-tree-items-group[selected]"));for(let o=l.length-1;0<=o;o--){const e=r._menuItems[l[o]];void 0===e&&l.splice(o,1)}if(e)for(let e=0;e<n.length;e++)-1===l.indexOf(n[e].path)&&l.push(n[e].path);else{for(let e=0;e<n.length;e++)n[e].set("selected",!1);n.length=0}switch(r._sortPathCollection(l),o){case"none":l.length=0;for(let e=0;e<n.length;e++)n[e].set("selected",!1);break;case"one":case"zeroOrOne":"zeroOrOne"!==o&&0===l.length&&l.push("0");for(let e=0;e<l.length;e++){const t=r._menuItems[l[e]];if(e==l.length-1){t.set("selected",!0),l=[l[e]];break}-1!==n.indexOf(t)&&t.set("selected",!1)}break;case"oneOrMany":case"oneOrManyExtended":0===l.length&&l.push("0");for(let e=0;e<l.length;e++)r._menuItems[l[e]].set("selected",!0);break;case"zeroOrMany":case"checkBox":for(let e=0;e<l.length;e++)r._menuItems[l[e]].set("selected",!0);if("checkBox"===o&&r.hasThreeStates){const e=[];r._applyHierarchicalSelection(r.$.mainContainer,e),r._sortPathCollection(e),l=e}break;case"radioButton":{const e=[];r._applyRadioButtonSelection(r.$.mainContainer,l,e),r._sortPathCollection(e),l=e;break}}r.selectedIndexes=l,r._updateState("selected"),r._lastSelectedItem="one"===o||"oneOrManyExtended"===o?r._menuItems[l[l.length-1]]:void 0,r.isRendered&&!1!==arguments[2]&&JSON.stringify(t)!==JSON.stringify(l)&&r.$.fireEvent("change",{selectedIndexes:r.selectedIndexes,oldSelectedIndexes:t})}_autoLoadState(e){const t=this,r=[];for(let r=0;r<t._menuItemsGroupsToExpand.length;r++)t._menuItemsGroupsToExpand[r].set("expanded",!1);t._menuItemsGroupsToExpand=[];for(let r=0;r<e.expanded.length;r++){const l=t.getItem(e.expanded[r]);l&&t._menuItemsGroupsToExpand.push(l)}t.filterable&&e.filter&&(t._applyFilter(e.filter),t.$.filterInput.value=e.filter);for(let l=0;l<e.selected.length;l++){const o=t.getItem(e.selected[l]);o&&r.push(o.path)}t.selectedIndexes=r}_blurHandler(){this._discardKeyboardHover(!0)}_canItemBeHovered(e){const t=e.level;return!1===e.disabled&&!0!==e.templateApplied&&!0!==e.hidden&&(1===t||1<t&&this._isContainerOpened(t,e.parentElement.container)&&0<e.getBoundingClientRect().height)}_canItemBeSelected(e){return!1===e.disabled&&!0!==e.templateApplied}_checkOverflow(){var e=Math.round;const t=this,r=t.$.scrollViewer,l=t.overflow;if("scrollbar"===t.scrollMode||"hidden"===l)return void r.refresh();const o=r.scrollTop;"auto"===l&&(r.$.removeClass("scroll-buttons-shown"),r.$.removeClass("one-button-shown"),t.$scrollButtonNear.addClass("smart-hidden"),t.$scrollButtonFar.addClass("smart-hidden"));const n=e(r.$.scrollViewerContentContainer.offsetHeight)>e(r.$.scrollViewerContainer.offsetHeight),a=0<e(r.scrollTop),s=e(r.$.scrollViewerContainer.offsetHeight+r.scrollTop)<e(r.$.scrollViewerContentContainer.offsetHeight);n?"auto"===l?(r.$.addClass("scroll-buttons-shown"),a&&t.$scrollButtonNear.removeClass("smart-hidden"),s&&t.$scrollButtonFar.removeClass("smart-hidden"),!1==(a&&s)&&r.$.addClass("one-button-shown"),!t.disabled&&(t.$.scrollButtonNear.disabled=!1,t.$.scrollButtonFar.disabled=!1),r.scrollTop=o):(t.$scrollButtonNear.removeClass("smart-hidden"),t.$scrollButtonFar.removeClass("smart-hidden"),t.disabled?(t.$.scrollButtonNear.disabled=!0,t.$.scrollButtonFar.disabled=!0):(t.$.scrollButtonNear.disabled=!a,t.$.scrollButtonFar.disabled=!s)):"scroll"===l&&(t.$.scrollButtonNear.disabled=!0,t.$.scrollButtonFar.disabled=!0),r.refresh()}_createElement(){const e=this,t=window.getComputedStyle(e.$.scrollViewer);e.$.scrollViewer.onVerticalChange=e._verticalScrollbarHandler,Object.defineProperty(e,"dataSource",{get:function(){return e.context===e?e.properties.dataSource.value:e._getDataSource()},set(t){e.updateProperty(e,e._properties.dataSource,t)}}),!e.id&&(e.autoLoadState||e.autoSaveState)&&(e.warn(e.localize("noId")),e.autoLoadState=!1,e.autoSaveState=!1),e.mode="tree",e._element="tree",e._isMobile=Smart.Utilities.Core.isMobile,e._edgeMacFF=!1,e._autoScrollCoefficient=Smart.Utilities.Core.Browser.Firefox?4:Smart.Utilities.Core.Browser.Edge?8:2,e._scrollViewerPadding=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom)||0,e._state={expanded:[],filter:"",selected:[]},e._dblclickObject={numberOfClicks:0},e.autoHideToggleElement&&e.$mainContainer.addClass("hidden-arrows"),e.disabled&&(e.$.scrollButtonNear.disabled=!0,e.$.scrollButtonFar.disabled=!0),"scrollbar"===e.scrollMode&&"scroll"===e.overflow&&(e.$.scrollViewer.verticalScrollBarVisibility="visible"),null===e.dataSource&&e.$.mainContainer.firstElementChild instanceof HTMLUListElement&&e._processUList();const r=(e.shadowRoot||e).querySelectorAll("smart-tree-item, smart-tree-items-group"),l=function(){let t;e.autoLoadState&&(t=window.localStorage.getItem("smartTree"+e.id),t&&(t=JSON.parse(t),e.sorted=t.sorted)),e._setFocusable(),e._menuItems={},null===e.dataSource?e._processHTML(e.$.mainContainer,1):e._processDataSource(),"scrollButtons"===e.scrollMode&&"scroll"===e.overflow&&(e.$scrollViewer.addClass("scroll-buttons-shown"),e.$scrollButtonNear.removeClass("smart-hidden"),e.$scrollButtonFar.removeClass("smart-hidden"),e._updateScrollButtonVisibility()),e._checkOverflow(),t&&e._autoLoadState(t),e._expandItemsByDefault(),e._applySelection(!0),e._updateState("sorted",e.sorted),e.displayLoadingIndicator&&e.$loadingIndicatorContainer.removeClass("smart-hidden"),"center"!==e.loadingIndicatorPosition&&e.$loadingIndicatorPlaceHolder.removeClass("smart-hidden"),e.__onCompleted&&(e._onCompleted=e.__onCompleted,e.__onCompleted=null,e._onCompleted())};0===r.length||e.enableShadowDOM||e.isInShadowDOM?l():(e._onCompleted&&(e.__onCompleted=e._onCompleted,e._onCompleted=null),e._ensureItemsReady(r,l)),e.checkLicense()}_dblclickHandler(e,t,r){const l=this;"dblclick"!==l.toggleMode||e instanceof Smart.TreeItem||t||l._menuItemsGroupSelectionHandler(e,r)}_discardKeyboardHover(e,t){const r=this;t||!r._hoveredViaKeyboard||!e&&r._hoveredViaKeyboard instanceof Smart.MenuItemsGroup&&r._isContainerOpened(r._hoveredViaKeyboard.level+1,r._hoveredViaKeyboard.container)||(r._hoveredViaKeyboard.removeAttribute("focus"),r._hoveredViaKeyboard=void 0)}_documentUpHandler(e){const t=this,r=t._downItem,l=t.enableShadowDOM?e.originalEvent.composedPath()[0]:e.originalEvent.target;if(delete t._downItem,t._editedItem&&!t._editInputDown&&(!t._isMobile&&l!==t.$.editInput||t._isMobile&&document.elementFromPoint(e.clientX,e.clientY)!==t.$.editInput))return void t._endEditing();if(delete t._editInputDown,r){const o=l.closest("smart-tree-item")||l.closest("smart-tree-items-group");!o||!o.selected||o!==r||t._dragDetails&&t._dragDetails.FeedbackShown||o instanceof Smart.TreeItemsGroup&&(l.closest(".smart-tree-items-group-arrow")||l===o.container||l===o.container.firstElementChild)||t._handleSelection(o,e)}const o=t._dragDetails;if(!o)return;const n=Smart.Tree.hoveredTree,a=Smart.Tree.hoveredItem;if(delete t._dragDetails,delete Smart.Tree.treeItemDragged,delete Smart.Tree.hoveredTree,delete Smart.Tree.hoveredItem,t.$.scrollViewer._scrollView.disableSwipeScroll=!1,!o.FeedbackShown)return;const s=n||document.elementFromPoint(e.clientX,e.clientY);let d;document.body.classList.remove("smart-dragging"),document.body.removeChild(o.Feedback),n&&clearInterval(n._dragInterval);const i=o.Item,c=o.Items,m=o.ValidItems;if(!s)return;if(!a||i.contains(a))return void t.$.fireEvent("dragEnd",{item:i,items:c,target:s,data:o,previousContainer:t,container:n||s,originalEvent:e});if(!(n&&n.allowDrop&&!n.disabled))return;const p=[n];let u;if(a.classList.remove("drop-target"),a.classList.contains("top")?(a.classList.remove("top"),u="top",d=0):a.classList.contains("bottom")?(a.classList.remove("bottom"),u="bottom",d=2):(u="inside",d=1),o.DropDetails={item:a,position:u},n!==t)p.push(t);else if(o.ValidateOnDrop)for(let e=0;e<m.length;e++)if(m[e].contains(a))return;const h=t.$.fireEvent("dragEnd",{item:i,items:c,target:a,data:o,previousContainer:t,container:n,originalEvent:e});if(!h.defaultPrevented){n.sorted&&n.autoSort&&n._unsortItems(n.$.mainContainer);for(let e=0;e<m.length;e++)t._moveTreeItem(m[e],a,d,p);n.sorted&&n.autoSort&&n._applyGrouping(n.$.mainContainer),n!==t&&n._state.filter&&n._applyFilter(n._state.filter)}}_editInputBlurHandler(){this._endEditing()}_endEditing(e){const t=this,r=t._editedItem;if(r&&(delete t._editedItem,t.$editInput.addClass("smart-hidden"),t.focus(),!e)){const e=t.$.editInput.value,l=t.sorted&&t.autoSort,o=t._state.filter;e===r.label||(r.set("label",e),r.firstElementChild.firstElementChild.firstElementChild.innerHTML=e,l&&(t._unsortItems(t.$.mainContainer),t._applyGrouping(t.$.mainContainer)),o&&t._applyFilter(o))}}_ensureVisible(e){const t=this;t._ensureVisibleTreeMode(e,e.getBoundingClientRect(),t.$.scrollViewer,t.$.scrollViewer.getBoundingClientRect(),t._scrollViewerPadding),t._ensureVisibleCallback&&t._ensureVisibleCallback(e)}_filterInputKeydownHandler(e){if("PageDown"!==e.key)return void("PageUp"===e.key&&(e.preventDefault(),e.stopPropagation()));const t=this;let r;if(e.preventDefault(),e.stopPropagation(),0<t.selectedIndexes.length){const e=t.selectedIndexes.slice(0);r=t._lastSelectedItem||t._menuItems[t.selectedIndexes[t.selectedIndexes.length-1]],"checkBox"!==t.selectionMode&&"radioButton"!==t.selectionMode&&(t.selectedIndexes=[r.path],t._applySelection(!1,e)),t.focus()}else r=t._getFirstEnabledChild(t.$.mainContainer),t.focus(),r&&t._hoverViaKeyboard(r);t._ensureVisible(r)}_focusHandler(){const e=this;0<e.selectedIndexes.length&&!e._hoveredViaKeyboard&&(e._lastSelectedItem?e._hoverViaKeyboard(e._lastSelectedItem,!1,void 0,!1):e._hoverViaKeyboard(e._menuItems[e.selectedIndexes[e.selectedIndexes.length-1]],!1,void 0,!1))}_getDataSource(){function e(t,r){for(let l=0;l<t.length;l++){const o=t[l],n={label:o.label};o.disabled&&(n.disabled=!0),o.selected&&(n.selected=!0),o.separator&&(n.separator=!0),null!==o.value&&(n.value=o.value),o instanceof Smart.TreeItem?o.shortcut&&(n.shortcut=o.shortcut):(o.expanded&&(n.expanded=!0),n.items=[],e(o.itemContainer.children,n.items)),r.push(n)}}const t=this,r=[];return e(t.$.mainContainer.children,r),r}_handleHierarchicalSelection(e,t){function r(e,t){const l=e.itemContainer.children;for(let o=0;o<l.length;o++){const e=l[o];e.set("selected",t),e.removeAttribute("indeterminate"),e instanceof Smart.TreeItemsGroup&&r(e,t)}}const l=this;let o=e;for(e.selected?e.set("selected",!1):(e.set("selected",!0),e.removeAttribute("indeterminate"));o.parentItem;){const e=o.parentItem,t=e.itemContainer.children;let r=0,n=0;for(let e=0;e<t.length;e++)t[e].selected?r++:t[e].hasAttribute("indeterminate")&&n++;l._setThreeStateCheckbox(e,r,n),o=e}e instanceof Smart.TreeItemsGroup&&r(e,e.selected),t.length=0;const n=Array.from((l.enableShadowDOM?l.shadowRoot:l).querySelectorAll("[selected]"));for(let r=0;r<n.length;r++)t.push(n[r].path);l._sortPathCollection(t)}_handleSelection(e,t){const r=this,l=r.selectionMode;if("none"===l||"programmatic"!==t.type&&!r._canItemBeSelected(e))return;const o=e.selected;if(o&&"down"===t.type)return;const n=r.selectedIndexes.slice(0);let a=n.slice(0);switch(l){case"one":if(o)return;r._menuItems[a[0]].set("selected",!1),r.selectedIndexes=[e.path],e.set("selected",!0),r._lastSelectedItem=e;break;case"zeroOrOne":o?(r.selectedIndexes=[],e.set("selected",!1)):(void 0!==a[0]&&r._menuItems[a[0]].set("selected",!1),r.selectedIndexes=[e.path],e.set("selected",!0));break;case"oneOrMany":case"zeroOrMany":if(o){if(1===a.length&&"zeroOrMany"!==l)return;a.splice(a.indexOf(e.path),1),e.set("selected",!1)}else a.push(e.path),r._sortPathCollection(a),e.set("selected",!0);r.selectedIndexes=a;break;case"oneOrManyExtended":{const l=t.ctrlKey,o=t.shiftKey;if(!l&&!o||o&&e===r._lastSelectedItem){for(let e=0;e<a.length;e++)r._menuItems[a[e]].set("selected",!1);a=[e.path],e.set("selected",!0),r._lastSelectedItem=e}else if(l)e.selected&&1<a.length?(a.splice(a.indexOf(e.path),1),e.set("selected",!1)):!e.selected&&(a.push(e.path),r._sortPathCollection(a),e.set("selected",!0),r._lastSelectedItem=e);else if(o){for(let e=0;e<a.length;e++)r._menuItems[a[e]].set("selected",!1);a=r._selectItemRange(r._lastSelectedItem,e)}r.selectedIndexes=a;break}case"checkBox":r.hasThreeStates?r._handleHierarchicalSelection(e,a):o?(a.splice(a.indexOf(e.path),1),e.set("selected",!1)):(a.push(e.path),r._sortPathCollection(a),e.set("selected",!0)),r.selectedIndexes=a;break;case"radioButton":{if(e.selected)return;let t;for(let r=0;r<e.parentElement.children.length;r++){const l=e.parentElement.children[r];if(l.selected){t=l;break}}const l=a.indexOf(t.path);t.set("selected",!1),e.set("selected",!0),a.splice(l,1),a.push(e.path),r._sortPathCollection(a),r.selectedIndexes=a;break}}if(r._discardKeyboardHover(!0),r._hoverViaKeyboard(e,!1,void 0,!r._treeAnimationInProgress),r._updateState("selected"),JSON.stringify(n)!==JSON.stringify(r.selectedIndexes)){if(r.ownerElement&&!r.ownerElement.isRendered)return;r.$.fireEvent("change",{item:e,selectedIndexes:r.selectedIndexes,oldSelectedIndexes:n})}}_hoverViaKeyboard(e,t,r,l){if(e){const o=this;e.setAttribute("focus",""),o._hoveredViaKeyboard=e,!1!==l&&o._ensureVisible(e),t&&o._handleSelection(e,r),o._hoverViaKeyboardCallback&&o._hoverViaKeyboardCallback(e)}}_keydownHandler(e){function t(t){for(let r=t;r<a.length;r++){const t=a[r];if(o._canItemBeHovered(t)){if(i){if(i===t)break;i.removeAttribute("focus")}o._hoverViaKeyboard(t,s,e);break}}}function r(t){for(let r=t;0<=r;r--){const t=a[r];if(o._canItemBeHovered(t)){if(i){if(i===t)break;i.removeAttribute("focus")}o._hoverViaKeyboard(t,s,e);break}}}function l(){1<i.level&&(i.removeAttribute("focus"),o._hoverViaKeyboard(i.parentItem,s,e))}const o=this,n=e.key;if(o._editedItem)return void("Enter"===n?o._endEditing():"Escape"===n&&o._endEditing(!0));if(o.getRootNode().activeElement!==o||-1===["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","End","Enter","F2","Home","PageDown","PageUp"," "].indexOf(n)||o.disabled||o.displayLoadingIndicator)return;e.preventDefault();const a=Array.from(o.$.mainContainer.querySelectorAll("smart-tree-item, smart-tree-items-group")),s="one"===o.selectionMode||"oneOrManyExtended"===o.selectionMode&&!e.ctrlKey,i=o.$.mainContainer.querySelector("[focus]");let d;switch(n){case"ArrowDown":d=i?a.indexOf(i)+1:0,t(d);break;case"ArrowLeft":if(!i)return;if(i instanceof Smart.TreeItem)l();else{if(o._isContainerOpened(i.level+1,i.container))return void o._closeSubContainersTreeMode(i.level+1,i.container,!0,!0);l()}break;case"ArrowRight":if(!i||i instanceof Smart.TreeItem)return;o._isContainerOpened(i.level+1,i.container)?(i.removeAttribute("focus"),o._hoverViaKeyboard(o._getFirstEnabledChild(i.itemContainer),s,e)):o._menuItemsGroupSelectionHandler(i,{target:i,type:"keydown"});break;case"ArrowUp":d=i?a.indexOf(i)-1:a.length-1,r(d);break;case"End":r(a.length-1);break;case"Enter":i&&i instanceof Smart.TreeItemsGroup&&o._menuItemsGroupSelectionHandler(i,{target:i,type:"keydown"});break;case"F2":o.editable&&o._startEditing(i);break;case"Home":t(0);break;case"PageDown":o._pageDownHandler(a,i,s,e);break;case"PageUp":o._pageUpHandler(a,i,s,e);break;case" ":i&&o._handleSelection(i,e);}}_mainContainerSwipeHandler(e){Smart.Tree.treeItemDragged&&e.stopPropagation()}_menuItemsGroupSelectionHandler(e,t,r){const l=this,o=l.toggleMode,n=!!t.originalEvent&&t.originalEvent.target.classList.contains("smart-tree-items-group-arrow"),a=e.container;if(!(l._waitAnimation&&l._treeAnimationInProgress===a)&&("down"!==t.type||n||"dblclick"===o&&1!==l._dblclickObject.numberOfClicks||l._handleSelection(e,t),!("down"===t.type&&!n&&("dblclick"===o&&2!==l._dblclickObject.numberOfClicks||"click"===o&&1<l._dblclickObject.numberOfClicks||"arrow"===o)||e.hiddenChildren))){const o=a.level;let n=l.hasAnimation;if("keydown"===t.type&&l._discardKeyboardHover(),l._treeAnimationInProgress&&(a.removeEventListener("transitionend",l._transitionendHandlerExpand),a.removeEventListener("transitionend",l._transitionendHandlerCollapse)),l._isContainerOpened(o,a))l._closeSubContainersTreeMode(o,a,!0,!1!==r);else{const s=l.$.fireEvent("expanding",{item:e,label:e.label,path:e.path,value:e.value,children:e.itemContainer.children});if(s.defaultPrevented)return;if(n&&("expand"!==t.type&&(l._ensureVisibleOnTransitionend=e),l._expandSection(a)),a.$.removeClass("smart-visibility-hidden"),"keydown"===t.type&&(e.setAttribute("focus",""),l._hoveredViaKeyboard=e),e.$.addClass("smart-tree-items-group-opened"),e.$.addClass("smart-tree-items-group-expanded"),l._addOpenedContainer(o,a),void 0===t.type&&l._hoverViaKeyboard(l._getFirstEnabledChild(e.itemContainer)),!1!==r){const t={item:e,label:e.label,path:e.path,value:e.value,children:e.itemContainer.children};l.toggleCallback?(t.type="expand",l.toggleCallback(t)):l.$.fireEvent("expand",t)}}n||(l._checkOverflow(),"expand"!==t.type&&l._ensureVisible(e))}}_mouseenterHandler(){const e=this;e.autoHideToggleElement&&e.$mainContainer.removeClass("hidden-arrows"),Smart.Tree.treeItemDragged&&e.allowDrop&&!e.disabled&&(Smart.Tree.hoveredTree=e)}_mouseleaveHandler(){const e=this;if(e.autoHideToggleElement&&e.$mainContainer.addClass("hidden-arrows"),Smart.Tree.treeItemDragged){Smart.Tree.hoveredTree&&(clearInterval(Smart.Tree.hoveredTree._dragInterval),delete Smart.Tree.hoveredTree);const e=Smart.Tree.hoveredItem;e&&(e.classList.remove("drop-target"),e.classList.remove("top"),e.classList.remove("bottom"),delete Smart.Tree.hoveredItem)}}_moveHandler(e){var t=Math.abs;const r=this,l=r._dragDetails;if(!l)return;if(!l.FeedbackShown)if(5<t(l.StartPosition.left-e.pageX)||5<t(l.StartPosition.top-e.pageY)){const e=r.$.fireEvent("dragStart",{item:l.Item,items:l.Items,data:l,container:r,previousContainer:r,originalEvent:l.OriginalEvent});if(e.defaultPrevented)return delete r._dragDetails,delete Smart.Tree.treeItemDragged,delete Smart.Tree.hoveredTree,delete Smart.Tree.hoveredItem,void(r.$.scrollViewer._scrollView.disableSwipeScroll=!1);document.body.classList.add("smart-dragging"),l.Feedback=r._addDragFeedback(),l.FeedbackShown=!0}else return;const o=r.dragOffset;let n,a,s;if(r.$.fireEvent("dragging",{item:l.Item,items:l.Items,data:l,originalEvent:e}),l.Feedback.style.left=e.pageX+o[0]+"px",l.Feedback.style.top=e.pageY+o[1]+"px",r._isMobile){const t=Smart.Tree.hoveredItem;t&&(t.classList.remove("drop-target"),t.classList.remove("top"),t.classList.remove("bottom"),delete Smart.Tree.hoveredItem);const r=document.elementFromPoint(e.clientX,e.clientY);Smart.Tree.hoveredTree&&(clearInterval(Smart.Tree.hoveredTree._dragInterval),delete Smart.Tree.hoveredTree),r&&(n=r.closest("smart-tree"),n&&n.allowDrop&&(Smart.Tree.hoveredTree=n,a=r.closest("smart-tree-item")||r.closest("smart-tree-items-group"),a?s=a:a=r))}if(n=Smart.Tree.hoveredTree,!n)return;const i=n.filterable?n.$.filterInput.offsetHeight+10:0;if(clearInterval(n._dragInterval),n._dragInterval=setInterval(function(){const t=n.getBoundingClientRect();0<n.$.scrollViewer.scrollHeight&&t.left<=e.clientX&&t.left+t.width>=e.clientX?e.clientY>=t.top+i&&e.clientY<=t.top+20+i?(n.$.scrollViewer.scrollTop-=r._autoScrollCoefficient,"scrollButtons"===n.scrollMode&&n._updateScrollButtonVisibility()):e.clientY>=t.top+t.height-20&&e.clientY<=t.top+t.height?(n.$.scrollViewer.scrollTop+=r._autoScrollCoefficient,"scrollButtons"===n.scrollMode&&n._updateScrollButtonVisibility()):clearInterval(n._dragInterval):clearInterval(n._dragInterval)},1),r._isMobile||(a=e.originalEvent.target,a&&a.enableShadowDOM&&(a=e.originalEvent.composedPath()[0]),a&&a.closest&&(s=a.closest("smart-tree-item")||a.closest("smart-tree-items-group"))),s){if(Smart.Tree.hoveredItem&&s!==Smart.Tree.hoveredItem&&(Smart.Tree.hoveredItem.classList.remove("drop-target"),Smart.Tree.hoveredItem.classList.remove("top"),Smart.Tree.hoveredItem.classList.remove("bottom")),Smart.Tree.hoveredItem=s,l.Item.contains(s))return;const t=s.getBoundingClientRect();s instanceof Smart.TreeItem?e.clientY-t.top<=t.height/2?(s.classList.remove("bottom"),s.classList.add("top")):(s.classList.remove("top"),s.classList.add("bottom")):10>=e.clientY-t.top?(s.classList.remove("bottom"),s.classList.add("top")):!s.expanded&&10>=t.bottom-e.clientY?(s.classList.remove("top"),s.classList.add("bottom")):(s.classList.remove("top"),s.classList.remove("bottom")),s.classList.add("drop-target")}else if(Smart.Tree.hoveredItem&&(Smart.Tree.hoveredItem.classList.remove("drop-target"),Smart.Tree.hoveredItem.classList.remove("top"),Smart.Tree.hoveredItem.classList.remove("bottom")),a!==n.$.scrollViewer.$.scrollViewerContainer)delete Smart.Tree.hoveredItem;else if(n._menuItems[0]){let e=n.$.mainContainer.lastElementChild,t=n.$.mainContainer.childElementCount-1;for(;e.hidden&&(t--,e=n.$.mainContainer.children[t],!!e););e?(Smart.Tree.hoveredItem=e,Smart.Tree.hoveredItem.classList.add("bottom")):Smart.Tree.hoveredItem=n.$.container,Smart.Tree.hoveredItem.classList.add("drop-target")}else Smart.Tree.hoveredItem=n.$.container,Smart.Tree.hoveredItem.classList.add("drop-target")}_moveSubItems(e,t,r){const l=this;for(let o=0;o<e.length;o++){const n=e[o];n.menu=t,n.set("level",n.parentItem.level+1),n.firstElementChild.style.paddingLeft="",n.firstElementChild.style.paddingRight="",l._setIndentation(n.firstElementChild,n.level,r),n.hidden=!1,n.$.removeClass("smart-hidden"),n.$.removeClass("filtered-child"),n.$.removeClass("last-filtered-child"),n instanceof Smart.TreeItemsGroup&&(n.$.removeClass("hidden-children"),n.container.level=n.level+1,l._moveSubItems(n.itemContainer.children,t,r),t!==l&&n.expanded&&(t._menuItemsGroupsToExpand.push(n),l._updateState("expanded",n.id,!1)))}}_moveTreeItem(e,t,r,l){const o=this,n=e.level;if(0===r){if(t.previousElementSibling===e)return;t.parentElement.insertBefore(e,t),e.set("level",t.level)}else if(2===r){if(t.nextElementSibling===e)return;t.parentElement.insertBefore(e,t.nextElementSibling||null),e.set("level",t.level)}else if(t===l[0].$.container)l[0].$.mainContainer.appendChild(e),e.set("level",1);else{if(t.itemContainer.lastElementChild===e)return;t.itemContainer.appendChild(e),e.set("level",t.level+1)}const a=l[0].rightToLeft?"paddingRight":"paddingLeft";if(e.menu=l[0],e.parentItem=e.parentElement.menuItemsGroup,e.firstElementChild.style.paddingLeft="",e.firstElementChild.style.paddingRight="",o._setIndentation(e.firstElementChild,e.level,a),e.hidden=!1,e.$.removeClass("smart-hidden"),e.$.removeClass("filtered-child"),e.$.removeClass("last-filtered-child"),e instanceof Smart.TreeItemsGroup&&(e.$.removeClass("hidden-children"),e.container.level=e.level+1,o._moveSubItems(e.itemContainer.children,l[0],a),e.expanded)){const t=o._openedContainers[n+1].indexOf(e.container);-1!==t&&o._openedContainers[n+1].splice(t,1),l[0]._menuItemsGroupsToExpand.push(e),2===l.length&&o._updateState("expanded",e.id,!1)}for(let o=0;o<l.length;o++){const e=l[o],t=e.context,r=e.selectedIndexes.slice(0);e.context=e,e._menuItems={},e._refreshItemPaths(e.$.mainContainer,!0,void 0,e.sorted&&!e.autoSort),e.selectedIndexes=[],e._applySelection(!0,r,!1),e._checkOverflow(),e.context=t}l[0]._expandItemsByDefault()}_overriddenMenuHandler(){}_pageDownHandler(e,t,r,l){function o(){for(let t=e.length-1;0<=t;t--){const r=e[t];if(n._canItemBeHovered(r)&&n._getOffsetTop(r)+r.firstElementChild.offsetHeight<=a.scrollTop+a.$.container.offsetHeight)return r}}const n=this,a=n.$.scrollViewer;if(!t)return;let s=o();s&&(t===s?a.scrollTop+a.$.container.offsetHeight!==a.$.scrollViewerContentContainer.offsetHeight&&(n.$.scrollViewer.scrollTop+=a.$.container.offsetHeight,"scrollButtons"===n.scrollMode&&n._updateScrollButtonVisibility(),s=o(),t.removeAttribute("focus"),n._hoverViaKeyboard(s,r,l)):(t.removeAttribute("focus"),n._hoverViaKeyboard(s,r,l)))}_pageUpHandler(e,t,r,l){function o(){for(let t=0;t<e.length;t++){const r=e[t];if(n._canItemBeHovered(r)&&n._getOffsetTop(r)>=a.scrollTop)return r}}const n=this,a=n.$.scrollViewer;if(!t)return;let s=o();s&&(t===s?0===a.scrollTop?n.filterable&&n.$.filterInput.focus():(n.$.scrollViewer.scrollTop-=a.$.container.offsetHeight,"scrollButtons"===n.scrollMode&&n._updateScrollButtonVisibility(),s=o(),t.removeAttribute("focus"),n._hoverViaKeyboard(s,r,l)):(t.removeAttribute("focus"),n._hoverViaKeyboard(s,r,l)))}_refreshItemPathsAndSelection(){const e=this,t=e.selectedIndexes.slice(0);e._menuItems={},e._refreshItemPaths(e.$.mainContainer,!0),e.selectedIndexes=[],e._applySelection(!0,t)}_refreshSorting(){const e=this;e._unsortItems(e.$.mainContainer),e._applyGrouping(e.$.mainContainer);const t=e._state.filter;t&&e._applyFilter(t),e._checkOverflow()}_scroll(e){const t=this;t.$.scrollViewer.scrollTop+=10*e,t._updateScrollButtonVisibility(),t.focus()}_scrollButtonFarClickHandler(){const e=this;e.$.scrollButtonFar.disabled||e._scroll(1)}_scrollButtonNearClickHandler(){const e=this;e.$.scrollButtonNear.disabled||e._scroll(-1)}_scrollViewerDownHandler(e){function t(){const t=l.closest("smart-tree-item")||l.closest("smart-tree-items-group");if(!(t&&r._canItemBeSelected(t)))return;const o=l.closest(".smart-tree-items-group-arrow");let n;if(t instanceof Smart.TreeItem)n="_handleSelection";else{if(l===t.container||l===t.container.firstElementChild)return;n="_menuItemsGroupSelectionHandler"}if(clearTimeout(r._dblclickTimeout),t!==r._dblclickObject.target&&(r._dblclickObject.numberOfClicks=0),r._dblclickObject.target=t,r._dblclickObject.numberOfClicks++,r._dblclickTimeout=setTimeout(function(){r._dblclickObject.numberOfClicks=0},300),2===r._dblclickObject.numberOfClicks)if(!r.editable)r._dblclickHandler(t,o,e),r._dblclickObject.numberOfClicks=0;else return void r._startEditing(t);t.selected&&(r._downItem=t),r[n](t,e),r._discardKeyboardHover(!0),r._hoverViaKeyboard(t,!1,void 0,!1),o||r._startDragging(t,e)}const r=this;if(e.target!==r.$.scrollViewer||r.disabled||r.displayLoadingIndicator||!r._isMobile&&1!==e.which)return;const l=e.originalEvent.target;if(l===r.$.editInput)return void(r._editInputDown=!0);if(r._isMobile){const e=r.$.scrollViewer.scrollTop;setTimeout(function(){if(r.$.scrollViewer.scrollTop!==e)return;else{const e=r.context;r.context=r,t(),r.context=e}},250)}else t()}_scrollViewerWheelHandler(){const e=this;"scrollButtons"===e.scrollMode&&"hidden"!==e.overflow&&e._updateScrollButtonVisibility()}_selectItemRange(e,t){const r=this,l=Array.from(r.$.mainContainer.querySelectorAll("smart-tree-item, smart-tree-items-group")),o=l.indexOf(e),n=l.indexOf(t),a=[];for(let s=Math.min(o,n);s<=Math.max(o,n);s++){const e=l[s];r._canItemBeHovered(e)&&(a.push(e.path),e.set("selected",!0))}return a}_setFocusable(){super._setFocusable();const e=this;return e.disabled||e.unfocusable?void(e.$.filterInput.tabIndex=-1):void e.$.filterInput.removeAttribute("tabindex")}_setIndentation(e,t,r){e.style[r]=20*t-10+"px"}_setThreeStateCheckbox(e,t,r){t===e.itemContainer.childElementCount?(e.removeAttribute("indeterminate"),e.set("selected",!0)):0===t&&0===r?(e.removeAttribute("indeterminate"),e.set("selected",!1)):(e.setAttribute("indeterminate",""),e.set("selected",!1))}_sortItems(e){const t=this;if(!t.sorted)return;let r;e instanceof Smart.TreeItemsGroup?r=e.container.firstElementChild:e===t.$.mainContainer&&(r=e);let l=Array.from(r.children);if(t.sort){const r=t.sort(l,e);Array.isArray(r)&&(l=r)}else"asc"===t.sortDirection?l.sort(function(e,t){return e.label.localeCompare(t.label)}):l.sort(function(e,t){return t.label.localeCompare(e.label)});for(let t=l.length-1;0<=t;t--)r.insertBefore(l[t],r.firstElementChild)}_sortPathCollection(e){e.sort(function(e,t){const r=e.split("."),l=t.split("."),o=Math.max(r.length,l.length);for(let n=0;n<o;n++){const e=parseFloat(r[n]),t=parseFloat(l[n]);if(isNaN(e))return-1;if(isNaN(t))return 1;if(e<t)return-1;if(e>t)return 1}})}_startDragging(e,t){const r=this,l=r.selectionMode;if(!r.allowDrag||r._editedItem||"none"===l)return;const o=[],n=[];let a;if(-1!==["one","zeroOrOne","checkBox","radioButton"].indexOf(l))a=!1,o.push(e),n.push(e);else{a=!0;for(let e=0;e<r.selectedIndexes.length;e++)o.push(r._menuItems[r.selectedIndexes[e]]),n.push(o[e]);for(let e=0;e<o.length;e++){const t=o[e];if(-1!==n.indexOf(t))for(let e=n.length-1;0<=e;e--){const r=n[e];if(r===t)break;t.contains(r)&&n.splice(e,1)}}}r._dragDetails={StartPosition:{left:t.pageX,top:t.pageY},Items:o,ValidItems:n,Item:e,FeedbackShown:!1,ValidateOnDrop:a,OriginalEvent:t,StartTime:new Date,Dragging:!0},Smart.Tree.treeItemDragged=!0,r.$.scrollViewer._scrollView.disableSwipeScroll=!0,r.allowDrop&&(Smart.Tree.hoveredTree=r,Smart.Tree.hoveredItem=e)}_startEditing(e){const t=this,r=t.$.editInput;let l,o;if(!t._canItemBeSelected(e))return;const n=e.firstElementChild,a=n.firstElementChild;t.rightToLeft?(l=function(){return n.offsetWidth-a.offsetLeft-a.offsetWidth},o="paddingRight"):(l=function(){return a.offsetLeft+parseFloat(window.getComputedStyle(n).borderLeftWidth)},o="paddingLeft"),e instanceof Smart.TreeItemsGroup?(r.style[o]=l()+(t.showLines?parseFloat(window.getComputedStyle(a.firstElementChild).paddingLeft):0)-1+"px",r.style.height=n.offsetHeight+"px"):(r.style[o]=e.offsetWidth+parseInt(n.style[o],10)-n.offsetWidth+parseFloat(window.getComputedStyle(a.firstElementChild).paddingLeft)-2+"px",r.style.height=e.offsetHeight+"px"),r.style.top=t._getOffsetTop(e)+"px",t.$editInput.removeClass("smart-hidden"),r.value=e.label,t._editedItem=e,setTimeout(function(){r.focus()},0)}_styleChangedHandler(e){e.detail.styleProperties&&e.detail.styleProperties["font-size"]&&this._checkOverflow()}_updateScrollButtonVisibility(){var e=Math.round;const t=this,r=t.overflow;if("scrollbar"===t.scrollMode||"hidden"===r)return;let l=!0,o=!0;if(0===e(t.$.scrollViewer.scrollTop)&&(l=!1),e(t.$.scrollViewer.$.scrollViewerContainer.offsetHeight+t.$.scrollViewer.scrollTop)>=e(t.$.scrollViewer.$.scrollViewerContentContainer.offsetHeight)&&(o=!1),"auto"===r){if(l&&o)return t.$scrollButtonNear.removeClass("smart-hidden"),t.$scrollButtonFar.removeClass("smart-hidden"),t.$scrollViewer.removeClass("one-button-shown"),void t.$.scrollViewer.refresh();l?t.$scrollButtonNear.removeClass("smart-hidden"):t.$scrollButtonNear.addClass("smart-hidden"),o?t.$scrollButtonFar.removeClass("smart-hidden"):t.$scrollButtonFar.addClass("smart-hidden"),t.$scrollViewer.addClass("one-button-shown"),t.$.scrollViewer.refresh()}else"scroll"!==r||t.disabled||(t.$.scrollButtonNear.disabled=!l,t.$.scrollButtonFar.disabled=!o)}_updateState(e,t,r){const l=this;switch(e){case"expanded":{const e=l._state.expanded.indexOf(t);if(r&&-1===e)l._state.expanded.push(t);else if(!r&&-1!==e)l._state.expanded.splice(e,1);else return;break}case"filter":l._state.filter=t===void 0?l.$.filterInput.value:t;break;case"selected":l._state.selected=[];for(let e=0;e<l.selectedIndexes.length;e++){const t=l._menuItems[l.selectedIndexes[e]];l._state.selected.push(t.id)}break;case"sorted":l._state.sorted=t;}l.autoSaveState&&window.localStorage.setItem("smartTree"+l.id,JSON.stringify(l._state))}_verticalScrollbarHandler(){const e=this,t=e.$.verticalScrollBar,r=t.value;return e.disabled?void 0:t.max===r?void(e._bottomReached||(e.$.fireEvent("scrollBottomReached"),delete e._topReached,e._bottomReached=!0)):t.min===r?void(e._topReached||(e.$.fireEvent("scrollTopReached"),delete e._bottomReached,e._topReached=!0)):void(delete e._topReached,delete e._bottomReached)}});