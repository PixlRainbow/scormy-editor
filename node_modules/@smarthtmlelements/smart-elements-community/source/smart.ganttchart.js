
/* Smart HTML Elements v4.6.0 (2019-Oct) 
Copyright (c) 2011-2019 jQWidgets. 
License: https://htmlelements.com/license/ */

Smart("smart-gantt-chart",class extends Smart.ScrollViewer{static get properties(){return{autoSchedule:{value:!1,type:"boolean"},autoScheduleStrictMode:{value:!1,type:"boolean"},autoScrollStep:{value:5,type:"number"},dataSource:{value:[],type:"array",reflectToAttribute:!1},dayFormat:{value:"short",allowedValues:["2-digit","numeric","long","short","narrow"],type:"string"},dateEnd:{value:"",type:"any",validator:"_dateValidator"},dateStart:{value:"",type:"any",validator:"_dateValidator"},disableAutoScroll:{value:!1,type:"boolean"},durationUnit:{value:"milisecond",allowedValues:["day","week","hour","minute","second","milisecond"],type:"string"},inverted:{value:!1,type:"boolean"},messages:{extend:!0,value:{en:{incorrectArgument:"{{elementType}}: Incorrect argument {{argumentName}} in method {{methodName}}.",outOfBounds:"{{elementType}}: Out of bounds argument {{argumentName}} in method {{methodName}}.",missingReference:"{{elementType}}: Missing reference to {{file}} in method {{methodName}}.",noId:"smartGanttChart requires an id in order to save/load/clear a state.",ok:"Ok",cancel:"Cancel",delete:"Delete",confirm:"{{componentName}} will be deleted permanently, <b>are you sure? </b>",columnLabel:"Task Name"}},type:"object"},monthFormat:{value:"short",allowedValues:["2-digit","numeric","long","short","narrow"],type:"string"},max:{value:new Date(2100,0,1),type:"any",validator:"_dateValidator"},min:{value:new Date(1900,0,1),type:"any",validator:"_dateValidator"},nonworkingDays:{value:[],type:"array"},nonworkingHours:{value:[],type:"array"},popupWindowCustomizationFunction:{value:null,reflectToAttribute:!1,type:"function?"},resizeHandlesVisibility:{allowedValues:["auto","hidden","visible"],value:"auto",type:"string"},selectedIndexes:{value:[],type:"array"},snapToNearest:{value:!1,type:"boolean"},taskColumns:{value:[{label:"columnLabel",value:"label"}],type:"array",reflectToAttribute:!1},timelineMin:{value:200,type:"any"},treeMin:{value:100,type:"any"},treeSize:{value:"20%",type:"any"},hourFormat:{value:"default",allowedValues:["default","2-digit","numeric"],type:"string"},timelineHeaderFormatFunction:{value:null,reflectToAttribute:!1,type:"function?"},verticalScrollBarVisibility:{type:"string",value:"auto",allowedValues:["auto","disabled","hidden","visible"]},view:{value:"year",allowedValues:["day","week","month","year"],type:"any"},yearFormat:{value:"numeric",allowedValues:["2-digit","numeric"],type:"string"},weekFormat:{value:"long",allowedValues:["long","numeric"],type:"string"}}}template(){return`<div id="container">
                    <smart-splitter id="mainSplitter" auto-fit-mode="end" keep-proportions-on-resize>
                        <smart-splitter-item id="treeSplitterItem" class="smart-task-tree-splitter-item" min="[[treeMin]]">
                            <smart-splitter id="treeSplitter" auto-fit-mode="end" class="smart-task-tree-splitter" unfocusable>
                                <smart-splitter-item id="taskTreeSplitterItem">
                                    <div class="smart-task-tree-header"></div>
                                    <div class="smart-task-tree-content">
                                        <smart-tree id="taskTree" selection-mode="zeroOrOne" overflow="hidden" toggle-mode="arrow"></smart-tree>
                                    </div>
                                </smart-splitter-item>                               
                            <smart-splitter>
                        </smart-splitter-item>
                        <smart-splitter-item id="timelineSplitterItem" class="smart-timeline-splitter-item" min="[[timelineMin]]">
                                <div id="timeline" class="smart-timeline">
                                    <div id="timelineContainer" class="smart-timeline-container">
                                        <div id="timelineHeader" class="smart-timeline-header">
                                            <div class="smart-timeline-view-details" id="timelineViewDetails"></div>
                                            <div class="smart-timeline-view-cells" id="timelineViewCells"></div>
                                        </div>
                                        <div id="timelineContent" class="smart-timeline-content">
                                            <div id="timelineCellsContainer" class="smart-timeline-cells-container"></div>
                                            <div id="timelineConnectionsContainer" class="smart-timeline-connections-container"></div>
                                            <div id="timelineTasksContainer" class="smart-timeline-tasks-container"></div>
                                        </div>
                                        <div id="timelineAnimationContainer" class="smart-timeline-animation-container smart-visibility-hidden">
                                            <div class="smart-timeline-animation-inner-container">
                                                <div><div></div><div></div></div><div><div></div><div></div></div><div><div></div><div></div></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <smart-scroll-bar id="verticalScrollBar" class="smart-timeline-scroll-bar" orientation="vertical" ></smart-scroll-bar>
                        </smart-splitter-item>
                    </smart-splitter>
                    <smart-scroll-bar wait id="horizontalScrollBar" class="smart-timeline-scroll-bar"></smart-scroll-bar>
                </div>`}static get listeners(){return{down:"_downHandler","document.move":"_documentMoveHandler","document.up":"_documentUpHandler","document.dragstart":"_dragStartHandler","container.wheel":"_mouseWheelandler","horizontalScrollBar.change":"_horizontalScrollbarHandler","verticalScrollBar.change":"_verticalScrollbarHandler","mainSplitter.resizeEnd":"_resizeEventHandler",move:"_moveHandler",resize:"_resizeEventHandler","taskTree.change":"_taskTreeChangeHandler","taskTree.collapse":"_taskTreeExpandHandler","taskTree.expand":"_taskTreeExpandHandler","taskTree.blur":"_taskTreeBlurHandler","timelineAnimationContainer.transitionend":"_timelineAnimationContainerTransitionendHandler"}}static get styleUrls(){return["smart.ganttchart.css"]}attached(){const e=this;super.attached(),e._scrollView||(e._scrollView=new Smart.Utilities.Scroll(e,e.$.horizontalScrollBar,e.$.verticalScrollBar));const t=["taskPopupWindow","connectionPopupWindow","confirmPopupWindow"];for(let a=0;a<t.length;a++){const i=t[a];e.$[i]&&e.$[i].opened&&(e._handleModal(!0),e["$"+i].listen("close",e._popupWindowCloseHandler.bind(e)),e["$"+i].listen("closing",e._popupWindowClosingHandler.bind(e)),e["$"+i].listen("open",e._popupWindowOpenHandler.bind(e)),e["$"+i].listen("click",e._popupWindowClickHandler.bind(e)),e["$"+i].listen("transitionend",e._popupWindowTransitionendHandler.bind(e)),document.body.appendChild(e.$[i]))}}detached(){const e=this;super.detached(),e._scrollView&&(e._scrollView.unlisten(),delete e._scrollView);const t=["taskPopupWindow","connectionPopupWindow","confirmPopupWindow"];e._handleModal();for(let a=0;a<t.length;a++){const i=t[a];e.$[i]&&e.$[i].parentElement&&e.$[i].parentElement.removeChild(e.$[i]),e["$"+i]&&(e["$"+i].unlisten("open"),e["$"+i].unlisten("close"),e["$"+i].unlisten("closing"),e["$"+i].unlisten("transitionend"))}}propertyChangedHandler(e,t,a){const i=this;switch(e){case"autoSchedule":a?i._autoSchedule():i._autoScheduleRestore();break;case"autoScheduleStrictMode":a&&(i._autoSchedule(),i._refreshTimeline(i.view));break;case"dataSource":i.$.mainSplitter._resizeEventHandler(),i._createTasks(),i._createTimeline(),i._createTaskColumns(),i._refresh();break;case"durationUnit":for(let e=0;e<i._tasks.length;e++){const t=i._tasks[e];i._validateTaskProperties(t,t.project)}i._createTimelineCells();for(let e=0;e<i._tasks.length;e++){const t=i._tasks[e];i._setTimelineTaskBar(t,!0),i._refreshTaskConnections(t)}break;case"inverted":i._handleInverted();break;case"dateStart":case"dateEnd":case"nonworkingDays":case"nonworkingHours":i._refreshTimeline();break;case"locale":case"dayFormat":case"hourFormat":case"timelineHeaderFormatFunction":case"monthFormat":case"yearFormat":i._refreshHeaderDate(),i._refreshColumnsHeaders();break;case"selectedIndexes":i._applySelection(t);break;case"taskColumns":i._createTaskColumns();break;case"timelineMin":i.$.timelineSplitterItem.min=a,i.$.treeSplitter.refresh();break;case"treeMin":i.$.treeSplitterItem.min=a,i.$.treeSplitter.refresh();break;case"treeSize":i.$.treeSplitterItem.size=a,i.$.treeSplitter.refresh();break;case"unfocusable":i._setFocusable();break;case"view":i._refreshTimeline(t);break;default:super.propertyChangedHandler(e,t,a);}}_predefPropertyGetter(e){const t=this;Object.defineProperty(t,e,{get:function(){const a=t._timelineCells;return a.length?new Date("dateStart"===e?a[0].date:a[a.length-1].date):void t.properties[e].value},set(a){t.updateProperty(t,t._properties[e],a)}})}ready(){super.ready()}render(){const e=this;e._predefPropertyGetter("dateStart"),e._predefPropertyGetter("dateEnd"),e.shadowRoot?requestAnimationFrame(()=>e.$.treeSplitterItem.size=e.treeSize):e.$.treeSplitterItem.size=e.treeSize,e.$.taskTree._ensureVisibleCallback=e._ensureVisible.bind(e),e.$.taskTree._hoverViaKeyboardCallback=e._hoverViaKeyboardCallback.bind(e),e.$.taskTree._waitAnimation=!0,e.$.taskTree.$.scrollViewer._scrollView.disableSwipeScroll=!0,e.$.taskTree.$.scrollViewer.disabled=!0,e._setScrollBars(),e.$.treeSplitter.refresh(),e._handleInverted(!0),e._createTasks(),e._createTaskColumns(),e._createTimeline(),e._applySelection(),e._setFocusable(),e.checkLicense(),e.shadowRoot&&requestAnimationFrame(()=>e.refresh()),super.render()}refresh(){this._resizeEventHandler()}static get requires(){return{"Smart.Splitter":"smart.splitter.js","Smart.Tree":"smart.tree.js","Smart.Window":"smart.window.js"}}ensureVisible(e){const t=this,a=t._tasks;if(void 0!==e&&null!==e&&a.length){if("number"==typeof e)e=a[e];else if("string"==typeof e)e=t._tasks.indexOf(t._getTaskByTreeIndex(e));else return;e&&(t._ensureVisible(e),t._scrollTo(e.dateStart))}}removeAllConnections(){const e=this;e.isCompleted&&(e.$.timelineConnectionsContainer.innerHTML="",e._tasks.map(e=>e.connections=[]))}removeConnection(){const e=this;if(!e.isCompleted)return;let t;if(1===arguments.length){if("string"==typeof arguments[0]){const e=document.getElementById(arguments[0]);e&&(t=e.getAttribute("connection-id"))}t||(t=(arguments[0]+"").split("-"),t=e._getValidConnectionId(t[0],t[1],t[2],"removeConnection"))}else 3===arguments.length&&(t=e._getValidConnectionId(arguments[0],arguments[1],arguments[2],"removeConnection"));t&&e._removeConnection(t)}removeTaskConnection(e,t){const a=this;if(a.isCompleted){if(e+="",-1<e.indexOf("-")&&!t){const a=e.split("-");t=a[1],e=a[0]}return e=a._getTaskIndexById(e),t=a._getTaskIndexById(t),isNaN(e)?void a.error(a.localize("incorrectArgument",{elementType:a.nodeName.toLowerCase(),methodName:"removeTaskConnection",argumentName:"taskEndIndex"})):void a._removeConnection(""+e+(isNaN(t)?"":t))}}clearTasks(){const e=this;e._tasks=[],e._timelineCells=[],e._timelineHeaderCells=[],e.$.timelineContent.style.width=e.$.timelineAnimationContainer.style.width="",e.$.container.style.removeProperty("--smart-gantt-chart-timeline-content-height"),e.$.timelineViewDetails.innerHTML="",e.$.timelineViewCells.innerHTML="",e.$.timelineCellsContainer.innerHTML="",e.$.timelineConnectionsContainer.innerHTML="",e.$.timelineTasksContainer.innerHTML="";const t=e.$.treeSplitter._items;for(let a=0;a<t.length;a++){const i=t[a];if(i===e.$.taskTreeSplitterItem)e.$.taskTree.dataSource=[];else{const e=i.getElementsByClassName("smart-task-tree-content")[0];e&&(e.innerHTML="")}}e._refresh()}createConnection(){const e=this,t=e._tasks;let a;e.isCompleted&&0!==t.length&&(1===arguments.length?a=(arguments[0]+"").split("-"):3===arguments.length&&(a=arguments),a=e._getValidConnectionId(a[0],a[1],a[2],"createConnection"),a&&e._connectTask(a))}collapse(e){const t=this;return"number"==typeof e&&(e=t.$.taskTree.querySelectorAll("smart-tree-item, smart-tree-items-group")[e]),void 0===e?void t.error(t.localize("incorrectArgument",{elementType:t.nodeName.toLowerCase(),methodName:"collapse",argumentName:"taskIndex"})):void t.$.taskTree.collapseItem(e instanceof Smart.TreeItemsGroup?e:e.parentItem)}expand(e){const t=this;return"number"==typeof e&&(e=t.$.taskTree.querySelectorAll("smart-tree-item, smart-tree-items-group")[e]),void 0===e?void t.error(t.localize("incorrectArgument",{elementType:t.nodeName.toLowerCase(),methodName:"expand",argumentName:"taskIndex"})):void t.$.taskTree.expandItem(e instanceof Smart.TreeItemsGroup?e:e.parentItem)}exportToXLSX(e){const t=this;if(!Smart.Utilities.DataExporter)return void t.error(t.localize("missingReference",{elementType:t.nodeName.toLowerCase(),methodName:"exportToXLSX",file:"DataExporter"}));try{new JSZip}catch(e){return void t.error(t.localize("missingReference",{elementType:t.nodeName.toLowerCase(),methodName:"exportToXLSX",file:"JSZip"}))}const a=t._tasks,i=t.taskColumns;if(!a||!a.length||!i.length)return;const n=new Smart.Utilities.DataExporter({style:e&&e.styles||{border:"1px solid black",borderCollapse:"collapse",header:{height:"50px",border:"1px solid black",fontSize:"16px",fontWeight:"bold",firstName:{width:"300px"},lastName:{width:"300px"},birthday:{width:"400px"},price:{textAlign:"right",width:"150px"},quantity:{textAlign:"right"},timeOfPurchase:{width:"300px"},expired:{textAlign:"center"}},columns:{border:"1px solid black",birthday:{format:"D"},price:{textAlign:"right",format:"c2"},quantity:{textAlign:"right"},timeOfPurchase:{format:"T"},expired:{textAlign:"center"}},rows:{alternationCount:3,alternationStart:0,alternationIndex0Color:"#FFFFFF",alternationIndex0BackgroundColor:"#000000",alternationIndex1Color:"#CCCCCC",alternationIndex1BackgroundColor:"#555555",alternationIndex2Color:"#000000",alternationIndex2BackgroundColor:"#FFFFFF",3:{backgroundColor:"#FF0034"}}},hierarchical:!0,expandChar:e&&e.expandChar||"\u25BC",collapseChar:e&&e.collapseChar||"\u25B2",pageOrientation:e&&e.pageOrientation}),s=function(e){let t={};for(let a=0;a<i.length;a++){const n=i[a];t[n.value]=e?e[n.value]:n.label}return t};let l=[];const r=s();let o={columns:[]};for(let t in r)o.columns.push({label:r[t],dataField:t});n.header=o,l.push(r);for(let i=0;i<a.length;i++){const e=a[i],t=s(e);l.push(t)}n.exportData(l,"xlsx",e&&e.fileName||"ganttChart")}getState(){return this._getTasksJSON()}get tasks(){const e=this;return e.isReady&&e._tasks&&e._tasks.length?e._tasks:void 0}getTaskIndex(e){const t=this;return e instanceof Smart.TreeItem||e instanceof Smart.TreeItemsGroup?[].slice.call(t.$.taskTree.querySelectorAll("smart-tree-item, smart-tree-items-group")).indexOf(e):t._tasks?e instanceof HTMLElement&&e.classList.contains("smart-timeline-task")?t._tasks.index(e._task):t._tasks.index(e):void 0}clearState(){const e=this;return e.id?void window.localStorage.removeItem("smartGanttChart"+e.id):void e.warn(e.localize("noId"))}loadState(e){const t=this;if(!e){if(!t.id)return;e=JSON.parse(window.localStorage.getItem("smartGanttChart"+t.id))}Array.isArray(e)&&(t._createTasks(e),t._createTimeline(),t._createTaskColumns(),t.set("dataSource",e))}saveState(){const e=this;return e.id?void window.localStorage.setItem("smartGanttChart"+e.id,JSON.stringify(e.getState())):void e.warn(e.localize("noId"))}insertTask(e,t){const a=this;if("object"!=typeof t)return void a.error(a.localize("incorrectArgument",{elementType:a.nodeName.toLowerCase(),methodName:"insertTask",argumentName:"newTask"}));if(!a._tasks)return;const n=a._tasks.slice(0);let i;if("string"==typeof e)i=a._getTaskByTreeIndex(e),e=a._tasks.indexOf(i);else if("number"==typeof e)i=a._tasks[e];else return void a.error(a.localize("incorrectArgument",{elementType:a.nodeName.toLowerCase(),methodName:"insertTask",argumentName:"index"}));i||(e=a._tasks.length);const s=a._createTasks([t],!0);a.$.timelineConnectionsContainer.innerHTML="";for(let a=0;a<n.length;a++){const t=n[a];if(t.connections)for(let a=0;a<t.connections.length;a++){const i=t.connections[a];"number"==typeof i.target&&i.target>=e&&(i.target+=s.length)}}for(let a=0;a<s.length;a++)n.splice(e+a,0,s[a]);if(i&&i.project){t.project=i.project;for(let e=0;e<s.length;e++)i.project.tasks.splice(i.project.tasks.indexOf(i),0,s[e])}a._tasks=n,a._taskAPIManipulation=!0;const l=a.$.treeSplitter._items;for(let n=0;n<l.length;n++){const i=l[n];if(a.$.taskTreeSplitterItem===i)a.$.taskTree.insert(t,"number"==typeof e?a.$.taskTree.querySelectorAll("smart-tree-item, smart-tree-items-group")[e]:e);else{const s=i.getElementsByClassName("smart-task-tree-content")[0],l=a.taskColumns[n];if(!s||!l||!l.value)continue;const r=s.getElementsByClassName("smart-task-item")[e];r?r.parentElement.insertBefore(a._createTaskContainers([t],l),r):s.appendChild(a._createTaskContainers([t],l))}}a._autoSchedule(s),a._noAnimation=!0;for(let n=0;n<s.length;n++){const t=s[n];a._createTimelineTask(t,e+n),a._setTaskBarProgress(t),a._setTaskBarLabel(t),!a._expandTask(t)}delete a._noAnimation,a._refreshTimeline(a.view),a.$.container.style.setProperty("--smart-gantt-chart-timeline-content-height",a.$.timelineCellsContainer.offsetHeight+"px");const r=a.$.taskTree.selectedIndexes[0];r&&a._selectTask(a._getTaskByTreeIndex(r)),delete a._taskAPIManipulation}openWindow(e){const t=this;if("string"==typeof e){let e=(arguments[0]+"").split("-");if(e=t._getValidConnectionId(e[0],e[1],e[2],"openEditor"),e)return void t._openPopupWindow(t.$.timelineConnectionsContainer.querySelector(".smart-task-connection[connection-id^=\""+e+"\"]"))}const a=t._getTaskIndexById(e);if(-1<a)return void t._openPopupWindow(t.$.timelineTasksContainer.children[a])}closeWindow(){const e=this,t=["confirm","task","connection"];for(let a=0;a<t.length;a++){const i=e.$[t[a]+"PopupWindow"];i&&(i.close(),delete i._target)}}updateTask(e,t){const a=this,i=a._tasks;let n;if(("string"==typeof e&&(e=a._tasks.indexOf(a._getTaskByTreeIndex(e)),n=i[e]),"number"==typeof e?n=a._tasks[e]:"object"==typeof e&&(n=e,e=i.indexOf(e)),"object"==typeof t)&&void 0!==n&&void 0!==e&&null!==e&&i&&i.length){e=Math.max(0,Math.min(i.length-1,e));const s=a.$.timelineTasksContainer.children[e];for(let e in t){let a=n[e],i=t[e];i instanceof Date&&i.getTime()===new Date(a).getTime()||i===a||(s&&"class"==e&&(s.classList.remove(n.class),i&&s.classList.add(i)),!("project"===n.type&&"type"==e||"project"===n.type&&n.synchronized&&(-1<e.toLowerCase().indexOf("date")||-1<e.toLowerCase().indexOf("duration"))))&&("dateEnd"==e&&(n.duration=void 0),n[e]=i,"milestone"===n.type&&("dateStart"==e||"dateEnd"==e)&&(n.dateEnd=n.dateStart=i))}a._validateTaskProperties(n,n.project),a._setTaskBarProgress(n),a._setTaskBarLabel(n),a._refreshTimeline(a.view),a._refreshTaskColumnsData(n),a._refreshTaskConnections(n),a._autoSchedule()}}removeTask(e){const t=this,a=t._tasks.slice(0);let i;if("string"==typeof e)i=t._getTaskByTreeIndex(e),e=t._tasks.indexOf(i);else if("number"==typeof e)i=t._tasks[e];else return void t.error(t.localize("incorrectArgument",{elementType:t.nodeName.toLowerCase(),methodName:"insertTask",argumentName:"index"}));if(!i)return;t._taskAPIManipulation=!0,t._removeConnection(e),t._removeConnectionsToTask(e,a);let n=1;if("project"===i.type){const e=i.tasks,s=a.slice(0);for(let l=e.length-1;-1<l;l--){const i=s.indexOf(e[l]);t._removeConnectionsToTask(i,s,e),t._removeConnection(i),t.$.timelineTasksContainer.removeChild(t.$.timelineTasksContainer.children[i]),t.$.timelineCellsContainer.removeChild(t.$.timelineCellsContainer.children[i]),a.splice(i,1),e.splice(i,1),n++}}i.project&&i.project.tasks.splice(i.project.tasks.indexOf(i),1+(i.tasks?i.tasks.length:0)),a.splice(a.indexOf(i),1),t.$.timelineTasksContainer.removeChild(t.$.timelineTasksContainer.children[e]),t.$.timelineCellsContainer.removeChild(t.$.timelineCellsContainer.children[e]);const s=t.$.treeSplitter._items;for(let a=0;a<s.length;a++){const i=s[a];if(t.$.taskTreeSplitterItem===i)t.$.taskTree.removeItem(t.$.taskTree.querySelectorAll("smart-tree-item, smart-tree-items-group")[e]);else{const n=i.getElementsByClassName("smart-task-tree-content")[0],s=t.taskColumns[a];if(!n||!s||!s.value)continue;const l=n.getElementsByClassName("smart-task-item")[e];l&&l.parentElement.removeChild(l)}}for(let s=0;s<a.length;s++){const i=a[s];if(i.connections)for(let a=0;a<i.connections.length;a++){const l=i.connections[a],r=t._getTaskIndexById(l.target);if(r>=e){const a=t.$.timelineConnectionsContainer,o=a.querySelectorAll(".smart-task-connection[connection-id^=\""+(s>=e?s+n:s)+"-"+r+"\"]");for(let e=0;e<o.length;e++)a.removeChild(o[e]);"number"==typeof l.target&&(l.target-=n)}}}t.$.container.style.setProperty("--smart-gantt-chart-timeline-content-height",t.$.timelineCellsContainer.offsetHeight+"px"),t._tasks=a,t._refreshTimeline(t.view),t.$.treeSplitter._resizeEventHandler();const l=t.$.taskTree.selectedIndexes[0];l&&t._selectTask(t._getTaskByTreeIndex(l)),delete t._taskAPIManipulation}_getValidConnectionId(e,t,a,i){const n=this,s=n._tasks,l=0===i.indexOf("_");let r;return"string"==typeof e&&(r=n._getTaskIndexById(e),0<=r&&(e=r)),"string"==typeof t&&(r=n._getTaskIndexById(t),0<=r&&(t=r)),e=parseInt(e),t=parseInt(t),a=parseInt(a),isNaN(e)||isNaN(t)||e===t?void(l||n.error(n.localize("incorrectArgument",{elementType:n.nodeName.toLowerCase(),methodName:i,argumentName:"taskIndex"}))):e>=s.length||0>e||t>=s.length||0>t?void(l||n.error(n.localize("outOfBounds",{elementType:n.nodeName.toLowerCase(),methodName:i,argumentName:"taskIndex"}))):isNaN(a)||0>a||3<a?void(l||n.error(n.localize("incorrectArgument",{elementType:n.nodeName.toLowerCase(),methodName:i,argumentName:"connectionType"}))):l?[e,t,a]:e+"-"+t+"-"+a}_applySelection(e){const t=this,a=t.selectedIndexes.slice(0);let n=[];e&&0<e.length&&(n=e.filter(e=>t._tasks[e])),t._taskAPIManipulation=!0;for(let s,l=0;l<a.length;l++)s=a[l],s="string"==typeof s&&-1<s.indexOf(".")?t._getTaskByTreeIndex(s):t._tasks[s],s&&0>n.indexOf(s)&&t._selectTask(s);a.length||t._selectTask(),delete t._taskAPIManipulation,e&&t.$.fireEvent("change",{value:a,oldValue:e})}_autoSchedule(e){const a=this,t=a._tasks;if(a.autoSchedule){e?!Array.isArray(e)&&(e=[e]):e=t;for(let i=0;i<e.length;i++){const t=e[i];t.minDateStart=t.minDateEnd=void 0,a._autoScheduleTasks(t)}if(a._isUpdateRequired){a._createTimelineCells();for(let e=0;e<t.length;e++)a._setTimelineTaskBar(t[e],!0),a._refreshTaskConnections(t[e]);delete a._isUpdateRequired}}}_autoScheduleTasks(e){var t=Math.max;const a=this,n=a._tasks,i=n.indexOf(e),s=e.connections;for(let t=0;t<s.length;t++)a._isAutoScheduled({_task:e},{_task:n[a._getTaskIndexById(s[t].target)]},!0);const l=a._getConnectedTasks(i);let r,o,d;for(let n=0;n<l.length;n++){const s=l[n],m=s.connections.find(e=>a._getTaskIndexById(e.target)===i),c=m.type,g=m.lag||0;0===c||1===c?(d=new Date((0===c?s.dateStart:s.dateEnd).getTime()+g),e.minDateStart=new Date(e.minDateStart?t(e.minDateStart.getTime(),d.getTime()):d),o=e.minDateStart.getTime()-e.dateStart.getTime(),r=new Date(e.dateEnd.getTime()+(a.autoScheduleStrictMode?o:t(0,o))),r.getTime()!==e.dateEnd.getTime()&&(e.dateEnd=r,a._isUpdateRequired=!0),a.autoScheduleStrictMode&&e.minDateStart.getTime()!==e.dateStart.getTime()&&(e.dateStart=e.minDateStart,a._isUpdateRequired=!0)):(d=new Date((2===c?s.dateEnd:s.dateStart).getTime()+g),e.minDateEnd=new Date(e.minDateEnd?Math.min(e.minDateEnd.getTime(),d.getTime()):d),o=e.minDateEnd.getTime()-e.dateEnd.getTime(),r=new Date(e.dateStart.getTime()+(a.autoScheduleStrictMode?o:t(0,o))),r.getTime()!==e.dateStart.getTime()&&(e.dateStart=r,a._isUpdateRequired=!0),a.autoScheduleStrictMode&&e.minDateEnd.getTime()!==e.dateEnd.getTime()&&(e.dateEnd=e.minDateEnd,a._isUpdateRequired=!0)),a._validateTaskProperties(e,e.project)}for(let i=0;i<s.length;i++){const e=n[s[i].target];e&&(e.minDateStart=e.minDateEnd=void 0,a._autoScheduleTasks(e))}}_getConnectedTasks(e){const t=this,a=t._tasks;if(a&&0!==a.length){let t=[];for(let n=0;n<a.length;n++){const i=a[n],s=i.connections;if(s)for(let a=0;a<s.length;a++)s[a].target===e&&t.push(i)}return t}}_autoScheduleRestore(e,t){const a=this,n=a._tasks;e||(e=n),Array.isArray(e)||(e=[e]);for(let a=0;a<e.length;a++){const i=e[a];-1<n.indexOf(e[a])&&(t?0===t||1===t?i.minDateStart=void 0:i.minDateEnd=void 0:i.minDateStart=i.minDateEnd=void 0)}}_autoScroll(e){function t(t){return a._dragDetails?void(a._autoScrolling=!0,a.scrollLeft-=a.autoScrollStep*t,a._dragDetails.coordinates.x+=a.autoScrollStep*t,a.hasAttribute("dragged")?a._handleTaskBarDrag(e):a.hasAttribute("resized")&&a._handleTaskBarResize(e)):(clearInterval(a._scrollInterval),a._scrollInterval=void 0,void delete a._autoScrolling)}const a=this;if(a.disableAutoScroll||!e||!a.hasAttribute("dragged")&&!a.hasAttribute("resized")&&!a.hasAttribute("connecting-task"))return;const i=a.$.timeline.getBoundingClientRect();a._scrollInterval&&clearInterval(a._scrollInterval),a._scrollInterval=setInterval(function(){a.scrollLeft&&e.clientX<=i.left+20?t(1):a.scrollLeft!==a.scrollWidth&&e.clientX>=i.left+i.width-20?t(-1):(clearInterval(a._scrollInterval),a._scrollInterval=void 0,delete a._autoScrolling)},1)}_checkTaskBarResizability(e){var t=Math.round,a=Math.min;const i=this;let n=e.originalEvent.target;i.shadowRoot&&n===i&&(n=e.originalEvent.composedPath()[0]);const s=i.$.timeline;let l,r=n.closest(".smart-timeline-task-cell")||n.closest(".smart-timeline-task");if(r&&s.contains(r)&&(r.classList.contains("smart-timeline-task-cell")?l=i.$.timelineTasksContainer.children[i._tasks.indexOf(r._task)]:r.classList.contains("smart-timeline-task")&&(l=r,r=i.$.timelineCellsContainer.children[i._tasks.indexOf(r._task)]),!(!l||l.classList.contains("milestone")||l._task.synchronized||l._task.disableResize))){if(n.classList&&n.classList.contains("smart-task-connection-point"))return void s.removeAttribute("task-bar-hovered");const o=e.pageX-window.pageXOffset,d="visible"===i.resizeHandlesVisibility||Smart.Utilities.Core.isMobile?20:5,m=l.getBoundingClientRect(),c=r.getBoundingClientRect(),g=a(d,o-c.left),p=a(d,c.left+c.width-o);t(m.left)+g>=o&&t(m.left)-g<=o?s.setAttribute("task-bar-hovered","left"):t(m.left+m.width)+p>=o&&t(m.left+m.width)-p<=o?s.setAttribute("task-bar-hovered","right"):s.removeAttribute("task-bar-hovered")}}_onShadowDomLoaded(e,t,a){function i(){const n=(e.shadowRoot||e.getRootNode()).querySelectorAll("link");for(let e=0;e<n.length;e++)if(-1!==n[e].href.indexOf(t))return void a();requestAnimationFrame(i)}this;requestAnimationFrame(i)}_openPopupWindow(e,t){function a(){function t(){const e=n.getBoundingClientRect();l.style.left=i(e.left+window.pageXOffset,e.left+window.pageXOffset+e.width/2-l.offsetWidth/2)+"px",l.style.top=i(e.top+window.pageYOffset,e.top+window.pageYOffset+e.height/2-l.offsetHeight/2)+"px",l.opened?(l.bringToFront(),l._handleActiveState()):l.open()}if(n.popupWindowCustomizationFunction&&n.popupWindowCustomizationFunction(l,s,n._tasks.indexOf(e._task)),n._setPopupWindowTemplate("header",s,e),n._setPopupWindowTemplate("footer",s,e),n._setPopupWindowTemplate("content",s,e),!n._popupWindow[s+"PopupWindow"]){const e=n["$"+s+"PopupWindow"];e.unlisten("transitionend"),e.unlisten("open"),e.unlisten("close"),e.unlisten("closing"),e.unlisten("click"),e.listen("transitionend",n._popupWindowTransitionendHandler.bind(n)),e.listen("open",n._popupWindowOpenHandler.bind(n)),e.listen("close",n._popupWindowCloseHandler.bind(n)),e.listen("closing",n._popupWindowClosingHandler.bind(n)),e.listen("click",n._popupWindowClickHandler.bind(n))}l.shadowRoot?(l.importStyle(Smart.Utilities.Core.getScriptLocation()+Smart.StyleBaseUrl.replace("/scoped/","/smart.textbox.css")),n._onShadowDomLoaded(l,"smart.window.css",t)):t(),n._popupWindow[s+"PopupWindow"]=l}var i=Math.max;const n=this;if(!e)return;if(!t){const e=n.$.fireEvent("opening").defaultPrevented;if(e)return}const s=t?"confirm":e.classList.contains("smart-task-connection")?"connection":"task",l=n._createPopupWindow(s);l._target=e,l.parentElement||document.body.appendChild(l),n._popupWindow||(n._popupWindow={}),l.isCompleted?a():l.whenReady(()=>a())}_createPopupWindow(e){const t=this,a=e+"PopupWindow";if(t.$[a])return t.$[a];const i=document.createElement("smart-window");return i.classList.add("smart-"+e+"-popup-window"),i.classList.add("smart-gantt-chart-popup-window"),i.setAttribute("smart-id",a),t.$[a]=i,t["$"+a]=Smart.Utilities.Extend(i),i.theme=t.theme,i.animation=t.animation,i.disableSnap=!0,i.headerButtons=["close"],i}_popupWindowOpenHandler(e){const t=this,a=t["$"+e.target.getAttribute("smart-id")];a&&(t._handleModal(!0),t.$.fireEvent(e.type,e.detail),a.unlisten("open"))}_popupWindowClosingHandler(e){const t=this,a=e.target.getAttribute("smart-id"),i=t["$"+a],n=t.$.fireEvent(e.type,e.detail);n.defaultPrevented&&e.preventDefault(),i.unlisten(e.type)}_popupWindowCloseHandler(e){const t=this,a=e.target.getAttribute("smart-id"),i=t["$"+a];if(i){t._handleModal(),t.$.fireEvent(e.type,e.detail),i.unlisten("close"),i.unlisten("click"),delete t._popupWindow[a];const n=Object.keys(t._popupWindow);if(1===n.length&&t._popupWindow.confirmPopupWindow)return delete t._popupWindow.confirmPopupWindow._target,void t._popupWindow.confirmPopupWindow.close();"confirmPopupWindow"===a&&n.length&&requestAnimationFrame(()=>{t._popupWindow[n[n.length-1]].focus(),e.target.bringToFront()})}}_popupWindowTransitionendHandler(e){const t=this,a=e.target;a.opened||"visibility"!==e.propertyName||(t["$"+a.getAttribute("smart-id")].unlisten("transitionend"),a.parentElement&&a.parentElement.removeChild(a))}_handleModal(e){const t=this;let a=(t.shadowRoot||t).querySelector(".smart-popup-window-modal");e?(!a&&(a=document.createElement("div"),a.classList.add("smart-popup-window-modal")),!a.parentElement&&t.$.container.appendChild(a)):a&&a.parentElement&&2>Object.keys(t._popupWindow).length&&a.parentElement.removeChild(a)}_createTaskEditor(e,t,a){const i=this,n=e.value,s=t[e.value];let l,r,o=a.find(e=>e._label===n);if(o)l=o.firstElementChild,r=o.lastElementChild;else{if(o=document.createElement("div"),o.classList.add("smart-gantt-chart-popup-window-editor"),o._label=n,e.customEditor)return o.appendChild(e.customEditor(n,s)),o;l=document.createElement("label"),"number"==typeof s||"string"==typeof s?(r=document.createElement("input"),r.classList.add("smart-input")):s instanceof Date&&(Smart.DateTimePicker?(r=document.createElement("smart-date-time-picker"),r.locale=i.locale,r.dropDownAppendTo="body",r.calendarButton=!0,r.dropDownDisplayMode="auto",r.enableMouseWheelAction=!0,r.formatString="yyyy-MMM-dd HH:mm:ss"):(r=document.createElement("input"),r.type="datetime-local"))}return o.parentElement?void i._setPopupWindowEditors(e,t,o):(o.appendChild(l),o.appendChild(r),o)}_setPopupWindowEditors(e,t,a){const i=a.firstElementChild,n=a.lastElementChild,s=(e.value+"").split(/(?=[A-Z])/).join(" "),l=t[e.value];e.customEditor?e.setCustomEditorValue&&e.setCustomEditorValue(a,s,l):(i.innerHTML=s.charAt(0).toUpperCase()+s.slice(1),"number"==typeof l?n.value=parseFloat(l.toFixed(2)):"string"==typeof l?n.value=l:l instanceof Date&&(n.value=new Date(l)),n.disabled=!!("project"===t.type&&t.synchronized&&(-1<s.toLowerCase().indexOf("date")||-1<s.toLowerCase().indexOf("duration"))))}_setPopupWindowContent(e,t){const a=this,n=a.$[e+"PopupWindow"],s=t._task,l=[].slice.call(n.getElementsByClassName("smart-gantt-chart-popup-window-editor"));if(n.content&&(!n.content.innerHTML||l.length))if("task"===e&&s){const e=a.taskColumns;for(let t=0;t<e.length;t++){const i=e[t];if(!s[i.value])continue;const r=a._createTaskEditor(i,s,l);r&&(n.appendChild(r),a._setPopupWindowEditors(i,s,r))}}else if("confirm"===e)n.innerHTML="<div class=\"smart-gantt-chart-popup-window-editor\">"+a.localize("confirm",{componentName:"The task"})+"</div >";else{const e=t.getAttribute("connection-id").split("-"),i=a._tasks[e[0]],s=a._tasks[e[1]];n.innerHTML="<div class=\"smart-gantt-chart-popup-window-editor\">Delete link <b> "+i.label+" - "+s.label+"?</b></div>"}}_setPopupWindowTemplate(e,t,a){const i=this,n=i.$[t+"PopupWindow"];if("content"===e)return void i._setPopupWindowContent(t,a);if(n[e+"Template"]||(n[e+"Template"]=i._createPopupWindowTemplate(e,t,a)),"header"===e&&a&&a._task){const e=(n.shadowRoot||n).querySelector(".smart-popup-window-label");e&&(e.innerHTML=a._task.label)}else if("footer"===e){const e=(n.shadowRoot||n).querySelectorAll(".smart-popup-window-button");for(let a=0;a<e.length;a++){const n=e[a];n.innerHTML="task"===t?"<span class=\"smart-icon\"></span>":"",n.classList.contains("ok")?n.innerHTML+=i.localize("ok"):n.classList.contains("cancel")?n.innerHTML+=i.localize("cancel"):n.classList.contains("delete")&&(n.innerHTML+=i.localize("delete"));const s=n.querySelector(".smart-ripple");s&&s.parentElement.removeChild(s)}}}_createPopupWindowTemplate(e,t){const a=this,i=document.createElement("template");return"footer"===e?"task"===t?i.innerHTML="<smart-button class=\"smart-popup-window-button ok primary\" animation=\""+a.animation+"\" theme=\""+a.theme+"\"></smart-button><smart-button class=\"smart-popup-window-button cancel\" animation=\""+a.animation+"\" theme=\""+a.theme+"\"></smart-button><smart-button class=\"smart-popup-window-button delete secondary\" animation=\""+a.animation+"\" theme=\""+a.theme+"\"></smart-button>":"connection"===t||"confirm"===t?i.innerHTML="<smart-button class=\"smart-popup-window-button ok primary\" animation=\""+a.animation+"\" theme=\""+a.theme+"\"></smart-button><smart-button class=\"smart-popup-window-button cancel\" animation=\""+a.animation+"\" theme=\""+a.theme+"\"></smart-button>":void 0:"header"===e&&("task"===t||"confirm"===t)&&(i.innerHTML="<span class=\"smart-popup-window-label\"></span>"),i}_popupWindowClickHandler(e){const t=this;let a=(e.originalEvent||e).target;a.shadowRoot&&(a=(e.originalEvent||e).composedPath()[0]);const i=a.closest("smart-window")||(a.getRootNode()&&a.getRootNode().host?a.getRootNode().host:void 0),n=i._target;if(a.closest(".smart-popup-window-button.cancel"))return t._popupWindow&&t._popupWindow.confirmPopupWindow&&i!==t._popupWindow.confirmPopupWindow&&t._popupWindow.confirmPopupWindow.close(),i.close(),void delete i._target;if(a.closest(".smart-popup-window-button.ok")){if(i===t.$.connectionPopupWindow&&n.classList.contains("smart-task-connection"))t._removeConnection(n);else if(i===t.$.confirmPopupWindow)t.removeTask(t._tasks.indexOf(n._task)),i.close(),t.$.taskPopupWindow&&t.$.taskPopupWindow.close(),delete i._target;else{const a=(i.shadowRoot||i).querySelectorAll(".smart-gantt-chart-popup-window-editor");let s={};for(let i=0;i<a.length;i++){const e=a[i]._label,n=t.taskColumns.find(t=>t.value===e);if(n.customEditor)s[e]=n.getCustomEditorValue(a[i]);else{const t=a[i].lastElementChild;let n;n=Smart.DateTimePicker&&t instanceof Smart.DateTimePicker?t.value.toDate():t instanceof HTMLInputElement&&"datetime-local"===t.type?new Date(t.value):Smart.DropDownList&&t instanceof Smart.DropDownList?t.selectedValue[0]:t.value,n instanceof Date&&isNaN(n.getTime())&&(n=void 0),void 0!==n&&null!==n&&(s[e]=n)}}t.updateTask(t._tasks.indexOf(n._task),s)}return t._popupWindow&&t._popupWindow.confirmPopupWindow&&i!==t._popupWindow.confirmPopupWindow&&t._popupWindow.confirmPopupWindow.close(),i.close(),void delete i._target}return a.closest(".smart-popup-window-button.delete")?void t._openPopupWindow(i._target,!0):void 0}_createTasks(e,t){function a(e,t){let s=[];if(0!==e.length){for(let l,r=0;r<e.length;r++)if((l=e[r],"object"==typeof l)&&(l=i._validateTaskProperties(l,t),!!l)){if(l.project=t,l.tasks instanceof Array&&0<l.tasks.length&&(l.synchronized&&(l.dateStart=l.minDateStart=l.maxDateStart=void 0,l.dateEnd=l.minDateEnd=l.maxDateEnd=void 0),l.type="project",l.tasks=a(l.tasks,l),0===l.tasks.length&&delete l.tasks),(!l.type||0>["project","task","milestone"].indexOf(l.type))&&(l.type="task"),t&&"project"===l.type&&0<l.tasks.length){s.push(l),s=s.concat(l.tasks);continue}t||(l.dateStart&&l.dateEnd&&!isNaN(l.dateStart.getTime())&&!isNaN(l.dateEnd.getTime())&&n.push(l),l.tasks&&(n=n.concat(l.tasks))),s.push(l)}return s}}const i=this;t||i.clearTasks();let n=[];return a(e||i.dataSource),t?n.slice(0):void(i._tasks=n.slice(0))}_createTimeline(){const e=this;e._tasks&&0!==e._tasks.length&&(e._autoSchedule(),e._createTimelineCells(),e._resetTimeline(),e._insertTimelineTasks(e._tasks))}_insertTimelineTasks(e,a,i){const n=this,s=function(e){for(let t=e.project;t;){if(!t.expanded)return!1;t=t.project}return!0};let r={};for(let o=0;o<e.length;o++){const t=e[o],l=t.connections;if((n._createTimelineTask(t,a?a+o:void 0),n._setTimelineTaskBar(t),n._setTaskBarProgress(t),n._setTaskBarLabel(t),!i)&&(n._expandTask(t),!!s(t))){for(let t,a=0;a<l.length;a++){if(t=l[a].target,"string"==typeof t){let e=n._getTaskIndexById(t);t=void 0===e?parseInt(t):e}if(!t||isNaN(t)||0>t||t>=e.length||t===o){l.splice(l.indexOf(l[a]),1);continue}const i=o+"-"+t+"-"+l[a].type;if(t>o){r[t]||(r[t]=[]),0>r[t].indexOf(i)&&r[t].push(i);continue}n._connectTask(i)}if(r[o]){for(let e=0;e<r[o].length;e++)n._connectTask(r[o][e]);delete r[o]}}}n._refresh(),n.$.container.style.setProperty("--smart-gantt-chart-timeline-content-height",n.$.timelineCellsContainer.offsetHeight+"px")}_ensureVisible(e){var t=Math.max;const a=this;if(void 0!==e&&null!==e){const i=Array.from(a.$.taskTree.querySelectorAll("smart-tree-item, smart-tree-items-group")),n=i.indexOf(e);if(i.length){"number"==typeof e?(e=Math.min(t(0,e),i.length-1),a.$.taskTree.ensureVisible(i[e])):"string"==typeof e&&a.$.taskTree.ensureVisible(e);const s=a.$.timelineCellsContainer.children[n];s&&(s.offsetTop+s.offsetHeight>a.scrollTop+a.$.timelineContent.offsetHeight?a.scrollTop=t(0,s.offsetTop+s.offsetHeight-a.$.timelineContent.offsetHeight):s.offsetTop<a.scrollTop&&(a.scrollTop=t(0,s.offsetTop)),a.$.timelineContent.scrollTop=a.scrollTop)}}}_expandTask(e,t){const a=this;if(!e)return!0;const i=e.tasks&&e.tasks.length?e:e.project;return!i||((a.$.timelineContent.style.minHeight="",a.$.timelineContent.style.maxHeight="",void 0!==t)?void a._animateTimelineExpanding(i,t):(t=i.expanded,!!(t&&t===i.expanded))||(a._handleExpanding(i,t),i.expanded))}_handleExpanding(e,t){const a=this,n=a._tasks,i=a.$.timelineConnectionsContainer,s=[].slice.call(i.children),l=a.$.timelineCellsContainer.children,r=a.$.timelineTasksContainer.children,o=e.tasks,d=parseFloat(window.getComputedStyle(a).getPropertyValue("--smart-gantt-chart-task-default-height"))||0;let m=a.$.timelineCellsContainer.offsetHeight,g=0;a._handleTaskItemExpanding(e,t);for(let c=0;c<o.length;c++){g=n.indexOf(o[c]);const p=r[g],h=l[g];if(p){for(let e=0;e<s.length;e++){const t=s[e],a=t.getAttribute("connection-id").split("-");(parseInt(a[1])===g||parseInt(a[0])===g)&&t.parentElement&&i.removeChild(t)}if(t){if(!p.classList.contains("smart-visibility-hidden"))continue;const t=p._task.project;if(t&&t!==e&&!a._isTaskExpanded(p._task,e))continue;p.classList.remove("smart-visibility-hidden"),h.classList.remove("smart-visibility-hidden"),m+=d,a.$.container.style.setProperty("--smart-gantt-chart-timeline-content-height",m+"px"),a._refreshTaskConnections(p)}else{if(p.classList.contains("smart-visibility-hidden"))continue;p.classList.add("smart-visibility-hidden"),h.classList.add("smart-visibility-hidden"),m-=d,a.$.container.style.setProperty("--smart-gantt-chart-timeline-content-height",m+"px")}}}for(let s=n.indexOf(e)+1;s<r.length;s++){const e=r[s];e.style.top=l[s].offsetTop+"px",a._refreshTaskConnections(e)}e.expanded=t,a._refresh()}_handleTaskItemExpanding(e,t){function a(e){const t=this;"visibility"===e.propertyName||(t.style.height="",t.removeEventListener("transitionend",a))}const n=this,i=n._tasks,s=i.indexOf(e),l=n.$.treeSplitter._items;for(let r=1;r<l.length;r++){const e=l[r].getElementsByClassName("smart-task-item");if(!e.length||!e[s])continue;const i=e[s].lastElementChild;if(n._noAnimation)return void(t?i.classList.remove("smart-visibility-hidden"):i.classList.add("smart-visibility-hidden"));requestAnimationFrame(function(){let e=0;for(let t=0;t<i.children.length;t++)e+=i.children[t].offsetHeight;i.style.height=e+"px",i.addEventListener("transitionend",a),t?i.classList.remove("smart-visibility-hidden"):(i.classList.add("smart-visibility-hidden"),requestAnimationFrame(function(){i.style.height="0"}))})}}_isTaskExpanded(e,t){if(!e)return;let a,i=e.project;for(;i;){if(a=i.expanded,!a)return;if(i=i.project,i===t)break}return a}_hoverViaKeyboardCallback(e){const a=this;if(a._unfocusTaskTreeItems(),!e)return;const i=Array.from(a.$.taskTree.querySelectorAll("smart-tree-item, smart-tree-items-group")).indexOf(e),t=a.$.timelineCellsContainer.children[i];if(t&&t.setAttribute("focus",""),!a.$.timelineAnimationContainer.classList.contains("smart-visibility-hidden")){const e=a.$.timelineAnimationContainer.getElementsByClassName("smart-timeline-task");for(let n=0;n<e.length;n++){const t=e[n];if(a._tasks.indexOf(t._task)===i){t.setAttribute("focus","");break}}}const n=a.$.treeSplitter._items;for(let t=0;t<n.length;t++){const e=n[t];if(e!==a.$.taskTreeSplitterItem){const t=e.getElementsByClassName("smart-task-label-container")[i];t&&t.setAttribute("focus","")}}a._focusedItem=i}_unfocusTaskTreeItems(){const e=this,t=e.$.treeSplitter._items;for(let a=0;a<t.length;a++){const i=t[a];if(i!==e.$.taskTreeSplitterItem){const e=i.getElementsByClassName("smart-task-label-container");for(let a=0;a<e.length;a++)e[a].removeAttribute("focus")}}const a=e.$.timelineCellsContainer.children;for(let e=0;e<a.length;e++){const t=a[e];t.hasAttribute("focus")&&t.removeAttribute("focus")}delete e._focusedItem}_emptyAnimationContainer(){const e=this.$.timelineAnimationContainer.firstElementChild.children;for(let t=0;t<e.length;t++)e[t].firstElementChild.innerHTML="",e[t].lastElementChild.innerHTML=""}_animateTimelineExpanding(e,t){const a=this,i=a.$.timelineAnimationContainer,n=i.firstElementChild,s=n.children[0],l=n.children[1],r=n.children[2];if("none"===a.animation)return i.classList.add("smart-visibility-hidden"),a._emptyAnimationContainer(),void a._handleExpanding(e,t);const o=a._tasks,d=a.$.timelineTasksContainer.children,m=a.$.timelineConnectionsContainer.children,c=function(t){for(let a=t.project;a;){if(a===e)return!0;a=a.project}},g=e.tasks.filter(t=>t.project===e||a._isTaskExpanded(t,e));let p=o.indexOf(e);const h=d[p].offsetHeight,u=a.$.timelineContent.offsetTop;a._emptyAnimationContainer(),t?l.classList.add("animate"):l.classList.remove("animate");let _=[],f=[],k=[],T=0;for(let n=0;n<d.length;n++){const t=d[n],i=t.cloneNode(!0),m=o.indexOf(t._task),g=t._task.project;(!g||g===e||a._isTaskExpanded(t._task,e))&&(i.style.marginLeft=i.style.left,i.classList.remove("smart-visibility-hidden"),m<=p?(s.lastElementChild.appendChild(i),_.push(m)):c(t._task)?(l.lastElementChild.appendChild(i),f.push(m),T+=i.offsetHeight):(r.lastElementChild.appendChild(i),k.push(m)),void 0!==a._focusedItem&&a._focusedItem===p&&m===p&&i.setAttribute("focus",""))}l.style.transition="none",t&&a._handleExpanding(e,t);for(let a=0;a<m.length;a++){const e=m[a],t=e.cloneNode(),i=t.getAttribute("connection-id").split("-");-1<_.indexOf(parseInt(i[0]))&&-1<_.indexOf(parseInt(i[1]))?s.firstElementChild.appendChild(t):-1<f.indexOf(parseInt(i[0]))&&-1<f.indexOf(parseInt(i[1]))?l.firstElementChild.appendChild(t):-1<k.indexOf(parseInt(i[0]))&&-1<k.indexOf(parseInt(i[1]))&&r.firstElementChild.appendChild(t)}l.firstElementChild.style.transform="translateY(-"+s.offsetHeight+"px)",r.firstElementChild.style.transform="translateY(-"+(T+s.offsetHeight)+"px)";let C;t||a._handleExpanding(e,t),C=a.$.timelineContent.offsetHeight,C!==n.offsetHeight&&(a.$.timelineContent.style[(t?"max":"min")+"Height"]=n.offsetHeight+"px"),i.style.top=u+"px",n.style.top=-a.scrollTop+"px",i.classList.remove("smart-visibility-hidden"),a.$.timelineContent.classList.add("smart-visibility-hidden"),requestAnimationFrame(function(){l.style.height=g.length*h+"px",l.style.transition="",t?(l.classList.remove("animate"),a.$.timelineContent.style.maxHeight=C+"px"):(l.classList.add("animate"),requestAnimationFrame(function(){l.style.height="0",a.$.timelineContent.style.minHeight=C+"px"}))})}_timelineAnimationContainerTransitionendHandler(e){const t=this;if("height"===e.propertyName){const e=t.$.timelineAnimationContainer;e.classList.add("smart-visibility-hidden"),t.$.timelineContent.classList.remove("smart-visibility-hidden"),t._emptyAnimationContainer(),t.$.timelineContent.style.minHeight="",t.$.timelineContent.style.maxHeight="",e.firstElementChild.children[1].style.height=""}}_getTaskByTreeIndex(e,t){const a=this;if(!e)return;const i=e.split(".");let n=a._tasks.filter(e=>!e.project)[e.split(".")[0]];if(n){if(!n.tasks||!n.tasks.length)return t?null:n;for(let e=1;e<i.length;e++){const a=n.tasks.filter(e=>e.project===n)[i[e]];if(!a||t&&(!a.tasks||!a.tasks.length))break;n=a}return t?n&&"project"===n.type?n:void 0:n}}_taskTreeBlurHandler(){const e=this;e._unfocusTaskTreeItems()}_taskTreeChangeHandler(e){const t=this;e.stopPropagation();t._taskAPIManipulation||void 0!==t._itemIndexClicked||t._dragDetails||(t._treeChangeEventFired=!0,t._selectTask(t._getTaskByTreeIndex(e.detail.selectedIndexes[0])),delete t._treeChangeEventFired)}_taskTreeExpandHandler(e){const t=this;if(t._tasks&&t._tasks.length){const a=e.detail.item.path,i=t._getTaskByTreeIndex(a,!0);i&&("collapse"===e.type?t._expandTask(i,!1):t._expandTask(i,!0))}}_resetTimeline(){const e=this;e.$.timelineCellsContainer.innerHTML="";const t=e.$.timelineTasksContainer.children;for(let e=0;e<t.length;e++)delete t[e]._cellStart,delete t[e]._cellEnd}_refreshTimeline(e){const a=this,i=a._tasks;e||(e=a.view);const t=a._getDateFromCell(a.scrollLeft,a._getFirstCellObjInView(),e);a.scrollLeft=0,a._resetTimeline(),a._createTimelineCells();for(let n=0;n<i.length;n++){const e=i[n];a._createTimelineTaskCells(e),a._setTimelineTaskBar(e),a._refreshTaskConnections(e)}a._refresh(),a._scrollTo(t)}_scrollTo(e){const t=this,a=t._timelineCells;let n;for(let s=0;s<a.length;s++){const i=a[s],l=i.date;switch(t.view){case"year":if(l.getFullYear()===e.getFullYear()&&l.getMonth()===e.getMonth()){let t=new Date(e);t.setMonth(e.getMonth()+1),t.setDate(0),t=t.getDate(),n=i.left+e.getDate()/t*i.width}break;case"month":{let t=new Date(l),a=new Date(l);t.setDate(t.getDate()-t.getDay()),a.setDate(a.getDate()+(6-a.getDay())+1),a.setMilliseconds(a.getMilliseconds()-1),e.getTime()>=t.getTime()&&e.getTime()<=a.getTime()&&(n=i.left+e.getDay()/7*i.width);break}case"week":l.getFullYear()===e.getFullYear()&&l.getMonth()===e.getMonth()&&l.getDate()===e.getDate()&&(n=i.left+parseFloat(e.getHours()+"."+e.getMinutes()+e.getSeconds())/24*i.width);break;case"day":l.getFullYear()===e.getFullYear()&&l.getMonth()===e.getMonth()&&l.getDate()===e.getDate()&&l.getHours()===e.getHours()&&(n=i.left+parseFloat(e.getMinutes()+e.getSeconds())/60*i.width);}if(void 0!==n)return void(t.scrollLeft=n)}}_updateConnection(e,t){function a(e,a,i){const s=e.connections;let l;for(let r,o=0;o<s.length;o++){if(r=s[o].target,"string"==typeof r){let e=n.indexOf(n.find(e=>e.id===r));0<=e&&(r=e)}if(r===a){if(!t&&void 0!==i&&s[o].type===i&&!l){l=!0;continue}s.splice(o,1)}}return l}const i=this;e+="",e=e.split("-");const n=i._tasks,s=parseInt(e[0]),l=parseInt(e[1]),r=parseInt(e[2]),o=n[s],d=n[l];if(o){if(!d)return void(o.connections=[]);if(void 0!==r){const e=a(o,l,r);if(a(n[l],s),!(t||e)){o.connections.push({target:l,type:r});const e=d.connections.find(e=>i._getTaskIndexById(e.target)===s&&e.type===r);e&&d.connections.splice(d.connections.indexOf(e),1)}}}}_createTimelineCells(){const e=this,a=e._tasks,t=e.properties.dateStart.value,i=e.properties.dateEnd.value;let n,s;if(t&&(n=t),i&&(s=i),0<a.length){let e=a[0].dateStart,i=a[0].dateEnd;for(let n=0;n<a.length;n++)a[n].dateStart&&a[n].dateEnd&&(e||(e=a[n].dateStart),i||(i=a[n].dateEnd),e.getTime()>a[n].dateStart.getTime()&&(e=a[n].dateStart),i.getTime()<a[n].dateEnd.getTime()&&(i=a[n].dateEnd));(!n||n.getTime()>e.getTime())&&(n=e),(!s||s.getTime()<i.getTime())&&(s=i)}n&&s&&(n=e._minMaxDateValidator(n),s=e._minMaxDateValidator(s),e._createTimelineHeader(n,e._getCellsCount(n,s)))}_getCellsCount(e,t,a){var i=Math.round;let n,s,l,r,o,d,m=new Date(e),c=new Date(t);const g=t.getFullYear()-e.getFullYear();if(s=n=i(g)+1,"year"===a)return{year:s};if(m.setHours(m.getHours(),0,0,0),c.setHours(c.getHours(),0,0,0),d=Math.floor((t.getTime()-e.getTime())/3600000),0<d){let e=new Date(m);if(d=1,m.getFullYear()!==c.getFullYear()){let t=new Date(m.getFullYear()+1,0,1,0,0,0,0);for(;e.getTime()!==t.getTime();){const t=e.getTime();e.setHours(e.getHours()+1),e.getTime()===t&&e.setHours(e.getHours()+2),d++}const a=c.getFullYear()-t.getFullYear();for(let t=0;t<a;t++){const t=e.getFullYear();d+=24*((0==t%100?0==t%400:0==t%4)?366:365)-1,e.setFullYear(t+1)}}for(;e.getTime()!==c.getTime();){const t=e.getTime();e.setHours(e.getHours()+1),e.getTime()===t&&e.setHours(e.getHours()+2),d++}}if("hour"===a)return{hour:d};if(m.setHours(0,0,0,0),c.setHours(23,59,59,999),o=n=i((c.getTime()-m.getTime())/86400000),"day"===a)return{day:o};if(m.setDate(m.getDate()-m.getDay()),c.setDate(c.getDate()+6-c.getDay()),r=n=i((c.getTime()-m.getTime())/604800000),"week"===a)return{week:r};if("month"===this.view&&(0!==e.getDay()&&(e=new Date(e.setDate(e.getDate()-e.getDay()))),6!==t.getDay()&&(t=new Date(t.setDate(t.getDate()+6-t.getDay())))),e.getFullYear()!==t.getFullYear()){n=12-e.getMonth();const a=t.getFullYear();for(let i=e.getFullYear()+1;i<=a;i++)n+=i===t.getFullYear()?t.getMonth()+1:12}else n=t.getMonth()-e.getMonth()+1;return l=Math.ceil(n),"months"===a?{month:l}:{year:s,month:l,week:r,day:o,hour:d}}_createTimelineTask(e,t){const a=this,i=a._createTaskBar(e.type),n="project"===e.type&&e.synchronized;e.disableDrag||n&&!e.dragProject?i.setAttribute("disable-drag",""):i.removeAttribute("disable-drag"),e.disableResize||n?i.setAttribute("disable-resize",""):i.removeAttribute("disable-resize"),e.id&&(i.id=e.id),a._createTimelineTaskCells(e,t),i._task=e,i.classList.add("smart-timeline-task"),e.class&&i.classList.add(e.class),a.$.timelineTasksContainer.insertBefore(i,a.$.timelineTasksContainer.children[t])}_createTimelineTaskCells(e,t){const a=this,i=document.createElement("div");e.project&&!a._isTaskExpanded(e)&&i.classList.add("smart-visibility-hidden"),i._task=e,i.classList.add("smart-timeline-task-cell"),a.$.timelineCellsContainer.insertBefore(i,a.$.timelineCellsContainer.children[t])}_createCells(e){let t,a=document.createDocumentFragment();for(let i=0;i<e;i++)t=document.createElement("div"),t.classList.add("smart-timeline-view-cell"),a.appendChild(t);return a}_getTimelineVisibleCellsCount(){const e=this,t=e._timelineCells;if(t){const a=e._getFirstCellObjInView(),i=1-(a.left+a.width-e.scrollLeft)/t[0].width;return Math.ceil(parseFloat((e.$.timeline.offsetWidth/a.width).toFixed(2))+i)}}_getHeaderVisibleCellsCount(){const e=this;if(!e._timelineHeaderCells)return;const t=e.scrollLeft,a=e.$.timeline.parentElement.offsetWidth,n=e._timelineHeaderCells;let s=0;for(let e=0;e<n.length;e++){const i=n[e];i.left+i.width>t&&i.left<a+t&&s++}return s}_refreshHeaderDate(){const e=this,t=e._getCellsViewType(),a=e.scrollLeft,i=e.$.timelineViewCells.children,n=e._timelineCells;let s;e._refreshHeaderDetailsDate();for(let e=0;e<n.length;e++){const t=n[e];if(a<=t.left+t.width){s=e;break}}for(let a=0;a<i.length;a++){const l=i[a],r=n[s];if(!r)break;const o=r.date;l._date=new Date(o),l.innerHTML=e._getDateString(new Date(o),t),l.style.width=r.width+"px",l.style.left=r.left+"px",r.weekend?l.setAttribute("weekend",""):l.removeAttribute("weekend"),r.nonworking?l.setAttribute("nonworking",""):l.removeAttribute("nonworking"),s++}}_getDateString(e,t,a){const i=this,n=["2-digit","numeric"][i.dayFormat]||"numeric";if(i.timelineHeaderFormatFunction)return i.timelineHeaderFormatFunction(e,t,a);return"year"===t?e.toLocaleDateString(i.locale,{year:i.yearFormat}):"month"===t?e.toLocaleDateString(i.locale,{month:i.monthFormat}):"week"===t?"numeric"!==i.weekFormat&&a?e.toLocaleDateString(i.locale,{day:n,month:i.monthFormat,year:i.yearFormat}):i._getWeekNumber(e):"day"===t?e.toLocaleDateString(i.locale,"day"===i.view?{day:n,month:i.monthFormat,year:i.yearFormat}:-1<["long","short","narrow"].indexOf(i.dayFormat)?{weekday:i.dayFormat}:{day:i.dayFormat}):"hour"===t?"default"===i.hourFormat?e.toLocaleTimeString(i.locale,{hour12:!1}):e.toLocaleDateString(i.locale,{hour:i.hourFormat}):void 0}_refreshHeaderDetailsDate(){const e=this,t=e.view,a=e.scrollLeft,n=e.$.timelineViewDetails.children,s=e._timelineHeaderCells;let l;for(let e=0;e<s.length;e++){const t=s[e];if(a<=t.left+t.width){l=e;break}}for(let a=0;a<n.length;a++){const i=s[l],r=n[a];let o=new Date(i.date);"week"===e.view&&o.setDate(o.getDate()-o.getDay()),o=new Date(Math.max(i.date.getTime(),o.getTime())),r._date=o,r.innerHTML=e._getDateString(o,t,!0),r.style.left=i.left+"px",r.style.width=i.width+"px",l++}}_getWeekNumber(e){var t=Math.round;let a,i=new Date(e.getFullYear(),0,1),n=t((e.getTime()-i.getTime()-6e4*(e.getTimezoneOffset()-i.getTimezoneOffset()))/864e5)+1,s=i.getDay();return s=0<=s?s:s+7,4>s?(a=Math.floor((n+s-1)/7)+1,52<a&&(i=new Date(e.getFullYear()+1,0,1),s=i.getDay(),s=0<=s?s:s+7,a=4>s?1:53)):a=t((n+s-1)/7),a}_convertDuration(e,t){if(!e)return 0;let a;switch(this.durationUnit){case"day":a=86400000;break;case"hour":a=3600000;break;case"minute":a=60000;break;case"second":a=1e3;break;case"milisecond":return e;case"week":a=604800000;}return t?e/a:e*a}_createTaskBar(e){const t=document.createElement("div");return t.classList.add("smart-timeline-task"),t.classList.add(e),t.innerHTML="milestone"===e?`<div class="smart-task-container">
                <div class="smart-task-connection-point start"></div>
                <div class="smart-timeline-task-fill"></div>
                <div class="smart-task-connection-point end"></div>
            </div>`:`<div class="smart-task-container">
                <div class="smart-task-connection-point start"></div>
                <div class="smart-timeline-task-fill">
                    <div class="smart-timeline-task-progress"></div>
                </div>
                <div class="smart-timeline-task-progress-thumb"></div>
                <div class="smart-timeline-task-label"></div> 
                <div class="smart-task-connection-point end"></div>
            </div>`,t}_createTimelineHeader(e,t){const a=this,i=a._getCellsViewType();if(!e){const t=a.$.timelineViewCells.children;if(0===t.length)return;e=t[0]._date}return"day"!==a.view&&e.setHours(0,0,0,0),a.$.timelineContent.offsetWidth===a.$.timeline.offsetWidth&&a._timelineCells&&a._timelineCells[0]&&a._timelineCells[0].date.getTime()===e.getTime()&&a._timelineCells.length===t[a._getCellsViewType()]?void a._refresh():void(a.$.timelineContent.style.width=a.$.timelineAnimationContainer.style.width="",a._createTimelineCellsObj(e,t),a._createTimelineHeaderCellsObj(e,t),a.$.timelineViewDetails.innerHTML="",a.$.timelineViewDetails.appendChild(a._createCells(a._getHeaderVisibleCellsCount())),a.$.timelineViewCells.innerHTML="",a.$.timelineViewCells.appendChild(a._createCells(a._getTimelineVisibleCellsCount())),a._refreshHeaderDate(),a.$.timelineContent.style.width=a.$.timelineAnimationContainer.style.width=Math.max(t[i]*a._timelineCells[0].width,a.$.timeline.parentElement.offsetWidth)+"px",a._refresh())}_getCellsViewType(){switch(this.view){case"year":return"month";case"month":return"week";case"week":return"day";case"day":return"hour";}}_createTimelineCellsObj(e,t){const a=this,i=a._getCellsViewType();t=t[i];const n=window.getComputedStyle(a),s=a.$.timeline.parentElement.offsetWidth;let l=Math.max(parseFloat(n.getPropertyValue("--smart-gantt-chart-timeline-cell-size"))||0,parseFloat(n.getPropertyValue("--smart-gantt-chart-timeline-cell-min-size")||0)),r=0,o=new Date(e);t*l<s&&(l=s/t),l=parseFloat(l.toFixed(2)),a._timelineCells=[];for(let n=0;n<t;n++){const e={left:r,width:l};if("year"===i)o.setMonth(0),e.date=new Date(o),o.setFullYear(o.getFullYear()+1);else if("month"===i)o.setDate(1),e.date=new Date(o),o.setMonth(o.getMonth()+1);else if("week"===i)o.setHours(0,0,0,0),o.setDate(o.getDate()-o.getDay()),e.date=new Date(o),o.setDate(o.getDate()+7);else if("day"===i)-1<a.nonworkingDays.indexOf(o.getDay())&&(e.nonworking=!0),o.setHours(0,0,0,0),e.date=new Date(o),o.setDate(o.getDate()+1),e.weekend=0===e.date.getDay()||6===e.date.getDay();else if("hour"===i){(-1<a.nonworkingHours.indexOf(o.getHours())||-1<a.nonworkingDays.indexOf(o.getDay()))&&(e.nonworking=!0),o.setHours(o.getHours(),0,0,0),e.date=new Date(o);const t=o.getTime();o.setHours(o.getHours()+1),t===o.getTime()&&o.setHours(o.getHours()+2),e.weekend=0===e.date.getDay()||6===e.date.getDay()}a._timelineCells.push(e),r=parseFloat((r+l).toFixed(2))}}_createTimelineHeaderCellsObj(e,t){const a=this,n=a.view;let s=0,l=new Date(e);t=t[n],a._timelineHeaderCells=[];for(let r=0;r<t;r++){const e={date:new Date(l)};"year"===n?l.setFullYear(l.getFullYear()+1):"month"===n?(l.setDate(1),l.setMonth(l.getMonth()+1)):"week"===n?l.setDate(l.getDate()+7):"day"===n?l.setDate(l.getDate()+1):void 0;s=a._refreshViewDetailCell(e,s,r),a._timelineHeaderCells.push(e)}}_minMaxDateValidator(e){if(!e||isNaN(e.getTime()))return e;const t=this,a=new Date(t.min),i=new Date(t.max);return a&&(e=new Date(Math.max(a.getTime(),e.getTime()))),i&&(e=new Date(Math.min(i.getTime(),e.getTime()))),e}_dateValidator(e,t){const a=this;if(t instanceof Date)return a._minMaxDateValidator(t);if(Smart.Utilities.DateTime&&t instanceof Smart.Utilities.DateTime)return a._minMaxDateValidator(t.toDate());if("string"==typeof t){if("new Date()"===t.trim()||"new Smart.Utilities.DateTime()"===t.trim())return a._minMaxDateValidator(new Date);let e,i=/(\d+[,-.\/]{1}\s*\d+[,-.\/]{1}\s*\d+)/;if(i.test(t)){const a=i.exec(t)[0].replace(/[,-.\/]/g,",").split(",");if(3===a.length){if(e=new Date(parseInt(a[0]),parseInt(a[1])-1,parseInt(a[2])),i=/\d+:\d+:\d+/,i.test(t)){const a=i.exec(t)[0].split(":");e.setHours(a[0]||0,a[1]||0,a[2]||0)}t=e}}}else return a._minMaxDateValidator(e);return a._minMaxDateValidator(new Date(t))}_getTaskBarPositionLimits(e,t){function a(t){const a=i._getTimelineTaskCellByDate(e,t);if(a)return a.left+i._getTimelineTaskOffset(a,t)||0}const i=this;return{min:a(e._task["min"+t]),max:a(e._task["max"+t])}}_getTimelineTaskOffset(e,t){const a=this;if(!e)return;let i,n;switch(a.view){case"year":{const a=t.getHours()/24+t.getMinutes()/1440+t.getSeconds()/86400;i=new Date(e.date.getFullYear(),e.date.getMonth()+1,0),n=(t.getDate()-1+a)/i.getDate()*e.width;break}case"month":n=t.getDay()/7*e.width;break;case"week":n=parseFloat(t.getHours()+t.getMinutes()/60+t.getSeconds()/3600)/24*e.width;break;case"day":n=parseFloat(t.getMinutes()+t.getSeconds()/60)/60*e.width;}return n}_getTaskBarSizeLimits(e,t){function a(a,n){if(!a)return;let s,o;"left"===t?(a=-1*a,o=r.dateEnd):o=r.dateStart,n&&i(s)===i(a)&&(s=0);let d=l._getTaskWorkingDateEnd({dateStart:o},a);const m=d.getTime()+1e3*(60*(d.getTimezoneOffset()-o.getTimezoneOffset())),c=l._getTimelineTaskCellByDate(e,new Date(m));if(c){const a=l._getTimelineTaskOffset(c,new Date(m));return"left"===t?e.offsetLeft+e.offsetWidth-c.left-a:c.left-e.offsetLeft+a}}var i=Math.abs,n=Math.max,s=Math.min;const l=this,r=l._getTaskBarDateRange(e);let o,d=0,m=l._convertDuration(e._task.minDuration)||l._getMinDuration(e,t),c=l._convertDuration(e._task.maxDuration);if("left"===t){const t=e._task.maxDateStart,a=e._task.minDateStart;a&&(d=1e3*(60*(a.getTimezoneOffset()-r.dateEnd.getTimezoneOffset())),o=i(a.getTime()-r.dateEnd.getTime())+d,c=c?s(o,c):o),t&&(d=1e3*(60*(t.getTimezoneOffset()-r.dateEnd.getTimezoneOffset())),o=i(t.getTime()-r.dateEnd.getTime())+d,m=m?n(o,m):o)}else{const t=e._task.maxDateEnd,a=e._task.minDateEnd;a&&(d=1e3*(60*(a.getTimezoneOffset()-r.dateStart.getTimezoneOffset())),o=i(a.getTime()-r.dateStart.getTime())+d,m=m?n(o,m):o),t&&(d=1e3*(60*(t.getTimezoneOffset()-r.dateStart.getTimezoneOffset())),o=i(t.getTime()-r.dateStart.getTime())+d,c=c?s(o,c):o)}return c&&(m=s(m,c)),{min:a(m,!0),max:a(c)}}_getMinDuration(e,t){const a=this,i=parseFloat(getComputedStyle(a).getPropertyValue("--smart-gantt-chart-timeline-task-min-width"))||0;if(!i||!a._timelineCells||0===a._timelineCells.length)return;const n=e._task;let s,l,r=1;"left"===t?(s=n.dateEnd,l=(parseFloat(e.style.left)||e.offsetLeft)+(parseFloat(e.offsetWidth)||e.offsetWidth),r=-1):(s=n.dateStart,l=parseFloat(e.style.left)||e.offsetLeft);const o=l+r*i;let d;for(let n=0;n<a._timelineCells.length;n++){const e=a._timelineCells[n];if(o<e.left)break;d=e}const m=a._getDateFromCell(o,d);return m?Math.abs(s.getTime()-m.getTime()):void 0}_createDelimiter(e,t){const a=this,i=e.slice(0,3),n=document.createElement("div");if(n.classList.add("smart-task-bar-limitter-"+e),-1<e.indexOf("date")){if(!this._dragDetails[i].left)return;const e=a._dragDetails.timelineTask,t=a.$.timelineCellsContainer.children[a._tasks.indexOf(e._task)];n.style.width=-1<i.indexOf("max")?t.offsetWidth-a._dragDetails[i].left-e.offsetWidth+"px":a._dragDetails[i].left+"px"}else{if(!this._dragDetails[i].width)return;n.style["left"===t?"right":"left"]=a._dragDetails[i].width+"px"}return n}_doubleClickHandler(e){const t=this;let a=e.target;t.shadowRoot&&a===t&&(a=e.composedPath()[0]);let i=a.closest?a.closest(".smart-task-connection"):void 0;return i?void t._openPopupWindow(i):(i=a.closest(".smart-timeline-task")||a.closest(".smart-task-label-container")||a.closest(".smart-tree-item-label-container"),i)?void(i.classList.contains("smart-timeline-task")?t._openPopupWindow(i):t._openPopupWindow(t.$.timelineTasksContainer.children[t._getTaskItemIndex(i)])):void 0}_checkDoubleClick(e){const t=this;let a=e.target;if(t.shadowRoot&&a===t&&(a=e.composedPath()[0]),void 0===t._dblClickDetails&&(t._dblClickDetails={clicks:0}),clearTimeout(t._dblClickDetails.timeOut),a!==t._dblClickDetails.target&&(t._dblClickDetails.clicks=0),t._dblClickDetails.target=a,t._dblClickDetails.clicks++,t._dblClickDetails.timeOut=setTimeout(function(){t._dblClickDetails&&(t._dblClickDetails.clicks=0)},300),2===t._dblClickDetails.clicks)return t._doubleClickHandler(e),t._dblClickDetails.clicks=0,!0}_downHandler(e){const t=this,a=e.originalEvent,i=t.shadowRoot||t.isInShadowDOM?a.composedPath()[0]:a.target,n=i.closest?i.closest(".smart-timeline-task-cell")||i.closest(".smart-timeline-task"):null;if(e.stopPropagation(),t._dragDetails)return delete t._dragDetails,void t._setConnectionFeedback();if(Smart.Utilities.Core.isMobile||0===e.button){if(!n){if(i.classList.contains("smart-popup-window-modal")){if(t._popupWindow){const e=Object.keys(t._popupWindow);requestAnimationFrame(()=>t._popupWindow[e[e.length-1]].focus())}return}return(i.closest(".smart-tree-item-label-container")&&!i.classList.contains("smart-arrow-down")||i.closest(".smart-task-connection")||i.closest(".smart-task-label-container"))&&t._checkDoubleClick(a)?void 0:void(i.closest(".smart-tree-item-label-container")||i.closest("smart-scroll-bar")||(t._itemIndexClicked=t._getTaskItemIndex(i),t._selectTask(void 0===t._itemIndexClicked?null:t._tasks[t._itemIndexClicked]),t.$.taskTree.focus(),t.$.mainSplitter.contains(i)&&a.preventDefault()))}const s=t.$.timelineTasksContainer.children[t._tasks.indexOf(n._task)],l=s._task;if(l&&(s.getElementsByClassName("smart-timeline-task-fill")[0]||t.$.timeline.hasAttribute("task-bar-hovered"))){if((i.closest(".smart-timeline-task-fill")||s.classList.contains("milestone")&&i.closest(".smart-task-container"))&&t._checkDoubleClick(a))return;const n=i.closest(".smart-timeline-task-progress-thumb"),r=e.pageX-window.pageXOffset,o=e.pageY-window.pageYOffset;t._dragDetails={},t._dragDetails.target=n||i,t._dragDetails.timelineTask=s,t._dragDetails.coordinates={x:r,y:o};const d=(n||s).getBoundingClientRect();if(t._dragDetails.offset={x:r-d.left,y:o-d.top},n||!n&&"project"===l.type&&l.synchronized&&!l.dragProject)return;("visible"===t.resizeHandlesVisibility||Smart.Utilities.Core.isMobile&&"auto"===t.resizeHandlesVisibility)&&(i.closest(".smart-timeline-task-fill")?t._checkTaskBarResizability(e):t.$.timeline.removeAttribute("task-bar-hovered")),t._dragDetails.originalPosition={x:s.offsetLeft,y:s.offsetTop},t._dragDetails.originalSize={width:s.offsetWidth,height:s.offsetHeight},t._dragDetails.min={},t._dragDetails.max={},t._setDragLimits(i)}}}_documentMoveHandler(e){const t=this;if(!t._dragDetails||!t._dragDetails.target){let a=e.originalEvent.target;return t.shadowRoot&&a===t&&(a=e.originalEvent.composedPath()[0]),t._hoverTask(t._getTaskItemIndex(a)),void 0===t._hoveredIndex&&t._handleTimelineHover(e),void t._checkTaskBarResizability(e)}return t._dragDetails.target.classList.contains("smart-task-connection-point")?(t._setConnectionFeedback(e),t._handleTimelineHover(e),void t._autoScroll(e)):t._dragDetails.target.classList.contains("smart-timeline-task-progress-thumb")?void t._handleTaskProgressChange(e):(t._autoScroll(e),t._autoScrolling?void 0:t.$.timeline.hasAttribute("task-bar-hovered")?void t._handleTaskBarResize(e):t._dragDetails.target.closest(".smart-timeline-task-fill")&&t._dragDetails.timelineTask&&!t._dragDetails.timelineTask.hasAttribute("disable-drag")?void t._handleTaskBarDrag(e):void 0)}_documentUpHandler(e){const t=this,a=e.originalEvent;let i=a.target;if(void 0!==t._itemIndexClicked)return void(t._itemIndexClicked=void 0);if(!t._dragDetails)return;t.shadowRoot&&i===t&&(i=a.composedPath()[0]);let n;const s=t._dragDetails.timelineTask;if(s&&(n=t.$.timelineCellsContainer.children[t._tasks.indexOf(s._task)]),t.hasAttribute("dragged")){t._snapToNearest(s),t._checkWorkingDays(s),t._refreshProject(n._task.project),t.removeAttribute("dragged"),t.$.fireEvent("dragEnd",{dateStart:n._task.dateStart,dateEnd:n._task.dateEnd});const e=n.getElementsByClassName("smart-task-bar-limitter-min-date")[0],a=n.getElementsByClassName("smart-task-bar-limitter-max-date")[0];e&&e.parentElement.removeChild(e),a&&a.parentElement.removeChild(a),t._autoSchedule(s._task),t._scrollView.disableSwipeScroll=!1}else if(t.hasAttribute("progress-change"))t.removeAttribute("progress-change"),t.$.fireEvent("progressChangeEnd",{taskId:t._tasks.indexOf(n._task),progress:n._task.progress||0}),t._scrollView.disableSwipeScroll=!1;else if(t.hasAttribute("resized"))t._snapToNearest(s),t._refreshProject(n._task.project),t.removeAttribute("resized"),t.$.fireEvent("resizeEnd",{dateStart:n._task.dateStart,dateEnd:n._task.dateEnd}),t._autoSchedule(s._task),t._scrollView.disableSwipeScroll=!1;else if(t.hasAttribute("connecting-task")){const a=t._connectTask(e),i=t._tasks;t._setConnectionFeedback(),a&&(t.$.fireEvent("connectionEnd",{source:i.indexOf(a.taskStart),target:i.indexOf(a.target),type:a.type}),t._autoSchedule(a.taskStart._task)),Smart.Utilities.Core.isMobile&&(t._handleTimelineHover(e,!0),t._scrollView.disableSwipeScroll=!1)}else{const e=i.closest(".smart-timeline-task");e===s?t._selectTask(n._task):t._selectTask()}if(s){const e=s.getElementsByClassName("smart-task-bar-limitter-max")[0],t=s.getElementsByClassName("smart-task-bar-limitter-min")[0];e&&e.parentElement.removeChild(e),t&&t.parentElement.removeChild(t)}delete t._dragDetails}_moveHandler(e){const t=this;Smart.Utilities.Core.isMobile||e.stopPropagation(),(t.hasAttribute("dragged")||t.hasAttribute("progress-change"))&&"touchmove"===e.originalEvent.type&&e.originalEvent.preventDefault()}_getTaskItemIndex(e){const t=this;if(!e||!e.closest||!(t.shadowRoot||t).contains(e))return;let a=e.closest(".smart-task-label-container");return a?[].slice.call(a.closest("smart-splitter-item").getElementsByClassName("smart-task-label-container")).indexOf(a):(a=e.closest(".smart-tree-item-label-container"),a)?[].slice.call(t.$.taskTree.getElementsByClassName("smart-tree-item-label-container")).indexOf(a):void 0}_hoverTask(e){const t=this;if(t._hoveredIndex!==e){const a=t.$.treeSplitter.querySelectorAll("smart-tree-item, smart-tree-items-group, .smart-task-label-container");for(let e=0;e<a.length;e++)a[e].removeAttribute("hover");if(void 0===e||0>e)return t._hoveredIndex=void 0,void t._handleTimelineHover({target:t});if(!Smart.Utilities.Core.isMobile&&t.taskColumns.length){const a=t.$.treeSplitter._items;for(let n=0;n<a.length;n++){const i=a[n];let s;s=i===t.$.taskTreeSplitterItem?[].slice.call(i.querySelectorAll("smart-tree-item, smart-tree-items-group")):[].slice.call(i.getElementsByClassName("smart-task-label-container")),s[e].setAttribute("hover","")}t._hoveredIndex=e,t._handleTimelineHover({target:t.$.timelineTasksContainer.children[e]})}}}_checkWorkingDays(e){var t=Math.min;const a=this;if((a._dragDetails._taskDuration||a._timelineCells.length)&&e instanceof HTMLElement&&e.classList.contains("smart-timeline-task")&&a.hasAttribute("dragged")){if(0===a.nonworkingDays.length&&0===a.nonworkingHours.length||!a._dragDetails._taskDuration)return;const i=e._task,n=a._getTaskWorkingDateEnd(i);let s=new Date(a._timelineCells[a._timelineCells.length-1].date);"year"===a.view?(s.setMonth(s.getMonth()+1),s.setDate(0),s.setHours(23,59,59,999)):"month"===a.view?(s.setDate(s.getDate()+6-s.getDay()),s.setHours(23,59,59,999)):"week"===a.view?s.setHours(23,59,59,999):s.setHours(s.getHours(),59,59,999),i.dateEnd=i.maxDateEnd?new Date(t(n.getTime(),i.maxDateEnd.getTime())):n,i.dateEnd=new Date(t(s.getTime(),i.dateEnd.getTime())),i.duration=a._convertDuration(0<a.nonworkingDays.length||0<a.nonworkingHours.length?a._getWorkingTime(i.dateStart,i.dateEnd):i.dateEnd.getTime()-i.dateStart.getTime(),!0),a._setTimelineTaskBar(e._task,!0),a._refreshTaskConnections(e._task),a._refreshTaskColumnsData(i,["dateEnd","duration"])}}_getTaskWorkingDateEnd(e,t){var a=Math.min;if(!e||!e.dateStart)return;const i=this;let n,s,l=new Date(e.dateStart);t||(t=i._dragDetails?i._dragDetails._taskDuration:i._getWorkingTime(e.dateStart,e.dateEnd));const r=0>t?-1:1;for(t=Math.abs(t);0<t;){const e=a(t,3600000-(1e3*(60*l.getMinutes())+1e3*l.getSeconds()+l.getMilliseconds()));if(-1<i.nonworkingDays.indexOf(l.getDay())){s=new Date(l),s.setHours(0,0,0,0),s.setDate(l.getDate()+1*r),n=a(e,s.getTime()-l.getTime()),l=new Date(l.getTime()+n);continue}if(-1<i.nonworkingHours.indexOf(l.getHours())){s=new Date(l);const t=s.getTime();s.setHours(l.getHours()+1*r,0,0,0),t===s.getTime()&&s.setHours(l.getHours()+2*r,0,0,0),n=a(e,s.getTime()-l.getTime()),l=new Date(l.getTime()+n);continue}t-=e,l=new Date(l.getTime()+r*e)}return l}_createConnectingElement(e,t,a,i,n){var s=Math.abs;const l=this;if(!l._connectionDetails||!l._connectionDetails.start)return;const r=l._connectionDetails,o=r.type,d=l.$.timelineConnectionsContainer;let m=r.connections.shift();m||(m=document.createElement("div"),m.classList.add("smart-task-connection")),m.style.width=m.style.width="","horizontal"===i?(m.style.width=s(a)+"px",m.style.height=""):(m.style.width="",m.style.height=s(a)+"px"),m.style.left=e+"px",m.style.top=t+"px",m.setAttribute("connection-id",r.id),n?m.setAttribute("arrow-direction",0===o||1===o?"right":"left"):m.removeAttribute("arrow-direction"),m.parentElement||d.appendChild(m)}_getConnectionType(e,t){if(e&&t){let a=!e.classList.contains("end"),i=t.classList.contains("end");return a&&!i?0:a||i?!a&&i?2:a&&i?3:void 0:1}}_setConnectionFeedback(e){var t=Math.pow,a=Math.abs;const i=this;if(!i._dragDetails||!i._dragDetails.target||!e)return i._connectionFeedback&&i._connectionFeedback.parentElement&&(i._connectionFeedback.closest(".smart-timeline-task").removeAttribute("connection-point"),i._connectionFeedback.parentElement.removeChild(i._connectionFeedback)),i.removeAttribute("connecting-task"),void delete i._connectionFeedback;if(!i._dragDetails.target||!i._dragDetails.target.classList.contains("smart-task-connection-point"))return;const n=i._dragDetails.target.closest(".smart-timeline-task");if(!n)return;if(!i.hasAttribute("connecting-task")){if(i.$.fireEvent("connectionStart",{source:n}).defaultPrevented)return void delete i._dragDetails.target;i.setAttribute("connecting-task",""),Smart.Utilities.Core.isMobile&&(i._scrollView.disableSwipeScroll=!0)}const s=n.classList.contains("milestone");let l=s?-1*n.offsetHeight/2:0;i._dragDetails.target.classList.contains("end")&&(n.setAttribute("connection-point","end"),l=s?-1*l:n.offsetWidth),i._connectionFeedback||(i._connectionFeedback=document.createElement("div"),i._connectionFeedback.classList.add("smart-task-connection-feedback"));const r=i._dragDetails.coordinates.x+l,o=i._dragDetails.coordinates.y,d=i._dragDetails.offset.x,m=i._dragDetails.offset.y,c=e.pageX-window.pageXOffset+d,g=e.pageY-window.pageYOffset+m-n.offsetHeight/2;i._connectionFeedback.style.width=Math.sqrt(t(a(c-r),2)+t(a(g-o),2))+"px",i._connectionFeedback.style.transform="rotate("+180*(Math.atan2(g-o,c-r)||0)/Math.PI+"deg)",i._connectionFeedback.parentElement||n.firstElementChild.appendChild(i._connectionFeedback)}_connectTask(e){const t=this;let a,i,n,s,l;if(e.originalEvent){const l=e.originalEvent;let r=Smart.Utilities.Core.isMobile?document.elementFromPoint(l.pageX-window.pageXOffset,l.pageY-window.pageYOffset):l.target;if(!t._dragDetails||!t._dragDetails.target||!r||!r.classList)return;if(t.shadowRoot&&r===t&&(r=Smart.Utilities.Core.isMobile?t.shadowRoot.elementFromPoint(l.pageX-window.pageXOffset,l.pageY-window.pageYOffset):l.composedPath()[0]),a=t._dragDetails.target.classList.contains("smart-task-connection-point")?t._dragDetails.target:void 0,i=r.classList.contains("smart-task-connection-point")?r:void 0,a&&(n=a.closest(".smart-timeline-task")),i)s=i.closest(".smart-timeline-task");else if(Smart.Utilities.Core.isMobile&&r.classList.contains("smart-timeline-task-fill")&&(s=r.closest(".smart-timeline-task"),s)){const e=l.pageX-window.pageXOffset-s.getBoundingClientRect().left;i=s.querySelector(".smart-task-connection-point."+(e>=s.offsetWidth/2?"end":"start"))}}else{if(!e||3>e.length)return;if(e=(e+"").split("-"),e=t._getValidConnectionId(e[0],e[1],e[2],"_connectTask"),void 0===e)return;const r=t.$.timelineTasksContainer.children;n=r[parseInt(e[0])],s=r[parseInt(e[1])],l=parseInt(e[2]),n&&s&&(a=n.querySelector(".smart-task-connection-point."+(0===l||3===l?"start":"end")),i=s.querySelector(".smart-task-connection-point."+(0===l||1===l?"start":"end")))}return a&&i&&n&&s&&n!==s&&!n.classList.contains("smart-visibility-hidden")&&!s.classList.contains("smart-visibility-hidden")?t._isAutoScheduled(n,s)?void 0:(void 0===l&&(l=t._getConnectionType(a,i)),t._connectionDetails={start:{point:a},end:{point:i},type:l},t._setConnectionDetails(),t._createTaskConnection(),t.hasAttribute("dragged")||t.hasAttribute("resized")||t._updateConnection(t._tasks.indexOf(n._task)+"-"+t._tasks.indexOf(s._task)+"-"+t._connectionDetails.type),delete t._connectionDetails,n.setAttribute("connected",""),s.setAttribute("connected",""),{taskStart:n,taskEnd:s,type:l}):void 0}_isAutoScheduled(e,t,a){function n(e,t){const o=e.connections,d=l.indexOf(e);r[d]=!0;for(let m=0;m<o.length;m++){const e=o[m],i=s._getTaskIndexById(e.target);if(i===t)return a&&s._removeConnection(d+"-"+i+"-"+e.type,!0),!0;if(!r[i]&&n(l[i],t))return!0}}const s=this,l=s._tasks;let r={};return s.autoSchedule?n(t._task,l.indexOf(e._task)):void 0}_setConnectionDetails(){var e=Math.abs;const t=this;if(!t._connectionDetails)return;const a=t._connectionDetails,i=a.start.point,n=a.end.point,s=a.type;if(!i||!n)return;let l,r,o,d=i.closest(".smart-timeline-task"),m=n.closest(".smart-timeline-task"),c=d.offsetWidth,g=m.offsetWidth,p=d.offsetLeft,h=m.offsetLeft,u=d.offsetTop,_=m.offsetTop;const f=d.classList.contains("milestone"),k=m.classList.contains("milestone"),T=[].slice.call(t.$.timelineTasksContainer.children),C=T.indexOf(d),y=T.indexOf(m);if(a.id=C+"-"+(y+"-")+s,f?(c=d.offsetHeight,p-=c/2):k&&(g=m.offsetHeight,h-=g/2),a.connectionStartOffset&&a.connectionEndOffset||(0===s?(r=e(i.offsetLeft)-i.offsetWidth-(f?c/2:0)+i.offsetWidth/2,o=e(n.offsetLeft)-n.offsetWidth-(k?g/2:0)+n.offsetWidth/2):1===s?(r=i.offsetLeft-(f?c/2:c)+i.offsetWidth/2,o=e(n.offsetLeft)-n.offsetWidth-(k?g/2:0)+n.offsetWidth/2):2===s?(r=i.offsetLeft-(f?c/2:c)+i.offsetWidth/2,o=n.offsetLeft-(k?g/2:g)+n.offsetWidth/2):(r=e(i.offsetLeft)-i.offsetWidth-(f?c/2:0)+i.offsetWidth/2,o=n.offsetLeft-(k?g/2:g)+n.offsetWidth/2),a.start.offset=r,a.end.offset=o),0===s&&p>h||1===s&&p+c+r>h-o&&_>u||2===s&&h+g>p+c||3===s&&(p-r<h+g+o&&_>u||p-r>h+g+o&&u>_)){l=!0;let e=d;d=m,m=e,e=r,r=o,o=e,e=c,c=g,g=e,e=p,p=h,h=e,e=u,u=_,_=e}let D=p,x=h;!l&&1===s||l&&3===s?D+=c:!l&&3===s||l&&1===s?x+=g:2===s&&(D+=c,x+=g);let w=t.$.timelineConnectionsContainer.querySelectorAll(".smart-task-connection[connection-id^=\""+C+"-"+y+"-\"]");0===w.length&&(w=t.$.timelineConnectionsContainer.querySelectorAll(".smart-task-connection[connection-id^=\""+(y+"-"+C)+"\"]")),a.connections=[].slice.call(w),a.start.x=D,a.start.y=u+i.offsetTop,a.start.task=d,a.end.x=x,a.end.y=_+n.offsetTop,a.end.task=m,a.type=s,a.inverted=l}_createTaskConnection(){function e(c){_===d||(c?"horizontal"===c?(k=_-d+(D?-1:1)*r,_=T>C?_-t(k):_,a._createConnectingElement(_,f,(T===C?0:t(k))+(S?n:0),"horizontal"),_=T<C?_-k:_,e("vertical")):(k=t(f-m),f+=l<m?0:-1*k,_-=p&&1===g||!p&&3===g&&l>m?n:0,a._createConnectingElement(_,f,k,"vertical"),e()):(_?(k=t(_-d),_>=d&&(_+=-1*k,k+=n),a._createConnectingElement(_,f+(l<m?t(f-m):0),k,"horizontal",!i.inverted),_=d):(_=s,f=l,(0===g||!p&&3===g||p&&1===g)&&(_-=r),a._createConnectingElement(_,f,r,"horizontal",i.inverted),S&&(_+=r-n),D||w?(a._createConnectingElement(_,f-=l>m?o:0,o,"vertical"),f+=l<m?o:0):e("vertical")),e("horizontal")))}var t=Math.abs;const a=this,i=a._connectionDetails;if(!i)return;const n=2,s=i.start.x,l=i.start.y,r=i.start.offset,o=i.start.point.offsetTop,d=i.end.x,m=i.end.y,c=i.end.offset,g=i.type,p=i.inverted,h=!p&&3===g||p&&1===g,u=!p&&1===g||p&&3===g;let _,f,k,T=s,C=d;h?(T=s-c,C=d+c):u&&(T=s+r,C=d-c);const D=T<=C&&h,w=T>=C&&u,S=2===g||u;e(),i.connections.map(e=>e.parentElement.removeChild(e))}_getTaskIndexById(e){const t=this;if("number"==typeof e)return e;const a=t._tasks;if("object"==typeof e)return a.indexOf(e);if("string"==typeof e){for(let i=0;i<a.length;i++){const t=a[i];if(t.id===e)return i}return isNaN(parseInt(e))?-1:parseInt(e)}}_refreshTaskConnections(e){const t=this,a=e instanceof HTMLElement?e._task:e,i=t._tasks.indexOf(a);if(void 0===i||e.classList&&e.classList.contains("smart-visibility-hidden"))return;let n;if(t._dragDetails&&(n=t._dragDetails.relatedConnections[i]),!n){n={};const e=t._tasks;for(let a=0;a<e.length;a++){const s=e[a].connections.filter(e=>t._getTaskIndexById(e.target)===i);0<s.length&&(n[a]=s)}t._dragDetails&&(t._dragDetails.relatedConnections[i]=n)}const s=a.connections;for(let a=0;a<s.length;a++){const e=s[a];t._connectTask(i+"-"+t._getTaskIndexById(e.target)+"-"+e.type)}if(0<Object.keys(n).length)for(const e in n){const a=n[e];for(let i=0;i<a.length;i++)t._connectTask(e+"-"+t._getTaskIndexById(a[i].target)+"-"+a[i].type)}}_dragStartHandler(e){const t=this,a=e.target.closest;(t._dragDetails||a&&a.call(t,"smart-gantt-chart")===t)&&e.preventDefault()}_getFirstCellObjInView(e){const t=this;if(e||(e=t._timelineCells),!e)return;const a=t.scrollLeft;let i;for(let t=0;t<e.length;t++){const n=e[t];if(n.left+n.width>a){i=n;break}}return i}_getSubTaskLimits(e){var t=Math.max;const a=this;if(!e)return;const i=e._task,n=i.tasks;let s,l;if(!i.tasks||0===i.tasks.length)return;let r=n[0],o=n[0];for(let t=0;t<n.length;t++){const e=n[t];n[t].dateEnd&&n[t].dateStart&&(r.dateStart||(r=e[t]),o.dateEnd||(o=e[t]),n[t].dateEnd.getTime()>o.dateEnd.getTime()&&(o=n[t]),n[t].dateStart.getTime()<r.dateStart.getTime()&&(r=n[t]))}const d=a.$.timelineTasksContainer.children;let m;if(r&&(m=d[a._tasks.indexOf(r)],m&&(s=t(0,e.offsetLeft-m.offsetLeft))),o&&(m=d[a._tasks.indexOf(o)],m)){const i=a.$.timelineCellsContainer.children[a._tasks.indexOf(o)];l=t(e.offsetLeft,e.offsetLeft+i.offsetWidth-(m.offsetLeft+m.offsetWidth))}return{min:s,max:l}}_getTaskDragLimits(e){var t=Math.max;const a=this,i=a._getTaskBarPositionLimits(e,"DateStart"),n=a._getTaskBarPositionLimits(e,"DateEnd"),s=a._dragDetails.timelineTask;let l={};return(i.min||n.min)&&(l.min=t(i.min||0,t(0,(n.min||0)-s.offsetWidth))),n.max&&(l.max=t(0,n.max-s.offsetWidth)),i.max&&(l.max=l.max?Math.min(i.max,l.max):i.max),l}_getTaskBarDateRange(e){if(!e)return;const t=this,a=parseFloat(e.style.left)||e.offsetLeft,i=parseFloat(e.style.width)||e.offsetWidth,n=e._cellStart,s=e._cellEnd,l=e._task,r=l.minDateStart,o=l.maxDateEnd;let d,m;return d=t._getDateFromCell(a,n),r&&(d=new Date(Math.max(r.getTime(),d.getTime()))),m=t._getDateFromCell(a+i,s),o&&(m=new Date(Math.min(o.getTime(),m.getTime()))),{dateStart:d,dateEnd:m}}_getTaskBarDetails(e){const t=this;if(!e.classList||!e.classList.contains("smart-timeline-task"))return;const a=t.$.timelineCellsContainer.children[t._tasks.indexOf(e._task)];if(!a)return;let i=new Date(a._task.dateStart);const n=new Date(a._task.dateEnd),s=e._cellStart,l=e._cellEnd;if(!s||!l)return void e.classList.add("smart-visibility-hidden");if(t.snapToNearest){let i,n,r=e._task.dateStart,o=e._task.dateEnd;const d=new Date(s.date),m=t._getDateFromCell(s.left+s.width,s),c=new Date(l.date),g=t._getDateFromCell(l.left+l.width,l);return m.getTime()-r.getTime()>=m.getTime()-d.getTime()?(r=d,i=s.left):(r=m,i=s.left+s.width),"milestone"!==e._task.type&&(g.getTime()-o.getTime()>=o.getTime()-c.getTime()?(o=c,n=l.left-i):(o=g,n=l.left-i+l.width)),e._task.dateEnd=o,e._task.dateStart=r,{left:i,width:n,top:a.offsetTop}}let r,o,d,m,c,g;switch(t.view){case"year":{d=new Date(i.getFullYear(),i.getMonth()+1,0).getDate(),m=new Date(n.getFullYear(),n.getMonth()+1,0).getDate();const e=i.getHours()/24+i.getMinutes()/1440+i.getSeconds()/86400,t=n.getHours()/24+n.getMinutes()/1440+n.getSeconds()/86400;r=s.left+(i.getDate()-1+e)/d*s.width,o=l.left+(n.getDate()-1+t)/m*l.width-r;break}case"month":{c=parseFloat(i.getHours()+"."+i.getMinutes()+i.getSeconds())/24*(s.width/7),g=parseFloat(n.getHours()+"."+n.getMinutes()+n.getSeconds())/24*(s.width/7),r=s.left+i.getDay()/7*s.width+c,o=l.left+n.getDay()/7*l.width-r+g;break}case"week":{c=parseFloat(i.getHours()+"."+i.getMinutes()+i.getSeconds())/24*s.width,g=parseFloat(n.getHours()+"."+n.getMinutes()+n.getSeconds())/24*s.width,r=s.left+c,o=l.left+(g-c)-s.left;break}case"day":c=parseFloat(i.getMinutes()+i.getSeconds()/60)/60*s.width,g=parseFloat(n.getMinutes()+n.getSeconds()/60)/60*s.width,r=s.left+c,o=l.left+(g-c)-s.left;}return{width:"milestone"===a._task.type?"":o,left:r,top:a.offsetTop}}_getTimelineTaskCellByDate(e,t){if(!t||!e)return;const a=this;e.classList&&e.classList.contains("smart-timeline-task")&&(e=a.$.timelineCellsContainer.children[a._tasks.indexOf(e._task)]);const i=a._timelineCells;let n;dateCellsLoop:for(let e=0;e<i.length;e++){const s=i[e];switch(a.view){case"year":if(s.date.getYear()===t.getYear()&&s.date.getMonth()===t.getMonth()){n=i[e];break dateCellsLoop}break;case"month":{let a=new Date(s.date);if(a.setDate(a.getDate()+(6-a.getDay())+1),a.setMilliseconds(a.getMilliseconds()-1),t.getTime()>=s.date.getTime()&&t.getTime()<=a.getTime()){n=i[e];break dateCellsLoop}break}case"week":if(s.date.getYear()===t.getYear()&&s.date.getMonth()===t.getMonth()&&s.date.getDate()===t.getDate()){n=i[e];break dateCellsLoop}break;case"day":if(s.date.getYear()===t.getYear()&&s.date.getMonth()===t.getMonth()&&s.date.getDate()===t.getDate()&&s.date.getHours()===t.getHours()){n=i[e];break dateCellsLoop}}}return n}_handleInverted(e){const t=this;if(!e||t.inverted){const e=t.$.mainSplitter,a=t.$.timelineSplitterItem;a.size=a.offsetWidth,e.removeChild(a),t.inverted?e.insertBefore(a,t.$.treeSplitterItem):e.appendChild(a)}}_handleTaskProgressChange(e){var t=Math.max,a=Math.min;const i=this,n=i._dragDetails.target,s=n.closest(".smart-timeline-task");if(!i.hasAttribute("progress-change")){if(i.$.fireEvent("progressChangeStart",{taskId:i._tasks.indexOf(s._task),progress:s._task.progress||0}).defaultPrevented)return void delete i._dragDetails.target;i.setAttribute("progress-change",""),i._scrollView.disableSwipeScroll=!0}const l=s.querySelector(".smart-timeline-task-progress"),r=l.parentElement,o=r.getBoundingClientRect().left,d=r.offsetWidth,m=e.pageX-window.pageXOffset;i._dragDetails.progress||(i._dragDetails.progress=l.offsetWidth),i._dragDetails.progress=t(0,a(d,i._dragDetails.progress+(m-i._dragDetails.coordinates.x))),i._dragDetails.coordinates.x=t(o+i._dragDetails.offset.x,a(o+d+i._dragDetails.offset.x,m)),n.style.left=l.style.width=100*(i._dragDetails.progress/d)+"%"}_handleTaskBarDrag(e){var t=Math.max,a=Math.min;const i=this;if(5>=Math.abs(e.pageX-i._dragDetails.coordinates.x))return;const n=i._dragDetails.timelineTask,s=i.$.timelineCellsContainer.children[i._tasks.indexOf(n._task)];if(!i.hasAttribute("dragged")){if(i.$.fireEvent("dragStart",{dateStart:n._task.dateStart,dateEnd:n._task.dateEnd}).defaultPrevented)return void delete i._dragDetails.timelineTask;i.setAttribute("dragged",""),i._scrollView.disableSwipeScroll=!0;const e=i._createDelimiter("min-date"),t=i._createDelimiter("max-date");e&&s.appendChild(e),t&&s.appendChild(t)}i._dragDetails.position||(i._dragDetails.position={x:i._dragDetails.originalPosition.x,y:i._dragDetails.originalPosition.y});const l=s.getBoundingClientRect().left,r=s.offsetWidth,o=n.offsetWidth,d=i._dragDetails.min.left||0,m=i._dragDetails.max.left,c=e.pageX-window.pageXOffset;let g=0;i._dragDetails.position.x=t(d,a(r-o,i._dragDetails.position.x+(c-i._dragDetails.coordinates.x))),m!==void 0&&(i._dragDetails.position.x=a(m,i._dragDetails.position.x),g=r-o-m),i._dragDetails.coordinates.x=t(l+i._dragDetails.offset.x+d,a(l+r-(o-i._dragDetails.offset.x+g),c));const p=i._dragDetails.position.x-n.offsetLeft;n.style.left=i._dragDetails.position.x+"px",i._refreshTask(n),i._refreshProject(n._task.project),"project"===n._task.type&&n._task.dragProject&&i._refreshProjectTasks(s,p)}_handleTaskBarResize(e){var t=Math.max,a=Math.min;const i=this,n=i._dragDetails.timelineTask,s=i.$.timelineCellsContainer.children[i._tasks.indexOf(n._task)];let l;if(!i.hasAttribute("resized")){if(i.$.fireEvent("resizeStart",{dateStart:n._task.dateStart,dateEnd:n._task.dateEnd}).defaultPrevented)return void i.$.timeline.removeAttribute("task-bar-hovered");i.setAttribute("resized",""),i._scrollView.disableSwipeScroll=!0}if(i._dragDetails.position||(i._dragDetails.position={x:i._dragDetails.originalPosition.x,y:i._dragDetails.originalPosition.y}),i._dragDetails.size||(i._dragDetails.size={width:i._dragDetails.originalSize.width}),l)return;const r=i.$.timeline.getAttribute("task-bar-hovered"),o=s.getBoundingClientRect().left,d=i._dragDetails.min.width||0,m=i._dragDetails.max.width,c=e.pageX-window.pageXOffset;let g=i._dragDetails.size.width,p="object"==typeof e?c-i._dragDetails.coordinates.x:e;"left"===r?(0<p?p=a(p,g-(d||0)):void 0!==m&&(p=-1*a(m-g,Math.abs(p))),g=i._dragDetails.size.width=t(d,a(n.offsetLeft+g,g-p)),n.style.left=t(0,(parseFloat(n.style.left)||n.offsetLeft)+p)+"px",i._dragDetails.coordinates.x=t(o+n.offsetLeft,a(o+n.offsetLeft+g-d,c))):(0<p&&void 0!==m&&(p=a(m-g,p)),g=i._dragDetails.size.width=t(d,a(s.offsetWidth-n.offsetLeft,g+p)),i._dragDetails.coordinates.x=t(o+n.offsetLeft+d,a(o+n.offsetLeft+(m||g),c))),n.style.width=i._dragDetails.size.width+"px",i._refreshTask(n),i._refreshProject(n._task.project)}_handleTimelineConnectionHover(e){const t=this;if((t.shadowRoot||t).contains(e)){const a=t.$.timelineConnectionsContainer.children,i=e.closest(".smart-task-connection");if(!i&&t.$.timelineConnectionsContainer.querySelector(".smart-task-connection[hover]")){for(let e=0;e<a.length;e++)a[e].removeAttribute("hover");return}if(i){const e=i.getAttribute("connection-id");for(let t=0;t<a.length;t++){const i=a[t];i.getAttribute("connection-id")===e?i.setAttribute("hover",""):i.removeAttribute("hover")}t._hoveredConnectionTasks=i.tasks}}}_handleTimelineHover(e,t){function a(){i._hoveredTimelineTask&&(i._hoveredTimelineTask.removeAttribute("hover"),i.$.timeline.removeAttribute("task-bar-hovered"),delete i._hoveredTimelineTask)}const i=this,n=e.originalEvent||e;let s=n.pageX&&Smart.Utilities.Core.isMobile?document.elementFromPoint(n.pageX-window.pageXOffset,n.pageY-window.pageYOffset):n.target;if(n.pageX&&i.shadowRoot&&s===i&&(s=n.pageX&&Smart.Utilities.Core.isMobile?i.shadowRoot.elementFromPoint(n.pageX-window.pageXOffset,n.pageY-window.pageYOffset):n.composedPath()[0]),!s||!s.closest)return;i._handleTimelineConnectionHover(s);let l=s.closest(".smart-timeline-task-cell")||s.closest(".smart-timeline-task");if(t||!l||!(i.shadowRoot||i).contains(l))return void a();l.classList.contains("smart-timeline-task-cell")&&(l=i.$.timelineTasksContainer.children[i._tasks.indexOf(l._task)]);const r=l&&i._connectionFeedback&&l.contains(i._connectionFeedback);if((l!==i._hoveredTimelineTask||r&&i._hoveredTimelineTask===l)&&a(),l&&!r){if(i._hoveredTimelineTask=l,r)return;l.setAttribute("hover","")}i._hoverTask(i._tasks.indexOf(l._task))}_resizeEventHandler(){const e=this,t=e.$.timelineCellsContainer.children,a=e.offsetWidth!==e.$.timeline.offsetWidth;if(!e._timelineCells)return void e._refresh();a?(e.$.mainSplitter._resizeEventHandler(),e._createTimelineCells()):e._refresh(),e._recycle();for(let i=0;i<t.length;i++)e._setTimelineTaskBar(t[i]._task,a),e._refreshTaskConnections(t[i]._task);e.$.timeline.scrollLeft=e.scrollLeft,e.$.timelineContent.scrollTop=e.scrollTop,e.$.taskTree._checkOverflow(),e.$.treeSplitter._resizeEventHandler(),e.$.mainSplitter._resizeEventHandler()}_recycle(e){const t=this;if(!e||"horizontal"===e.context.orientation)return t._recycleHeaderCells(t.$.timelineViewCells),void t._recycleHeaderCells(t.$.timelineViewDetails);const a=t.$.treeSplitter._items;for(let n=0;n<a.length;n++){const i=a[n];if(i===t.$.taskTreeSplitterItem)t.$.taskTree.$.scrollViewer.scrollTop=e.detail.value;else{const t=i.getElementsByClassName("smart-task-tree-content")[0];t.scrollTop=e.detail.value}}}_recycleHeaderCells(e){const t=this,a=e.children,i=t.scrollLeft,n=e===t.$.timelineViewCells,s=n?t._timelineCells:t._timelineHeaderCells;if(!s.length)return;let l=document.createDocumentFragment();for(;a.length;)l.appendChild(e.firstElementChild);const r=t._getFirstCellObjInView(s),o=1-(r.left+r.width-i)/s[0].width,d=l.children.length,m=n?Math.ceil((parseFloat((t.$.timeline.offsetWidth/r.width).toFixed(2))+o).toFixed(2)):t._getHeaderVisibleCellsCount();if(d>m)for(;l.children.length!==m;)l.removeChild(l.firstElementChild);else if(d<m)for(const e=t._createCells(m-d);e.children.length;)l.appendChild(e.firstElementChild);const c=n?t._getCellsViewType():t.view;let g=s.indexOf(r);for(let a=0;a<l.children.length;a++){const e=l.children[a],i=s[g];if(!i)break;let r=new Date(i.date);n||"week"!==t.view||r.setDate(r.getDate()-r.getDay()),e.style.left=i.left+"px",e.style.width=i.width+"px",e._date=r,e.innerHTML=t._getDateString(r,c,!n),i.weekend?e.setAttribute("weekend",""):e.removeAttribute("weekend"),i.nonworking?e.setAttribute("nonworking",""):e.removeAttribute("nonworking"),g++}e.appendChild(l)}_refresh(){function e(){const e=a.$.timelineCellsContainer.offsetWidth-a.$.timeline.offsetWidth;return 0<e&&"hidden"!==a.horizontalScrollBarVisibility||"visible"===a.horizontalScrollBarVisibility?a.$container.addClass("hscroll"):a.$container.removeClass("hscroll"),e}function t(){const e=a.$.timelineCellsContainer.offsetHeight-a.$.timelineContent.offsetHeight;return 0<e&&"hidden"!==a.verticalScrollBarVisibility||"visible"===a.verticalScrollBarVisibility?a.$container.addClass("vscroll"):a.$container.removeClass("vscroll"),e}const a=this;let i=a.scrollWidth,n=a.scrollHeight;a.scrollWidth=e(),a.scrollHeight=t(),a.scrollHeight&&n===a.scrollHeight||(a.scrollWidth=e()),a.scrollWidth&&i===a.scrollWidth||(a.scrollHeight=t())}_refreshProjectTasks(e,a){const i=this,t=e._task;if(t.tasks&&(!(t.tasks instanceof Array)||0!==t.tasks.length)){const e=t.tasks;for(let n=0;n<e.length;n++){const t=i.$.timelineTasksContainer.children[i._tasks.indexOf(e[n])];t&&(t.style.left=t.offsetLeft+a+"px",i._refreshTask(t))}}}_refreshProject(e){const t=this;if(e){if(!e.synchronized)return void t._refreshProject(e.project);for(;e;){const a=e.tasks;let i=a[0],n=a[0];for(let e=0;e<a.length;e++)i.dateStart.getTime()>a[e].dateStart.getTime()&&(i=a[e]),n.dateEnd.getTime()<a[e].dateEnd.getTime()&&(n=a[e]);const s=t.$.timelineTasksContainer.children[t._tasks.indexOf(e)],l=t.$.timelineTasksContainer.children[t._tasks.indexOf(i)],r=t.$.timelineTasksContainer.children[t._tasks.indexOf(n)];if(!s)return;l&&e.dateStart.getTime()!==i.dateStart.getTime()&&(e.dateStart=i.dateStart,s.style.width=s.offsetWidth-(l.offsetLeft-s.offsetLeft)+"px",s.style.left=l.style.left),r&&e.dateEnd.getTime()!==n.dateEnd.getTime()&&(e.dateEnd=n.dateEnd,s.style.width=s.offsetWidth-(s.offsetLeft+s.offsetWidth-(r.offsetLeft+r.offsetWidth))+"px"),t._refreshTask(s),e=e.project}}}_refreshTask(e){const t=this,a=t._getTaskBarCellRange(e),i=a.cellStart,n=a.cellEnd;if(a&&i&&n){e._cellStart=i,e._cellEnd=n;const a=t._getTaskBarDateRange(e);if(a){const i=e._task,n=t._tasks.indexOf(i),s=t.$.timelineCellsContainer.children[n];s&&(s._task.dateStart=i.dateStart=a.dateStart,s._task.dateEnd=i.dateEnd=a.dateEnd,s._task.duration=i.duration=t._convertDuration(0<t.nonworkingDays.length||0<t.nonworkingHours.length?t._getWorkingTime(i.dateStart,i.dateEnd):i.dateEnd.getTime()-i.dateStart.getTime(),!0),t._refreshTaskConnections(e),t._refreshTaskColumnsData(i,["dateStart","dateEnd","duration"]))}}}_refreshTaskColumnsData(e,t){function a(e){for(let t=0;t<s.length;t++)if(s[t].value===e)return t}const n=this,s=n.taskColumns;if(!e)return;const l=n.$.treeSplitter,r=n._tasks.indexOf(e);let o=[];if(t)for(let e=0;e<t.length;e++){const i=a(t[e]);void 0!==i&&o.push(i)}else o=s.map((e,t)=>t);for(let a=0;a<o.length;a++){const t=l._items[o[a]],i=s[o[a]];let d;t&&(t===n.$.taskTreeSplitterItem?(d=t.querySelectorAll("smart-tree-item, smart-tree-items-group")[r],d&&(d.label=n._formatColumnData(e,i))):(d=t.getElementsByClassName("smart-task-label-container")[r],d.innerHTML=n._formatColumnData(e,i)))}}_removeConnection(e,t){const a=this,n=a.$.timelineConnectionsContainer;if(e.classList&&e.classList.contains("smart-task-connection")?e=e.getAttribute("connection-id"):e+="",void 0===e)return;const s=n.querySelectorAll(".smart-task-connection[connection-id^=\""+e+"\"]"),i=a._tasks,l=a.$.timelineTasksContainer.children,r=e.split("-"),o=parseInt(r[0]),d=parseInt(r[1]);for(let a=0;a<s.length;a++)n.removeChild(s[a]);a._updateConnection(e,!0),l[o]&&0===i[o].connections.length&&!i.find(e=>e.connections.find(e=>a._getTaskIndexById(e.target)===o))&&l[o].removeAttribute("connected"),l[d]&&0===i[d].connections.length&&!i.find(e=>e.connections.find(e=>a._getTaskIndexById(e.target)===d))&&l[d].removeAttribute("connected"),!t&&a.autoSchedule&&(a._autoScheduleRestore(i[d],parseInt(r[2])),a._autoSchedule(i[d]))}_removeConnectionsToTask(e,a,i){const n=this;if(e){a||(a=n._tasks);for(let s=0;s<a.length;s++){const t=a[s];if(!t.connections||!t.connections.length||i&&-1<i.indexOf(t))continue;const l=t.connections;for(let t=0;t<l.length;t++)l[t].target===e&&n._removeConnection(s,e)}}}_setConnectionPoints(e){const t=this;let a;if(!e||t._hoveredTimelineTask!==e){const e=t.$.timelineCellsContainer.children;for(let i=0;i<e.length;i++){const t=e[i];if(t&&!t.hasAttribute("selected")){a=t.getElementsByClassName("smart-task-connection-point");for(let e=0;e<a.length;e++)a[e].classList.add("smart-visibility-hidden")}}return}a=e.getElementsByClassName("smart-task-connection-point");for(let t=0;t<a.length;t++)a[t].classList.remove("smart-visibility-hidden")}_selectTask(e){const t=this,a=t._tasks.indexOf(e);if(0>a)return void t._unselectAllTasks();const i=t.$.timelineCellsContainer.children[a],n=t.$.timelineTasksContainer.children[a];if(i&&i.hasAttribute("selected"))return void t._unselectAllTasks();const s=t.selectedIndexes.slice(0);t._unselectAllTasks(!0),i&&i.setAttribute("selected",""),n&&n.setAttribute("selected","");const l=document.scrollingElement||document.documentElement,r=l.scrollLeft,o=l.scrollTop;t.$.taskTree.focus(),window.scrollTo(r,o),t.$.taskTree.select(t.$.taskTree.querySelectorAll("smart-tree-item, smart-tree-items-group")[a]);const d=t.$.treeSplitter._items;for(let n=0;n<d.length;n++){const e=d[n];let i;e!==t.$.taskTreeSplitterItem&&(i=[].slice.call(e.getElementsByClassName("smart-task-label-container")),i[a]&&i[a].setAttribute("selected",""))}const m=n._cellStart;if(t.scrollLeft>m.left&&t.scrollLeft>m.left+n.offsetWidth||t.scrollLeft+t.$.timeline.offsetWidth<m.left){const e=t._timelineCells.indexOf(m);t._scrollTo((t._timelineCells[e-1]?t._timelineCells[e-1]:m).date)}s[0]!==a&&(t.selectedIndexes=[a],t.$.fireEvent("change",{value:[a],oldValue:s}))}_snapToNearest(e){const a=this;if(e instanceof HTMLElement&&e.classList.contains("smart-timeline-task")&&a.snapToNearest){const t=a._getTaskBarCellRange(e);if(!t)return;const i=t.cellStart,n=t.cellEnd;let s=parseFloat(e.style.width)||e.offsetWidth,l=parseFloat(e.style.left)||e.offsetLeft;if(a.hasAttribute("dragged")){const t=n.width-(l+s-n.left);e.style.left=l-i.left<=t?i.left+"px":l+t+"px"}else if(a.hasAttribute("resized")){const t=i===n?parseFloat(getComputedStyle(a).getPropertyValue("--smart-gantt-chart-timeline-task-min-width"))||0:0;let r;"left"===a.$.timeline.getAttribute("task-bar-hovered")?(r=l-i.left,r-=r>=i.width/2?i.width-t:0,e.style.left=(l-=r)+"px",r=l+s>n.left+n.width/2?n.left+n.width-(l+s):n.left-(l+s),e.style.width=Math.max(t,s+r)+"px"):(e.style.left=l>i.left+i.width/2?i.left+i.width+"px":i.left+"px",l=parseFloat(e.style.left)||e.offsetLeft,r=l+s-n.left,r=-1*(r-(r>=i.width/2?n.width:t)),e.style.width=s+r+"px")}a._refreshTask(e);const r=e._task;if("project"!==r.type||!r.dragProject)return;const o=r.tasks;if(!o||!Array.isArray(o))return;for(let e=0;e<o.length;e++){const t=a.$.timelineTasksContainer.children[a._tasks.indexOf(o[e])];t&&a._snapToNearest(t)}}}_setDragLimits(e){var t=Math.min;const a=this;if(a._dragDetails){const i=a._dragDetails.timelineTask;if(i&&e){const n=a.$.timeline.getAttribute("task-bar-hovered"),s=i._task;if(n){if(s.disableResize)return void delete a._dragDetails;const e=a._getTaskBarSizeLimits(i,n);a._dragDetails.min.width=e.min,a._dragDetails.max.width=e.max;const t=a._createDelimiter("min",n),l=a._createDelimiter("max",n);t&&i.appendChild(t),l&&i.appendChild(l)}else if(e.closest(".smart-task-connection-point"))a._dragDetails.timelineTask=void 0;else if(e.closest(".smart-timeline-task")===i){if(s.disableDrag||i.hasAttribute("connected")&&a.autoSchedule&&a.autoScheduleStrictMode)return void delete a._dragDetails.target;a._dragDetails._taskDuration=a._getWorkingTime(s.dateStart,s.dateEnd),i.classList.contains("milestone")&&(a._dragDetails.target=i.getElementsByClassName("smart-timeline-task-fill")[0]);const e=a._getTaskDragLimits(i);if(void 0!==e.min&&(a._dragDetails.min.left=e.min,"project"===i._task.type&&e.min>i.offsetLeft&&(a._dragDetails.min.left=i.offsetLeft)),void 0!==e.max&&(a._dragDetails.max.left=e.max,"project"===i._task.type&&e.max<i.offsetLeft&&(a._dragDetails.max.left=i.offsetLeft)),"project"===s.type&&s.dragProject&&!a.synchronized){const e=a._getSubTaskLimits(i);void 0!==e.min&&(a._dragDetails.min.left=a._dragDetails.min.left?t(a._dragDetails.max.left,e.min):e.min),void 0!==e.max&&(a._dragDetails.max.left=a._dragDetails.max.left?t(a._dragDetails.max.left,e.max):e.max)}else"milestone"===s.type&&(a._dragDetails.target=i.getElementsByClassName("smart-timeline-task-fill")[0])}else a._dragDetails.timelineTask=void 0;a._dragDetails.relatedConnections={}}}}_setScrollBars(){const e=this;e._scrollView||(e._scrollView=new Smart.Utilities.Scroll(e,e.$.horizontalScrollBar,e.$.verticalScrollBar));const t=e._scrollView.vScrollBar,a=e._scrollView.hScrollBar;a.$.addClass("smart-hidden"),t.$.addClass("smart-hidden"),t.hasStyleObserver=!1,a.hasStyleObserver=!1,t.hasResizeObserver=!1,a.hasResizeObserver=!1,a.wait=!1,e._refresh()}_getWorkingTime(e,t){function a(e,t){let a,s,l=t.getTime()-e.getTime(),r=new Date(e),o=0;for(;0<l;){const e=i(l,3600000-(1e3*(60*r.getMinutes())+1e3*r.getSeconds()+r.getMilliseconds()));if(-1<n.nonworkingDays.indexOf(r.getDay())){s=new Date(r),s.setHours(0,0,0,0),s.setDate(r.getDate()+1),a=i(e,s.getTime()-r.getTime()),r=new Date(r.getTime()+a),l-=a;continue}if(-1<n.nonworkingHours.indexOf(r.getHours())){s=new Date(r);const t=s.getTime();s.setHours(r.getHours()+1,0,0,0),t===s.getTime()&&s.setHours(r.getHours()+2,0,0,0),a=i(e,s.getTime()-r.getTime()),r=new Date(r.getTime()+a),l-=a;continue}o+=e,l-=e,r=new Date(r.getTime()+e)}return o}var i=Math.min;if(!e||!t)return;const n=this;if(e.getFullYear()===t.getFullYear())return a(e,t);let s=new Date(e.getFullYear()+1,0,1,0,0,0,0),l=a(e,s);if(t.getFullYear()>s.getFullYear()){const e=Math.max(0,t.getFullYear()-s.getFullYear());for(let t,a=0;a<e;a++)t=n._getWorkingDaysBetweenDays(s),l+=1e3*(60*(60*(24*t-t*n.nonworkingHours.length))),s.setFullYear(s.getFullYear()+1)}return l+=a(s,t),l}_getWorkingDaysBetweenDays(e){const t=this,a=e.getFullYear(),i=(0==a%100?0==a%400:0==a%4)?366:365;let n=new Date(e),s=0;for(let a=0;a<i;a++)0>t.nonworkingDays.indexOf(n.getDay())&&s++,n.setDate(n.getDate()+1);return s}_setFocusable(){const e=this;return e.disabled||e.unfocusable?void(e.tabIndex=-1):void(e.tabIndex=0<e.tabIndex?e.tabIndex:0)}_setTaskBarLabel(e,t){const a=this,i=(a.shadowRoot||a).querySelectorAll(".smart-timeline-task")[a._tasks.indexOf(e)];if(i){const a=i.getElementsByClassName("smart-timeline-task-label")[0];a&&(a.innerHTML=t||e.label)}}_setTaskBarProgress(e){const t=this,a=(t.shadowRoot||t).querySelectorAll(".smart-timeline-task")[t._tasks.indexOf(e)];if(a){let t=e.progress;const i=a.querySelector(".smart-timeline-task-progress"),n=a.querySelector(".smart-timeline-task-progress-thumb");i&&(n.style.left=i.style.width=(Math.min(100,Math.max(0,t))||0)+"%")}}_setTimelineTaskBar(e,t){const a=this,i=a._tasks.indexOf(e),n=a.$.timelineTasksContainer.children,s=n[i];let l,r;if(0!==n.length&&s){l=!t&&s._cellStart||a._getTimelineCellByDate(e.dateStart instanceof Date?e.dateStart:new Date(e.dateStart)),r=!t&&s._cellEnd||a._getTimelineCellByDate(e.dateEnd instanceof Date?e.dateEnd:new Date(e.dateEnd)),s._cellStart=l,s._cellEnd=r;const i=a._getTaskBarDetails(s);i&&(s.style.top=i.top+"px",s.style.left=i.left+"px",s.style.width=i.width+"px"),e.project&&!a._isTaskExpanded(e)?s.classList.add("smart-visibility-hidden"):s.classList.remove("smart-visibility-hidden")}}_getTimelineCellByDate(e){const t=this,a=t._timelineCells;if(a&&0!==a.length)for(let i=0;i<a.length;i++){const n=a[i],s=n.date;switch(t.view){case"year":if(s.getFullYear()===e.getFullYear()&&s.getMonth()===e.getMonth())return n;break;case"month":{const t=new Date(s);let a=new Date(s);if(a.setDate(a.getDate()+(6-a.getDay())+1),a.setMilliseconds(a.getMilliseconds()-1),e.getTime()>=t.getTime()&&e.getTime()<=a.getTime())return n;break}case"week":if(s.getFullYear()===e.getFullYear()&&s.getMonth()===e.getMonth()&&s.getDate()===e.getDate())return n;break;case"day":if(s.getFullYear()===e.getFullYear()&&s.getMonth()===e.getMonth()&&s.getDate()===e.getDate()&&s.getHours()===e.getHours())return n;}}}_refreshViewDetailCell(e,t,a){const i=this,n=i._timelineCells,s=e.date;let l=0,r=0===a?0:void 0;for(void 0===t&&(t=0),t;t<n.length;t++){const e=n[t],a=i._getCellWidth(e,s);if(!a)if(e.date.getTime()>s.getTime())break;else continue;void 0===r&&(r=e.left+e.width-a),l+=a}return i._isLastWeekCellNotFull&&(delete i._isLastWeekCellNotFull,t--),e.width=l,e.left=r,t}_getCellWidth(e,t){const a=this,i=e.date,n=(e,t)=>e.getFullYear()===t.getFullYear(),s=(e,t)=>e.getMonth()===t.getMonth(),l=e.width;switch(a.view){case"month":{let e=new Date(i),r=new Date(e),o=0;for(r.setDate(r.getDate()+(6-e.getDay())+1),r.setMilliseconds(r.getMilliseconds()-1);e.getTime()<=r.getTime();)n(e,t)&&s(e,t)&&o++,e.setDate(e.getDate()+1);if(0==o)return;return a._isLastWeekCellNotFull=1!=o/7,l*o/7}case"year":if(n(i,t))return l;break;case"week":{const e=new Date(t),a=new Date(t);if(e.setDate(t.getDate()-t.getDay()),a.setDate(t.getDate()+(6-t.getDay())),i.getTime()>=e.getTime()&&i.getTime()<=a.getTime())return l;break}case"day":if(n(i,t)&&s(i,t)&&i.getDate()===t.getDate())return l;}}_getCellByOffsetLeft(e){const t=this,a=t._timelineCells;if(!e)return;let n;for(let t=0;t<a.length&&!(a[t].left>=e);t++)n=a[t];return n}_unselectAllTasks(e){const t=this,a=t.$.timelineTasksContainer,i=t.$.timelineCellsContainer;if(i.querySelector(".smart-timeline-task-cell[selected]")){const e=i.children;for(let a=0;a<e.length;a++)e[a].removeAttribute("selected")}if(a.querySelector(".smart-timeline-task[selected]")){const e=a.children;for(let a=0;a<e.length;a++)e[a].removeAttribute("selected")}t._treeChangeEventFired||t.$.taskTree.clearSelection();const n=t.$.treeSplitter.getElementsByClassName("smart-task-label-container");for(let t=0;t<n.length;t++)n[t].removeAttribute("selected");if(!e){const e=t.selectedIndexes.slice(0);e.length&&(t.selectedIndexes=[],t.$.fireEvent("change",{value:[],oldValue:e}))}}_getTaskBarCellRange(e){const t=this;if(!e.classList||!e.classList.contains("smart-timeline-task"))return;const a=t._timelineCells,i=parseFloat(e.style.left)||e.offsetLeft,n=parseFloat(e.style.width)||e.offsetWidth;let s,l;for(let t=0;t<a.length;t++){const e=a[t],r=e.left,o=e.width,d=parseFloat((r+o).toFixed(2)),m=parseFloat((i+n).toFixed(2));if(!s&&i>=r&&i<d&&(s=e),!l&&m>r&&m<=d&&(l=e),s&&l)break}return s||(s=e.classList.contains("milestone")&&l?l:a[0]),l||(l=a[a.length-1]),{cellStart:s,cellEnd:l}}_getDateFromCell(e,t,a){var i=Math.abs,n=Math.floor;if(!t)return new Date;const s=this,l=new Date(t.date);let r,o=0,d=0;switch(a||(a=s.view),a){case"year":{r=new Date(l.getFullYear(),l.getMonth()+1,0).getDate(),o=1;break}case"month":{o=l.getDate(),r=7;break}case"week":r=1,o=l.getDate();break;case"day":r=1/24,o=l.getDate(),d=l.getHours();}const m=parseFloat(((e-t.left)/t.width*r).toFixed(12)),c=Math.min(r,n(m)),g=24*(m%1),p=n(g),h=60*i(g-p),u=n(h),_=60*i(h-u),f=n(_),k=1e3*i(_-f),T=n(k);return new Date(l.getFullYear(),l.getMonth(),o+c,d+p,u,f,T)}_createTreeTasks(e,a){if(!e)return[];let i=[];for(let n=0;n<e.length;n++){const t={};t.label=e[n][a],e[n].tasks&&(t.items=this._createTreeTasks(e[n].tasks,a)),i.push(t)}return i}_getTasksJSON(){function e(e){let t={};for(let a in e){let i=e[a];"project"!=a&&(t[a]=i instanceof Date?i.toISOString():i)}return t}function a(i,n){if(i){let s=[];for(let l=0;l<i.length;l++){const t=i[l];let r;t.project&&t.project!==n||(r=e(t),r.tasks=a(t.tasks,t),s.push(r))}return s}}const t=this,i=t._tasks;return a(i)}_createTaskColumns(){const e=this,t=e._getTasksJSON(),a=e.taskColumns,n=e.$.treeSplitter.getElementsByClassName("smart-task-tree-header");if(a.length>n.length)for(;a.length>n.length;){const t=document.createElement("smart-splitter-item");t.innerHTML="<div class=\"smart-task-tree-header\"></div><div class=\"smart-task-tree-content\">",e.$.treeSplitter.appendChild(t)}else for(;n.length>a.length&&1!==n.length;)e.$.treeSplitter.removeChild(e.$.treeSplitter.lastElementChild);if(!a.length)return e.$.taskTree.dataSource=[],void(n[0].innerHTML="");const s=a.length,l=parseFloat(getComputedStyle(e).getPropertyValue("--smart-gantt-chart-timeline-cell-min-size")||0);for(let r=0;r<s;r++){const i=a[r],s=n[r],o=s.closest("smart-splitter-item");s.innerHTML=e.localize(i.label)||i.label,o&&(i.size&&(e.shadowRoot?requestAnimationFrame(()=>o.size=i.size):o.size=i.size),o.min=i.min?i.min:l,o.max=i.max?i.max:o.max),e._createTaskColumnsData(o,i,t)}e.$.mainSplitter.isCompleted&&e.$.mainSplitter.refresh(),e._refresh()}_refreshColumnsHeaders(){const e=this,t=e.taskColumns,a=e.$.treeSplitter.getElementsByClassName("smart-task-tree-header");for(let n=0;n<a.length;n++)a[n].innerHTML=e.localize(t[n].label)||t[n].label}_createTaskColumnsData(e,t,a){const i=this;if(e){const n=t.value;if(i.$.taskTreeSplitterItem===e)return void(n?(i.$.taskTree.itemsMember="tasks",i.$.taskTree.displayMember=t.value,i.$.taskTree.dataSource=a.map(e=>(e[t.value]=i._formatColumnData(e,t),e))):i.$.taskTree.dataSource=[]);const s=e.getElementsByClassName("smart-task-tree-content")[0];s&&(s.innerHTML="",n&&s.appendChild(i._createTaskContainers(a,t)))}}_createTaskContainers(e,t){const a=this,n=document.createDocumentFragment();for(let s=0;s<e.length;s++){const i=e[s],l=document.createElement("div");l.innerHTML="<div class=\"smart-task-label-container\"></div>",l.firstElementChild.innerHTML=a._formatColumnData(e[s],t),i.tasks&&0<i.tasks.length&&(l.innerHTML+="<div class=\"smart-task-drop-down"+(i.expanded?"":" smart-visibility-hidden")+"\"></div>",l.lastElementChild.appendChild(a._createTaskContainers(i.tasks,t))),l.classList.add("smart-task-item"),n.appendChild(l)}return n}_formatColumnData(e,t){const a=this,i=e[t.value];if("function"==typeof t.formatFunction)return t.formatFunction(-1<t.value.toLowerCase().indexOf("date")?new Date(i):i,a._tasks.indexOf(e));if(t.value){const e=(t.value+"").toLowerCase();if(-1<e.indexOf("date")){const e=Date.parse(i);if(!isNaN(e))return new Date(e).toLocaleDateString(a.locale,{year:"numeric",month:"2-digit",day:"numeric"})}else if(-1<e.indexOf("duration"))return parseFloat(i.toFixed(1))}return i===void 0?"":i.toString()}_validateTaskProperties(e,t){function a(e,t){return e[t]=s._dateValidator(void 0,e[t]),(!e[t]||isNaN(e[t].getTime()))&&(e[t]=void 0),e[t]}var i=Math.max,n=Math.min;const s=this;let l=s._convertDuration(parseInt(e.duration))||0,r=s._convertDuration(parseInt(e.minDuration))||0,o=s._convertDuration(parseInt(e.maxDuration))||0;if(r&&o&&(o=i(r,o)),l&&(r?l=i(r,l):o&&(l=n(l,o))),e.duration=s._convertDuration(l,!0),e.minDuration=s._convertDuration(r,!0),e.maxDuration=s._convertDuration(o,!0),e.minDateStart=a(e,"minDateStart"),e.maxDateStart=a(e,"maxDateStart"),e.minDateStart&&e.maxDateStart&&(e.maxDateStart=new Date(i(e.minDateStart.getTime(),e.maxDateStart.getTime()))),e.minDateEnd=a(e,"minDateEnd"),e.maxDateEnd=a(e,"maxDateEnd"),e.minDateEnd&&e.maxDateEnd&&(e.maxDateEnd=new Date(i(e.minDateEnd.getTime(),e.maxDateEnd.getTime()))),e.dateStart=a(e,"dateStart"),e.dateEnd=a(e,"dateEnd"),e.dateStart||(e.minDateStart?e.dateStart=e.minDateStart:e.maxDateStart&&(e.dateStart=e.maxDateStart)),e.dateEnd||(e.minDateEnd?e.dateEnd=e.minDateEnd:e.maxDateEnd&&(e.dateEnd=e.maxDateEnd)),e.minDateStart&&(e.dateStart=new Date(i(e.minDateStart.getTime(),e.dateStart.getTime()))),e.maxDateStart&&(e.dateStart=new Date(n(e.maxDateStart.getTime(),e.dateStart.getTime()))),e.minDateEnd&&(e.dateEnd=new Date(i(e.minDateEnd.getTime(),e.dateEnd.getTime()))),e.maxDateEnd&&(e.dateEnd=new Date(n(e.maxDateEnd.getTime(),e.dateEnd.getTime()))),e.dateStart&&(s.min&&(l=n(e.dateStart.getTime()-s.min.getTime(),l)),s.max&&(l=n(s.max.getTime()-e.dateStart.getTime(),l))),!(!e.dateStart&&l&&e.dateEnd&&(e.dateStart=new Date(e.dateEnd.getTime()-l),isNaN(e.dateStart.getTime())))){if(r&&e.dateStart)if(0<s.nonworkingDays.length||0<s.nonworkingHours.length){const t=s._getTaskWorkingDateEnd(e,r);e.dateEnd=new Date(i(e.dateEnd?e.dateEnd.getTime():0,t.getTime()))}else e.dateEnd=new Date(i(e.dateEnd?e.dateEnd.getTime():0,e.dateStart.getTime()+l));if(!(l&&e.dateStart&&(e.dateEnd=0<s.nonworkingDays.length||0<s.nonworkingHours.length?s._getTaskWorkingDateEnd(e,l):new Date(e.dateStart.getTime()+l),isNaN(e.dateEnd.getTime())))){if(l||o){let t;t=0<s.nonworkingDays.length||0<s.nonworkingHours.length?s._getTaskWorkingDateEnd(e,i(l,o)):new Date(e.dateStart.getTime()+i(l,o)),e.dateEnd.getTime()>t.getTime()&&(e.dateEnd=t)}if(e.dateStart=s._minMaxDateValidator(e.dateStart),e.dateEnd=s._minMaxDateValidator(e.dateEnd),"milestone"===e.type&&(e.dateStart=a(e,"dateStart"),e.dateEnd=a(e,"dateEnd"),e.dateStart=e.dateEnd=new Date(i(e.dateStart?e.dateStart.getTime():0,e.dateEnd?e.dateEnd.getTime():0))),t&&s._synchronizeProjectDates(t,e),e.dateStart||e.dateEnd||"project"!==e.type||e.synchronized){e.dateStart&&e.dateEnd&&e.dateStart.getTime()>e.dateEnd.getTime()&&(e.dateEnd=new Date(e.dateStart.getTime()+3600000*("day"===s.view?1:24))),e.dateStart&&e.dateEnd&&(e.duration=s._convertDuration(0<s.nonworkingDays.length||0<s.nonworkingHours.length?s._getWorkingTime(e.dateStart,e.dateEnd):e.dateEnd.getTime()-e.dateStart.getTime(),!0));const t=e.connections;if(!(t instanceof Array))e.connections=[];else for(let e=0;e<t.length;e++){const a=t[e],i=a.target="string"==typeof a.target?a.target:parseInt(a.target),n=a.type=parseInt(a.type);if(!i||"number"==typeof i&&isNaN(i)||isNaN(n)){t.splice(t.indexOf(a),1);continue}a.lag=parseInt(a.lag)||0}return e.class=e.class?e.class+"":"",e.class=void 0!==e.class&&null!==e.class?e.class:"",e}}}}_synchronizeProjectDates(e,t){var a=Math.max,i=Math.min;const n=e.dateStart,s=e.dateEnd;e.synchronized&&(t.dateStart&&(e.dateStart=n?new Date(i(n.getTime(),t.dateStart.getTime())):t.dateStart),t.dateEnd&&(e.dateEnd=s?new Date(a(s.getTime(),t.dateEnd.getTime())):t.dateEnd),t.minDateStart&&(e.minDateStart=e.minDateStart?new Date(a(e.minDateStart.getTime(),t.minDateStart.getTime())):t.minDateStart),t.maxDateStart&&(e.maxDateStart=e.maxDateStart?new Date(i(e.maxDateStart.getTime(),t.maxDateStart.getTime())):t.maxDateStart),t.minDateEnd&&(e.minDateEnd=e.minDateEnd?new Date(a(e.minDateEnd.getTime(),t.minDateEnd.getTime())):t.minDateEnd),t.maxDateEnd&&(e.maxDateEnd=e.maxDateEnd?new Date(i(e.maxDateEnd.getTime(),t.maxDateEnd.getTime())):t.maxDateEnd),e.dateStart&&e.dateEnd&&(e.duration=this._convertDuration(e.dateEnd.getTime()-e.dateStart.getTime(),!0))),e.project&&this._synchronizeProjectDates(e.project,t)}_mouseWheelandler(e){const t=this;if(t.computedHorizontalScrollBarVisibility||t.computedVerticalScrollBarVisibility){const a=(t.shadowRoot||t).querySelector(".smart-task-popup-window");return a&&a.modal&&a.opened?void e.stopPropagation():void(!t.disabled&&t.computedVerticalScrollBarVisibility&&(e.stopPropagation(),e.preventDefault(),t.scrollTo(t.scrollTop+t._getScrollCoefficient(e,t.offsetHeight))))}}_horizontalScrollbarHandler(e){const t=this;e.stopPropagation(),t.$.timeline.scrollLeft=e.detail.value,t._recycle(e)}_verticalScrollbarHandler(e){const t=this;return e.stopPropagation(),t.$.timelineContent.scrollTop=e.detail.value,t._recycle(e),e.context.max===e.context.value?void t.$.fireEvent("scrollBottomReached"):void(e.context.min===e.context.value&&t.$.fireEvent("scrollTopReached"))}});