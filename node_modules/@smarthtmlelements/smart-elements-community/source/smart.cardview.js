
/* Smart HTML Elements v4.6.0 (2019-Oct) 
Copyright (c) 2011-2019 jQWidgets. 
License: https://htmlelements.com/license/ */

Smart("smart-card-view",class extends Smart.BaseElement{static get properties(){return{addNewButton:{value:!1,type:"boolean"},allowDrag:{value:!1,type:"boolean"},cardHeight:{value:null,type:"number?"},cellOrientation:{value:"vertical",allowedValues:["horizontal","vertical"],type:"string"},collapsible:{value:!1,type:"boolean"},columns:{value:[],type:"object",reflectToAttribute:!1},coverField:{value:null,type:"string?"},coverMode:{value:"crop",allowedValues:["fit","crop"],type:"string"},dataSource:{value:null,type:"object?",reflectToAttribute:!1},editable:{value:!1,type:"boolean"},headerPosition:{value:"none",allowedValues:["none","top","bottom"],type:"string"},messages:{value:{en:{addFilter:"+ Add filter",addImage:"Add",and:"And",apply:"Apply",booleanFirst:"\u2610",booleanLast:"\u2611",cancel:"Cancel",CONTAINS:"contains",CONTAINS_CASE_SENSITIVE:"contains (case sensitive)",coverField:"Cover field",crop:"Crop",customizeCards:"Customize cards",dateFirst:"1",dateLast:"9",dateTabLabel:"DATE",DOES_NOT_CONTAIN:"does not contain",DOES_NOT_CONTAIN_CASE_SENSITIVE:"does not contain (case sensitive)",draggedRecord:"Record {{id}}",EMPTY:"empty",ENDS_WITH:"ends with",ENDS_WITH_CASE_SENSITIVE:"ends with (case sensitive)",EQUAL:"equal",EQUAL_CASE_SENSITIVE:"equal (case sensitive)",filter:"Filter",filteredByMultiple:"{{n}} filters",filteredByOne:"1 filter",find:"Find a field",findInView:"Find in view",firstBy:"Sort by",fit:"Fit",found:"{{nth}} of {{n}}",from:"from",GREATER_THAN:"greater than",GREATER_THAN_OR_EQUAL:"greater than or equal",imageUrl:"New image URL:",incorrectStructure:"\"dataSource\" must be an instance of Smart.DataAdapter or an array of objects with key-value pairs.",LESS_THAN:"less than",LESS_THAN_OR_EQUAL:"less than or equal",nextRecord:"Next record",noCoverField:"No cover field",noData:"No data to display",noFilters:"No filters applied",noMatches:"No matched records",noSorting:"No sorting applied",noResults:"No results",NOT_EMPTY:"not empty",NOT_EQUAL:"not equal",NOT_NULL:"not null",now:"Now",NULL:"null",numberFirst:"1",numberLast:"9",ok:"OK",or:"Or",pickAnother:"Pick another field to sort by",previousRecord:"Previous record",removeImage:"Remove",sort:"Sort",sortedByMultiple:"Sorted by {{n}} fields",sortedByOne:"Sorted by 1 field",STARTS_WITH:"starts with",STARTS_WITH_CASE_SENSITIVE:"starts with (case sensitive)",stringFirst:"A",stringLast:"Z",thenBy:"then by",timeTabLabel:"TIME",toggleVisibility:"Toggle field visibility",where:"Where"}}},onRecordInserted:{value:null,type:"function?",reflectToAttribute:!1},onRecordRemoved:{value:null,type:"function?",reflectToAttribute:!1},scrolling:{value:"physical",allowedValues:["physical","virtual","infinite","deferred"],type:"string"},titleField:{value:null,type:"string?"}}}static get listeners(){return{click:"_clickHandler",move:"_moveHandler",resize:"_resizeHandler","addNewButton.click":"_addNewButtonClickHandler","cardContainer.down":"_cardContainerDownHandler","header.apply":"_applyHandler","header.cancel":"closePanel","headerDropDown.transitionend":"_headerDropDownTransitionendHandler","searchInput.keyup":"_searchInputKeyupHandler","document.move":"_documentMoveHandler","document.up":"_documentUpHandler"}}static get requires(){return{"Smart.Button":"smart.button.js","Smart.Card":"smart.card.js","Smart.Carousel":"smart.carousel.js","Smart.CheckBox":"smart.checkbox.js","Smart.ColumnPanel":"smart.gridpanel.js","Smart.DataAdapter":"smart.data.js","Smart.DateTimePicker":"smart.datetimepicker.js","Smart.Input":"smart.input.js","Smart.NumericTextBox":"smart.numerictextbox.js","Smart.ScrollBar":"smart.scrollbar.js","Smart.SwitchButton":"smart.switchbutton.js","Smart.Window":"smart.window.js","Smart.Utilities.DateTime":"smart.date.js"}}get hasStyleObserver(){return!1}get editInfo(){return this._editInfo}static get styleUrls(){return["smart.cardview.css"]}template(){return`<div id="container">
                    <div id="header" class="smart-card-view-header smart-hidden">
                        <div id="customizeCardsButton" class="smart-card-view-header-button smart-card-view-customize-button smart-unselectable"><div></div></div>
                        <div id="filterButton" class="smart-card-view-header-button smart-card-view-filter-button smart-unselectable"><div></div></div>
                        <div id="sortButton" class="smart-card-view-header-button smart-card-view-sort-button smart-unselectable"><div></div></div>
                        <div id="searchButton" class="smart-card-view-header-button smart-card-view-search-button smart-unselectable"></div>
                        <div id="headerDropDown" class="smart-card-view-header-drop-down smart-visibility-hidden">
                            <div id="customize" class="smart-hidden"></div>
                            <div id="filter" class="smart-hidden"></div>
                            <div id="sort" class="smart-hidden"></div>
                            <div id="search" class="smart-card-view-search-box smart-hidden">
                                <input type="text" id="searchInput" spellcheck="false" />
                                <div id="searchLabel" class="smart-card-view-search-label smart-unselectable"></div>
                                <div id="searchPrev" class="smart-card-view-search-prev"></div>
                                <div id="searchNext" class="smart-card-view-search-next"></div>
                                <div id="searchClose" class="smart-card-view-search-close"></div>
                            </div>
                        </div>
                    </div>
                    <smart-scroll-viewer id="scrollViewer" animation="[[animation]]" horizontal-scroll-bar-visibility="hidden">
                        <div id="cardContainer" class="smart-card-container"></div>
                    </smart-scroll-viewer>
                    <div id="loadingIndicatorContainer" class="smart-loader-container smart-hidden">
                        <span id="loadingIndicator" class="smart-loader"></span>
                    </div>
                    <div id="addNewButton" class="smart-add-new-button"></div>
                </div>`}attached(){const e=this;super.attached(),e.isCompleted&&e._editInfo&&(e._addWindowHandlers(),document.body.appendChild(e._editInfo.window))}detached(){const e=this;if(super.detached(),!!e._editInfo){const t=e._editInfo.window;t.removeEventListener("open",e._windowEventHandler),t.removeEventListener("closing",e._windowEventHandler),t.removeEventListener("close",e._windowEventHandler),t.removeEventListener("click",e._windowClickHandler),t.removeEventListener("prev",e._prevNextHandler),t.removeEventListener("next",e._prevNextHandler),t.remove()}}ready(){super.ready()}render(){const e=this,t=e.dataSource,a=e.scrolling,i=getComputedStyle(e);Smart.Utilities.NumberRenderer&&(e._numericFormatter=new Smart.Utilities.NumberRenderer),e.shadowRoot&&(e.importStyle(Smart.Utilities.Core.getScriptLocation()+Smart.StyleBaseUrl.replace("/scoped/","/smart.scrollviewer.css")),e.importStyle(Smart.Utilities.Core.getScriptLocation()+Smart.StyleBaseUrl.replace("/scoped/","/smart.carousel.css")),e.importStyle(Smart.Utilities.Core.getScriptLocation()+Smart.StyleBaseUrl.replace("/scoped/","/smart.button.css")),e.importStyle(Smart.Utilities.Core.getScriptLocation()+Smart.StyleBaseUrl.replace("/scoped/","/smart.sortable.css"))),e._gap=parseFloat(i.getPropertyValue("--smart-card-view-gap")),e._verticalOffset=parseFloat(i.getPropertyValue("--smart-card-view-vertical-offset")),e._cards=[],e._collapsed={},e._collapsedRows={},e._numberOfCollapsedRows=0,e._cardScrolling={},e._cardSelectedCover={},e._cardHeight=e.cardHeight,e._autoCardHeight=null===e._cardHeight,e._cachedWidth=e.offsetWidth,e._cachedHeight=e.offsetHeight,e._appliedFiltering={filters:[],operator:"and"},e._appliedSorting={dataFields:[],dataTypes:[],orderBy:[]},e._start={view:0,data:0},e._autoScrollCoefficient=Smart.Utilities.Core.Browser.Firefox?8:Smart.Utilities.Core.Browser.Edge?16:4,e._isMobile=Smart.Utilities.Core.isMobile,e._normalizeDataSource(),e._getVisibleRecords(),e._normalizeColumns(),e._handleHeaderPosition(),e._localizeHeader(),e._getInnerElementMessages(),"deferred"===a?e.$.scrollViewer.$.verticalScrollBar.mechanicalAction="switchWhenReleased":("virtual"===a||"infinite"===a)&&t&&t.onVirtualDataSourceRequested===void 0&&(e.scrolling="physical"),e._createTemplate(),"infinite"===a?e._requestInitialCards():e._createCards(),e.$.scrollViewer._verticalScrollbarHandler=e._onVerticalChange.bind(e),e.$.scrollViewer.hasStyleObserver=!1,e.$.scrollViewer.$.verticalScrollBar.hasStyleObserver=!1,e.$.scrollViewer.$.horizontalScrollBar.hasStyleObserver=!1,super.render()}addFilter(e,t="and"){const a=this;if(!Array.isArray(e)||0<e.length&&!Array.isArray(e[0]))return;let i;if(a.closePanel(),arguments[2]?i={filters:arguments[2],operator:t}:(i={filters:[],operator:t},e.forEach(e=>{e[1].filters.forEach(t=>{i.filters.push([e[0],t.condition,t.value])})})),JSON.stringify(i)!==JSON.stringify(a._appliedFiltering)){const r=i.filters.length;a._appliedFiltering=i;try{a.dataSource._filter(e,t)}catch(e){return}return a._getVisibleRecords(),a._fullRefresh(),a.$.fireEvent("filter"),0===r?(a.$.filterButton.firstElementChild.innerHTML=a.localize("filter"),void a.$.filterButton.classList.remove("filtered")):void(a.$.filterButton.firstElementChild.innerHTML=1===r?a.localize("filteredByOne"):a.localize("filteredByMultiple",{n:r}),a.$.filterButton.classList.add("filtered"))}}addRecord(e,t,a="last"){function i(){"first"===a?(n.insert(0,t),n!==l._visibleSource&&l._visibleSource.unshift(n[0])):(a="last",n.insert(n.length,t),n!==l._visibleSource&&l._visibleSource.push(n[n.length-1])),l._closeSearchPanel(),l._fullRefresh()}function r(e){e&&i()}const l=this,n=l.dataSource,d=l.scrolling;if("object"==typeof t){if(0===l.dataSource.dataFields.length){const e=[t];return l.dataSource=e,void l.propertyChangedHandler("dataSource",null,e)}const o=n.id;return o&&(null!==e&&void 0!==e&&""!==e?t[o]=e:void 0===t[o]&&(n[0]&&!n[0].isEmpty&&"number"==typeof n[0].$.id?t[o]=Math.floor(Math.random()*(1e6-n.length))+n.length:t[o]=Math.random().toString(36).substring(7))),"physical"===d||"deferred"===d?void i():void(l.onRecordInserted&&l.onRecordInserted(o?t[o]:e,t,a,r))}}addSort(e,t){function a(e,a){const l=i.columns.find(t=>t.dataField===e);if(l){let i=Array.isArray(t)?t[a]:"string"==typeof t?t:"ascending";n.dataFields.push(e),n.dataTypes.push(r.dataFields.find(t=>t.name===e).dataType),i=-1===i.indexOf("desc")?"ascending":"descending",n.orderBy.push(i)}}const i=this,r=i.dataSource,l=JSON.stringify(i._appliedSorting);let n;if(0!==arguments.length&&r&&0!==r.length){if(i.closePanel(),1===arguments.length&&"object"==typeof e)n=e;else if(n={dataFields:[],dataTypes:[],orderBy:[]},Array.isArray(e))e.forEach(a);else if("string"==typeof e)a(e,0);else return;if(i.closePanel(),i._appliedSorting=n,l!==JSON.stringify(i._appliedSorting)){const e=i._appliedSorting.dataFields.length;if(r.sortBy(n.dataFields,n.dataTypes,n.orderBy),i._getVisibleRecords(),i._refreshCardContent(),i.$.fireEvent("sort"),0===e)return i.$.sortButton.firstElementChild.innerHTML=i.localize("sort"),void i.$.sortButton.classList.remove("sorted");i.$.sortButton.firstElementChild.innerHTML=1===e?i.localize("sortedByOne"):i.localize("sortedByMultiple",{n:e}),i.$.sortButton.classList.add("sorted")}}}beginEdit(e){const t=this;if(t.editable){const a=t._visibleSource.find(t=>t.$.id===e);if(a){const a=t.ensureVisible(e);"virtual"===t.scrolling?t._beginEditOnLoad=e:t._openEditDialog(a.dataId)}}}cancelEdit(){const e=this,t=e._editInfo;t&&t.window.opened&&t.window.close()}closePanel(){const e=this;e.$.headerDropDown.classList.add("smart-visibility-hidden"),e._closeSearchPanel()}endEdit(){const e=this,t=e._editInfo;t&&t.window.opened&&(t.ok=!0,t.window.close())}ensureVisible(e){var t=Math.floor;const a=this,i=a._visibleSource,r=i.find(t=>t.$.id===e);if(!r)return;const l=i.indexOf(r),n=a._cardsPerRow,d=a._cardHeight+a._gap,o=a.$.scrollViewer.$.verticalScrollBar,s=t(l/n),c=Math.max(0,s*n);let m,h,u=0;if(0<a._numberOfCollapsedRows){const e=t((i.length-1)/n)+1;for(let t=0;t<e;t++){const e=t;if(e===s)break;u+=a._collapsedRows[e]?d-a._cardContentHeight:d}}else u=t(c/n)*d;return(u=Math.min(u,o.max),Math.abs(o.value-u)<a.$.scrollViewer.$.scrollViewerContainer.offsetHeight/50)?(m=a._cards.filter(e=>e.dataId===l&&!e.classList.contains("smart-hidden")),h=m[m.length-1],h):(o.value=u,a._onVerticalChange({detail:{value:u}}),m=a._cards.filter(e=>e.dataId===l&&!e.classList.contains("smart-hidden")),h=m[m.length-1],h)}hideColumn(e){this._toggleColumn(e,!1)}openCustomizePanel(){const e=this,t=e.dataSource;if(!t||0===t.length)return;const a=e.$.customize,i=e.columns.map(t=>{const a=Object.assign({},t);return a.disableToggle=-1!==[e.coverField,e.titleField].indexOf(a.dataField),a}),r=[e.localize("noCoverField")].concat(e.columns.filter(e=>e.image));let l,n,d;if(e._editInfo&&e._editInfo.window.close(),e.$.headerDropDown.classList.add("customize-panel"),e.$.headerDropDown.classList.remove("filter-panel","sort-panel","search-panel"),a.classList.remove("smart-hidden"),e.$.filter.classList.add("smart-hidden"),e.$.sort.classList.add("smart-hidden"),e.$.search.classList.add("smart-hidden"),e._closeSearchPanel(),!e._customizePartCreated){const t=document.createDocumentFragment(),a=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div");l=document.createElement("smart-switch-button"),n=document.createElement("smart-input"),d=document.createElement("smart-column-panel"),s.innerHTML=e.localize("coverField"),l.setAttribute("crop",e.localize("crop")),l.setAttribute("fit",e.localize("fit")),l.inverted=!0,l.animation=e.animation,l.theme=e.theme,n.dataSource=r,n.dropDownButtonPosition="right",n.readonly=!0,n.animation=e.animation,n.theme=e.theme,d.animation=e.animation,d.dataSource=i,d.locale=e.locale,d.messages=e._innerElementMessages.columnPanel,d.theme=e.theme,o.appendChild(s),o.appendChild(l),a.classList.add("smart-card-view-customize-top"),a.appendChild(o),a.appendChild(n),t.appendChild(a),t.appendChild(d),e.$.customize.appendChild(t),e._customizePartCreated=!0}else l=a.getElementsByTagName("smart-switch-button")[0],n=a.getElementsByTagName("smart-input")[0],n.dataSource=r,delete n.$.input.dataValue,d=a.children[1],d.set("dataSource",i),d.propertyChangedHandler("dataSource",void 0,i);l.checked="fit"===e.coverMode,n.value=e.coverField?e.columns.find(t=>t.dataField===e.coverField).label:e.localize("noCoverField"),e._changedVisibility=new Map,e._openHeaderDropDown(e.$.customizeCardsButton)}openFilterPanel(){const e=this,t=e.dataSource;if(!t||0===t.length)return;const a=e.columns.map(e=>{const a=Object.assign({},e);return a.dataType=t.dataFields.find(e=>e.name===a.dataField).dataType,a});let i;e._editInfo&&e._editInfo.window.close(),e.$.headerDropDown.classList.add("filter-panel"),e.$.headerDropDown.classList.remove("customize-panel","sort-panel","search-panel"),e.$.filter.classList.remove("smart-hidden"),e.$.customize.classList.add("smart-hidden"),e.$.sort.classList.add("smart-hidden"),e.$.search.classList.add("smart-hidden"),e._closeSearchPanel(),e._filterPartCreated?(i=e.$.filter.firstElementChild,i.set("operator",e._appliedFiltering.operator),i.set("value",e._appliedFiltering.filters),i._applyValue()):(i=document.createElement("smart-multi-column-filter-panel"),i.animation=e.animation,i.dataSource=a,i.locale=e.locale,i.messages=e._innerElementMessages.multiColumnFilterPanel,i.operator=e._appliedFiltering.operator,i.theme=e.theme,i.value=e._appliedFiltering.filters,e.$.filter.appendChild(i),e._filterPartCreated=!0),e._openHeaderDropDown(e.$.filterButton)}openSortPanel(){const e=this,t=e.dataSource;if(!t||0===t.length)return;const a=e.columns.map(a=>{const i=Object.assign({},a),r=e._appliedSorting.dataFields.indexOf(i.dataField);return i.dataType=t.dataFields.find(e=>e.name===i.dataField).dataType,i.sortIndex=r,-1!==r&&(i.sortDirection=e._appliedSorting.orderBy[r]),i});let i;e._editInfo&&e._editInfo.window.close(),e.$.headerDropDown.classList.add("sort-panel"),e.$.headerDropDown.classList.remove("customize-panel","filter-panel","search-panel"),e.$.sort.classList.remove("smart-hidden"),e.$.customize.classList.add("smart-hidden"),e.$.filter.classList.add("smart-hidden"),e.$.search.classList.add("smart-hidden"),e._closeSearchPanel(),e._sortPartCreated?(i=e.$.sort.firstElementChild,i.set("dataSource",a),i.propertyChangedHandler("dataSource",void 0,a)):(i=document.createElement("smart-sort-panel"),i.animation=e.animation,i.dataSource=a,i.locale=e.locale,i.messages=e._innerElementMessages.sortPanel,i.theme=e.theme,e.$.sort.appendChild(i),e._sortPartCreated=!0),e._openHeaderDropDown(e.$.sortButton)}removeFilter(){this.addFilter([])}removeRecord(e){function t(){const t=a.dataSource,i=t.find(t=>t.$.id===e);if(i){const e=t.indexOf(i),r=a._visibleSource.indexOf(i);if(t.remove(e),t!==a._visibleSource){if(-1===r)return;a._visibleSource.splice(r,1)}a._closeSearchPanel(),a._fullRefresh()}}const a=this,i=a.scrolling;return"physical"===i||"deferred"===i?void t():void(a.onRecordRemoved&&a.onRecordRemoved(e,function(e){e&&t()}))}removeSort(){this.addSort({dataFields:[],dataTypes:[],orderBy:[]})}showColumn(e){this._toggleColumn(e,!0)}propertyChangedHandler(e,t,a){super.propertyChangedHandler(e,t,a);const i=this;switch(e){case"allowDrag":case"coverMode":case"onRecordInserted":case"onRecordRemoved":break;case"addNewButton":a&&0===i.dataSource.dataFields.length&&(i.addNewButton=!1);break;case"animation":case"theme":if(i._cards.forEach(t=>{const i=t.getElementsByTagName("smart-carousel");i&&(i[e]=a)}),i._editInfo)for(let t in i._editInfo.window[e]=a,i._editInfo.editors)i._editInfo.editors[t].element[e]=a;i._customizePartCreated&&(i.$.customize.firstElementChild.firstElementChild.children[1][e]=a,i.$.customize.firstElementChild.children[1][e]=a,i.$.customize.children[1][e]=a),i._filterPartCreated&&(i.$.filter.firstElementChild[e]=a),i._sortPartCreated&&(i.$.sort.firstElementChild[e]=a);break;case"disabled":i.closePanel(),i._editInfo&&(i._editInfo.window.disabled=a);break;case"cardHeight":i._updateCardHeight(a);break;case"cellOrientation":case"collapsible":if(!i.dataSource||0===i.dataSource.length)return;i._fullRefresh();break;case"columns":i._updateColumns();break;case"coverField":case"titleField":{if(null!==a){const r=i.columns.find(e=>e.dataField===a);if(!r||"coverField"===e&&!r.image)return void(i[e]=t)}if(i._createTemplate(),!i.dataSource||0===i.dataSource.length)return;i._fullRefresh();break}case"dataSource":i._close(),i._normalizeDataSource(),i._getVisibleRecords(),i._clearFilterAndSortUI(),i._normalizeColumns(),i._createTemplate(),i._fullRefresh(!1);break;case"editable":!a&&i._editInfo&&i._editInfo.window.close();break;case"headerPosition":i._handleHeaderPosition(),("none"===a||"none"===t)&&i.dataSource&&0<i.dataSource.length&&i._partialRefresh();break;case"locale":case"messages":if(i.closePanel(),i._localizeHeader(),i._getInnerElementMessages(),i._editInfo){const e=i._editInfo.window;e.$.buttonsContainer.firstElementChild.title=i.localize("previousRecord"),e.$.buttonsContainer.children[1].title=i.localize("nextRecord"),e.$.footer.firstElementChild.innerHTML=i.localize("ok"),e.$.footer.children[1].innerHTML=i.localize("cancel"),Array.from(e.getElementsByClassName("toggle-visibility")).forEach(e=>e.title=i.localize("toggleVisibility")),Array.from(e.querySelectorAll(".smart-card-view-editor.image")).forEach(e=>{Array.from(e.firstElementChild.children).forEach(e=>e.title=i.localize("removeImage")),e.children[1].innerHTML=i.localize("imageUrl"),e.children[2].children[1].title=i.localize("addImage")}),Array.from(e.getElementsByTagName("smart-date-time-picker")).forEach(e=>{e.messages=i._innerElementMessages.dateTimePicker,e.locale=i.locale})}if(i._customizePartCreated){const e=i.$.customize.getElementsByTagName("smart-switch-button")[0];i.$.customize.children[1].messages=i._innerElementMessages.columnPanel,i.$.customize.children[1].locale=i.locale,e.setAttribute("crop",i.localize("crop")),e.setAttribute("fit",i.localize("fit"))}i._filterPartCreated&&(i.$.filter.firstElementChild.messages=i._innerElementMessages.multiColumnFilterPanel,i.$.filter.firstElementChild.locale=i.locale),i._sortPartCreated&&(i.$.sort.firstElementChild.messages=i._innerElementMessages.sortPanel,i.$.sort.firstElementChild.locale=i.locale);break;case"scrolling":{const e=["virtual","infinite"];if(-1!==e.indexOf(a)||-1!==e.indexOf(t))return void(i.scrolling=t);i.$.scrollViewer.$.verticalScrollBar.mechanicalAction="deferred"===a?"switchWhenReleased":"switchWhileDragging";break}}}_updateColumns(){const e=this;e._normalizeColumns(),e._createTemplate(),e._fullRefresh()}_addNewButtonClickHandler(){this._openEditDialog()}_clickHandler(e){const t=this,a=t.isInShadowDOM||t.shadowRoot?e.composedPath()[0]:e.target;if(t.$.header.contains(a))return void t._headerClickHandler(e);const i=a.closest("smart-card");if(!(!i||a.classList.contains("smart-indicator")||t._dragDetails&&t._dragDetails.feedbackShown)){if(t._dragDetails&&(delete t._dragDetails,t.$.scrollViewer._scrollView.disableSwipeScroll=!1),!a.classList.contains("smart-arrow-up"))return void(t.editable&&!t._clickToDrag&&t._openEditDialog(i.dataId));const e=i.getElementsByClassName("smart-card-view-content")[0],r=t._visibleSource[i.dataId].$.id;e.removeEventListener("transitionend",t._transitionendHandlerExpand),e.removeEventListener("transitionend",t._transitionendHandlerCollapse),t._collapsed[r]?(delete t._collapsed[r],t._getNumberOfCollapsedRows(),t.hasAnimation?t._expandDataContainer(e):(i.classList.remove("collapsed"),a.classList.remove("collapsed"),e.classList.remove("smart-visibility-hidden"),t._partialRefresh()),window.getSelection().removeAllRanges()):(t._collapsed[r]=!0,t._getNumberOfCollapsedRows(),i.classList.add("collapsed"),a.classList.add("collapsed"),t.hasAnimation?t._collapseDataContainer(e):(e.classList.add("smart-visibility-hidden"),t._partialRefresh()))}}_windowClickHandler(e){const t=this,a=t.ownerElement,i=e.target.shadowRoot?e.composedPath()[0]:e.target;if(i.closest(".ok"))a._editInfo.ok=!0,t.close();else if(i.closest(".cancel"))t.close();else if(i.closest(".add")){const e=i.closest(".container"),t=e.firstElementChild;if(""!==t.value.trim()){const i=document.createElement("div");i.className="thumbnail",i.style.backgroundImage=`url("${t.value}")`,i.title=a.localize("removeImage"),e.parentElement.firstElementChild.appendChild(i),t.value=""}}else if(i.classList.contains("thumbnail"))i.parentElement.removeChild(i);else if(i.classList.contains("toggle-visibility")){const e=a.columns.find(e=>i.parentElement.getAttribute("data-field")===e.dataField);i.classList.toggle("hidden"),a._changedVisibility.set(e,!i.classList.contains("hidden"))}}_expandDataContainer(e){const t=this,a=e.style.height,i=t._cardContentHeight-t._verticalOffset+"px";return e.style.height=i,e.classList.remove("smart-visibility-hidden"),e.previousElementSibling.children[1].classList.remove("collapsed"),a!==i&&(parseFloat(a)||parseFloat(i))?void e.addEventListener("transitionend",t._transitionendHandlerExpand):void t._transitionendHandlerExpand(t,e)}_transitionendHandlerExpand(){let e,t;1===arguments.length?(t=this,e=e=t.closest("smart-card-view")||(t.getRootNode()&&t.getRootNode().host?t.getRootNode().host.closest("smart-card-view"):void 0)):(e=arguments[0],t=arguments[1]),t.removeEventListener("transitionend",e._transitionendHandlerExpand),t.style.height=null,t.parentElement.parentElement.parentElement.classList.remove("collapsed"),e._partialRefresh()}_collapseDataContainer(e){const t=this,a=t._cardContentHeight-t._verticalOffset+"px";e.style.transition="none",requestAnimationFrame(function(){e.style.height=a,e.style.transition=null,requestAnimationFrame(function(){e.style.height="0px",e.classList.add("smart-visibility-hidden"),"0px"==a&&t._transitionendHandlerCollapse(t,e)})}),e.addEventListener("transitionend",t._transitionendHandlerCollapse)}_transitionendHandlerCollapse(){let e,t;1===arguments.length?(t=this,e=t.closest("smart-card-view")||(t.getRootNode()&&t.getRootNode().host?t.getRootNode().host.closest("smart-card-view"):void 0)):(e=arguments[0],t=arguments[1]),t.removeEventListener("transitionend",e._transitionendHandlerCollapse),t.style.height=null,e._partialRefresh()}_getNumberOfCollapsedRows(){const e=this,t=e._visibleSource,a=e._cardsPerRow,i=[],r={};let l=0;for(let n in e._collapsed){const d=t.findIndex?t.findIndex(e=>e.$.id.toString()===n):t.boundSource.findIndex(e=>e.$.id.toString()===n),o=Math.floor(d/a);if(-1!==i.indexOf(o))continue;const s=Math.max(0,o*a);let c=!0;i.push(o);for(let r=0;r<a;r++){const a=t[r+s];if(!a)break;if(!e._collapsed[a.$.id]){c=!1;break}}c&&(r[o]=!0,l++)}e._collapsedRows=r,e._numberOfCollapsedRows=l}_openEditDialog(e){const t=this,a=t._visibleSource,i=a[e],r=t.$.fireEvent("opening",{record:i});if(r.defaultPrevented)return;if(t.setAttribute("modal",""),t.closePanel(),t._changedVisibility=new Map,t._editInfo&&!t._editInfo.updateWindowContent)return void t._updateEditedView(e);const l=document.createDocumentFragment(),n={};if(t.columns.forEach(function(e){const a=e.dataField,r=i?i[a]:"",d=document.createElement("div");let o;if(d.className=`smart-card-view-label${e.icon?" icon "+e.icon:""}`,d.setAttribute("data-field",a),d.innerHTML=`${e.label}<span class="toggle-visibility${!1===e.visible?" hidden":""}${a===t.coverField||a===t.titleField?" smart-hidden":""}" title="${t.localize("toggleVisibility")}"></span>`,l.appendChild(d),e.image)return o=document.createElement("div"),o.className="smart-card-view-editor image",o.innerHTML=`<div>${t._updateImgThumbNails(r)}</div>
<div class="label">${t.localize("imageUrl")}</div>
<div class="container">
    <smart-input></smart-input>
    <smart-button class="add" title=${t.localize("addImage")}>+</smart-button>
</div>`,l.appendChild(o),void(n[a]={element:o,type:"image"});const s=t.dataSource.dataFields.find(t=>t.name===e.dataField).dataType;"date"===s?(o=document.createElement("smart-date-time-picker"),o.calendarButton=!0,o.dropDownAppendTo="body",o.dropDownDisplayMode="auto",o.dropDownPosition="bottom",o.locale=t.locale,o.messages=t._innerElementMessages.dateTimePicker,o.nullable=!0,o.value=r||null,e.formatSettings&&e.formatSettings.formatString&&(o.formatString=e.formatSettings.formatString)):"number"===s?(o=document.createElement("smart-numeric-text-box"),o.inputFormat="floatingPoint",o.spinButtons=!0,o.nullable=!0,o.value=void 0!==r&&null!==r?r:null,e.formatSettings&&e.formatSettings.formatString&&(o.outputFormatString=e.formatSettings.formatString)):"boolean"===s?(o=document.createElement("smart-check-box"),o.checked=r||!1):(o="string"==typeof r&&50<r.length?document.createElement("textarea"):document.createElement("smart-input"),o.value=void 0!==r&&null!==r?r.toString():""),o.className="smart-card-view-editor",o.animation=t.animation,o.theme=t.theme,l.appendChild(o),n[a]={element:o,type:s}}),t._editInfo&&t._editInfo.updateWindowContent)return t._editInfo.window.clear(),t._editInfo.window.appendChild(l),t._openWindow(),t._editInfo.dataId=e,t._editInfo.editors=n,void delete t._editInfo.updateWindowContent;const d=document.createElement("smart-window"),o=document.createElement("template");o.innerHTML=`<smart-button class="ok primary">${t.localize("ok")}</smart-button><smart-button class="cancel">${t.localize("cancel")}</smart-button>`,d.classList.add("smart-card-view-window","smart-visibility-hidden"),d.footerTemplate=o,d.headerButtons=["close","next","prev"],d.label=i?i[t.titleField]:"",d.animation=t.animation,d.theme=t.theme,d.ownerElement=t,d.appendChild(l),document.body.appendChild(d),t._editInfo={dataId:e,editors:n,window:d},t._addWindowHandlers(),d.whenRendered(()=>{d.$.buttonsContainer.firstElementChild.title=t.localize("previousRecord"),d.$.buttonsContainer.children[1].title=t.localize("nextRecord"),t._openWindow()})}_openWindow(){const e=this._editInfo.window,t=document.documentElement.clientWidth,a=document.documentElement.clientHeight,i=window.pageXOffset,r=window.pageYOffset;e.style.top=(a-e.offsetHeight)/2+r+"px",e.style.left=(t-e.offsetWidth)/2+i+"px",e.open()}_addWindowHandlers(){const e=this,t=e._editInfo.window;t.addEventListener("open",e._windowEventHandler),t.addEventListener("closing",e._windowEventHandler),t.addEventListener("close",e._windowEventHandler),t.addEventListener("click",e._windowClickHandler),t.addEventListener("prev",e._prevNextHandler),t.addEventListener("next",e._prevNextHandler)}_windowEventHandler(e){const t=this.ownerElement,a=e.type,i=t.context;if(e.target===this){if(t.context=t,"open"===a)t.$.fireEvent("open");else if("closing"===a){const a=t.$.fireEvent("closing");a.defaultPrevented&&e.preventDefault()}else"close"===a&&(t.$.fireEvent("close"),t._windowCloseHandler(e));t.context=i}}_updateEditedView(e){const t=this,a=t._visibleSource[e];a&&a.isEmpty||(t._editInfo.dataId=e,t.columns.forEach(function(e){const i=e.dataField,r=a?a[i]:"",l=t._editInfo.editors[i];"image"===l.type?l.element.firstElementChild.innerHTML=t._updateImgThumbNails(r):"boolean"===l.type?l.element.checked=r||!1:"date"===l.type?l.element.value=r||null:"number"===l.type?l.element.value=r!==void 0&&null!==r?r:null:l.element.value=r!==void 0&&null!==r?r.toString():""}),t._editInfo.window.label=a?a[t.titleField]:"",t._openWindow())}_updateImgThumbNails(e){if(""===e.trim())return"";const t=e.split(",").map(e=>e.trim());let a="";return t.forEach(e=>a+=`<div class="thumbnail" style="background-image: url('${e}');" title="${this.localize("removeImage")}"></div>`),a}_moveHandler(e){"touchmove"===e.originalEvent.type&&e.originalEvent.preventDefault()}_prevNextHandler(e){const t=this.ownerElement,a=t.context,i=t._editInfo.dataId,r="prev"===e.type?i-1:i+1;t._visibleSource[r]&&!t._visibleSource[r].isEmpty&&(t.context=t,t._saveChanges(),t._updateEditedView(r),t.context=a)}_saveChanges(){const e=this,t=e._editInfo.dataId;let a,i;if(t!==void 0){const r=e._cards.filter(e=>e.dataId===t);a=e._visibleSource[t],i=r[r.length-1]}else a={};e.columns.forEach(function(t){const r=t.dataField,l=e._editInfo.editors[r],n=l.element;if("image"===l.type){const t=[];if(Array.from(l.element.getElementsByClassName("thumbnail")).forEach(e=>{t.push(e.style.backgroundImage.replace(/url\(["'](.+)["']\)/g,"$1"))}),a[r]=t.join(","),i&&r===e.coverField)return void(i.firstElementChild.firstElementChild.dataSource=t)}else a[r]="boolean"===l.type?n.checked:"date"===l.type?n.value?n.value.toDate():null:n.value;if(i)if(r===e.titleField)i.getElementsByClassName("smart-card-view-title")[0].firstElementChild.innerHTML=e._formatValue(a[r],a,t);else if(t.visible){const l=i.querySelector(`[data-field="${r}"] > .smart-card-view-value`);l&&(l.innerHTML=e._formatValue(a[r],a,t))}}),t===void 0&&e.addRecord(null,a)}_close(){const e=this;e.closePanel(),e._editInfo&&e._editInfo.window.close()}_resizeHandler(){const e=this;e._suppressResizeHandler||e.hasAttribute("empty")||e.hasAttribute("no-matches")||(clearTimeout(e._resizeTimeout),e.$.loadingIndicatorContainer.classList.remove("smart-hidden"),e._resizeTimeout=setTimeout(function(){if(e.$.loadingIndicatorContainer.classList.add("smart-hidden"),e._cards.length===e._visibleSource.length){if(e.offsetWidth!==e._cachedWidth){const t=e._cardsPerRow;e._getCardsPerRow(),t!==e._cardsPerRow&&e._getNumberOfCollapsedRows(),e._cachedWidth=e.offsetWidth}else e._cachedHeight=e.offsetHeight;return void(0<e._cards.length&&(e._autoCardHeight&&e._updateCardHeight(null),e.$.scrollViewer.refresh()))}if(e.offsetHeight!==e._cachedHeight&&(e._cachedHeight=e.offsetHeight,20<=Math.abs(e._refreshedAtDimensions.height-e._cachedHeight)?(e._dataSourceProcessed=!0,e._partialRefresh(),delete e._dataSourceProcessed):e.$.scrollViewer.$.verticalScrollBar.max=Math.max(0,e._scrollHeight-e.$.scrollViewer.$.scrollViewerContainer.offsetHeight-e._numberOfCollapsedRows*e._cardContentHeight)),e.offsetWidth!==e._cachedWidth){const t=e._cardsPerRow;e._cachedWidth=e.offsetWidth,e._getCardsPerRow(),t!==e._cardsPerRow&&(e._dataSourceProcessed=!0,e._partialRefresh(),delete e._dataSourceProcessed)}},75))}_windowCloseHandler(){const e=this;return e.removeAttribute("modal"),e._editInfo.ok?(e._updateColumnsVisibility(function(){e._saveChanges()}),void delete e._editInfo.ok):void e._changedVisibility.forEach(function(t,a){a.visible!==t&&e._editInfo.window.querySelector(`[data-field="${a.dataField}"]`).firstElementChild.classList.toggle("hidden")})}_updateColumnsVisibility(e,t){const a=this;let i=!1;a._changedVisibility.forEach(function(r,l){if(!0!==t&&l.visible===r)return;const n=l.dataField;l.visible=r,r?(a._cardContent=a._cardContent.replace(`class="smart-card-view-cell smart-hidden" data-field="${n}"`,`class="smart-card-view-cell" data-field="${n}"`),!e&&a._editInfo&&a._editInfo.window.querySelector(`[data-field="${n}"]`).firstElementChild.classList.remove("hidden")):(a._cardContent=a._cardContent.replace(`class="smart-card-view-cell" data-field="${n}"`,`class="smart-card-view-cell smart-hidden" data-field="${n}"`),!e&&a._editInfo&&a._editInfo.window.querySelector(`[data-field="${n}"]`).firstElementChild.classList.add("hidden")),a._cards.forEach(e=>{const t=e.querySelector(`[data-field="${n}"]`);if(t.classList.toggle("smart-hidden"),r){const i=a._visibleSource[e.dataId];t.children[1].innerHTML=a._formatValue(i[n],i,l)}}),i=!0}),e&&e(),a._autoCardHeight&&i&&a._updateCardHeight(null)}_applyHandler(e){const t=this,a=e.target,i=e.detail,r=t.$.customize,l=t.columns;if(r.contains(a)){const e=r.getElementsByTagName("smart-switch-button")[0],a=r.getElementsByTagName("smart-input")[0],n=e.checked?"fit":"crop";let d=l.find(e=>e.label===a.value)||null,o=!1;n!==t.coverMode&&(t.coverMode=n),d&&(d=d.dataField),d!==t.coverField&&(t.coverField=d,o=!0),o||i.positionChanged?(i.positionChanged&&(t.columns=i.value),t._createTemplate(),t._fullRefresh(),i.positionChanged&&t._editInfo&&(t._editInfo.updateWindowContent=!0)):(i.value.forEach(e=>{const a=l.find(t=>t.dataField===e.dataField);a.visible!==e.visible&&t._changedVisibility.set(a,e.visible)}),t._updateColumnsVisibility())}else t.$.filter.contains(a)?t.addFilter(i.filters,i.operator,i.value):t.$.sort.contains(a)&&t.addSort(i.sortByInfo);t.closePanel()}_fullRefresh(e=!0){const t=this,a=t.$.cardContainer;let i;for(e&&(i=t._getFractionOfMax()),t._suppressResizeHandler=!0;a.firstChild;)a.removeChild(a.firstChild);t._cards=[],t._createCards(),0===t._visibleSource.length&&t.$.scrollViewer.refresh(),t._setFractionOfMax(i)}_normalizeDataSource(){function e(){if(0===t.columns.length)return t.addNewButton=!1,[];const e=[];return t.columns.forEach(t=>{try{e.push({name:t.dataField||t.label||t,dataType:"string"})}catch(e){}}),e}const t=this;let a=t.dataSource;if(a instanceof Smart.DataAdapter)return void(0===a.dataFields.length&&(a.dataFields=e()));if(!a)a=[];else if(!Array.isArray(a))if("object"==typeof a&&0<Object.keys(a).length)a=[a];else return void t.error(t.localize("incorrectStructure"));let r=[];if(0===a.length)r=e();else{let t=0,i=a[t],l=Object.keys(i);for(;i&&0===l.length;)t++,i=a[t],l=Object.keys(i);0===l.length?r=e():l.forEach(e=>{const t=i[e];let a;a=t.constructor===Date?"date":"boolean"==typeof t?"boolean":isNaN(t)||null===t||""===t?"string":"number",r.push(`${e}: ${a}`)})}t.dataSource=new Smart.DataAdapter({dataSource:a,dataFields:r})}_normalizeColumns(){const e=this,t=e.columns,a=e.dataSource.dataFields,i=[];(Array.isArray(t)||t instanceof Smart.ObservableArray)&&(t.forEach(t=>{let r,l,n,d,o,s,c,m;"object"==typeof t?(r=t.dataField,l=t.formatFunction,n=t.formatSettings,d=t.icon,o=t.image||!1,s=t.label||r,c=t.template,m=r===e.titleField||r===e.coverField||!(t.visible!==void 0)||t.visible):"string"==typeof t&&(r=t,o=!1,s=r,m=!0),a.find(e=>e.name===r)&&i.push({dataField:r,formatFunction:l,formatSettings:n,icon:d,image:o,label:s,template:c,visible:m})}),0===i.length&&a.forEach(e=>{i.push({dataField:e.name,image:!1,label:e.name,visible:!0})}),!i.find(t=>t.dataField===e.titleField)&&(e.titleField=null),!i.find(t=>t.dataField===e.coverField&&t.image)&&(e.coverField=null),e.columns=new Smart.ObservableArray(i),e.columns.canNotify=!0,e.columns.notify(function(t){if(e.context!==e&&t.newValue!==t.oldValue){if(e._close(),"update"===t.action){const a=t.target;switch(t.propertyName){case"dataField":e._updateColumns();break;case"formatFunction":case"formatSettings":case"template":e._createTemplate(),e._fullRefresh();break;case"icon":case"label":a.dataField!==e.coverField&&a.dataField!==e.titleField&&(e._createTemplate(),e._fullRefresh());break;case"image":t.newValue||e.coverField!==a.dataField?(e._createTemplate(),e._fullRefresh()):(e.coverField=null,e.propertyChangedHandler("coverField",a.dataField,null));break;case"visible":{const i=a.dataField;if(!t.newValue&&(i===e.coverField||i===e.titleField))return void(a.visible=!0);e._toggleColumn(i,t.newValue,!0);break}}}else e._updateColumns();e._editInfo&&(e._editInfo.updateWindowContent=!0)}}),e._editInfo&&(e._editInfo.updateWindowContent=!0))}_handleHeaderPosition(){const e=this,t=e.headerPosition,a=e.$.header;return"none"===t?void e.$header.addClass("smart-hidden"):void(e.$header.removeClass("smart-hidden"),"top"===t&&a.nextElementSibling!==e.$.scrollViewer?e.$.container.insertBefore(a,e.$.scrollViewer):"bottom"===t&&a.previousElementSibling!==e.$.scrollViewer&&e.$.container.insertBefore(a,e.$.loadingIndicatorContainer))}_localizeHeader(){const e=this;e.$.customizeCardsButton.firstElementChild.innerHTML=e.localize("customizeCards"),e.$.filterButton.firstElementChild.innerHTML=0===e._appliedFiltering.filters.length?e.localize("filter"):1===e._appliedFiltering.filters.length?e.localize("filteredByOne"):e.localize("filteredByMultiple",{n:e._appliedFiltering.filters.length}),e.$.sortButton.firstElementChild.innerHTML=0===e._appliedSorting.dataFields.length?e.localize("sort"):1===e._appliedSorting.dataFields.length?e.localize("sortedByOne"):e.localize("sortedByMultiple",{n:e._appliedSorting.dataFields.length}),e.$.searchInput.placeholder=e.localize("findInView"),e.$.cardContainer.setAttribute("no-data",e.localize("noData")),e.$.cardContainer.setAttribute("no-matches",e.localize("noMatches"))}_getInnerElementMessages(){const e=this,t=e.locale,a={};a.columnPanel={},a.multiColumnFilterPanel={},a.sortPanel={},a.dateTimePicker={},a.columnPanel[t]={apply:e.localize("apply"),cancel:e.localize("cancel"),find:e.localize("find"),noResults:e.localize("noResults")},a.multiColumnFilterPanel[t]={addFilter:e.localize("addFilter"),and:e.localize("and"),apply:e.localize("apply"),cancel:e.localize("cancel"),CONTAINS:e.localize("CONTAINS"),CONTAINS_CASE_SENSITIVE:e.localize("CONTAINS_CASE_SENSITIVE"),DOES_NOT_CONTAIN:e.localize("DOES_NOT_CONTAIN"),DOES_NOT_CONTAIN_CASE_SENSITIVE:e.localize("DOES_NOT_CONTAIN_CASE_SENSITIVE"),EMPTY:e.localize("EMPTY"),ENDS_WITH:e.localize("ENDS_WITH"),ENDS_WITH_CASE_SENSITIVE:e.localize("ENDS_WITH_CASE_SENSITIVE"),EQUAL:e.localize("EQUAL"),EQUAL_CASE_SENSITIVE:e.localize("EQUAL_CASE_SENSITIVE"),GREATER_THAN:e.localize("GREATER_THAN"),GREATER_THAN_OR_EQUAL:e.localize("GREATER_THAN_OR_EQUAL"),LESS_THAN:e.localize("LESS_THAN"),LESS_THAN_OR_EQUAL:e.localize("LESS_THAN_OR_EQUAL"),noFilters:e.localize("noFilters"),NOT_EMPTY:e.localize("NOT_EMPTY"),NOT_EQUAL:e.localize("NOT_EQUAL"),NOT_NULL:e.localize("NOT_NULL"),NULL:e.localize("NULL"),or:e.localize("or"),STARTS_WITH:e.localize("STARTS_WITH"),STARTS_WITH_CASE_SENSITIVE:e.localize("STARTS_WITH_CASE_SENSITIVE"),where:e.localize("where")},a.sortPanel[t]={apply:e.localize("apply"),booleanFirst:e.localize("booleanFirst"),booleanLast:e.localize("booleanLast"),cancel:e.localize("cancel"),dateFirst:e.localize("dateFirst"),dateLast:e.localize("dateLast"),firstBy:e.localize("firstBy"),from:e.localize("from"),numberFirst:e.localize("numberFirst"),numberLast:e.localize("numberLast"),noSorting:e.localize("noSorting"),pickAnother:e.localize("pickAnother"),stringFirst:e.localize("stringFirst"),stringLast:e.localize("stringLast"),thenBy:e.localize("thenBy")},a.dateTimePicker[t]={now:e.localize("now"),dateTabLabel:e.localize("dateTabLabel"),timeTabLabel:e.localize("timeTabLabel")},e._innerElementMessages=a}_headerClickHandler(e){function t(e,t){a.$.headerDropDown.classList.contains("smart-visibility-hidden")||e.classList.contains("smart-hidden")?a[t]():a.closePanel()}const a=this,i=a.isInShadowDOM||a.shadowRoot?e.composedPath()[0]:e.target;if(a.$.customizeCardsButton.contains(i))t(a.$.customize,"openCustomizePanel");else if(a.$.filterButton.contains(i))t(a.$.filter,"openFilterPanel");else if(a.$.sortButton.contains(i))t(a.$.sort,"openSortPanel");else if(i===a.$.searchButton)t(a.$.search,"_openSearchPanel");else if(i===a.$.searchClose)a.closePanel();else if(i===a.$.searchPrev||i===a.$.searchNext){const e=a._searchInfo,t=e.foundIdsArray,r=i===a.$.searchNext,l=t.length;let n;if(e.highlighted===void 0)n=r?0:l-1;else if(1===t.length)return;else{const i=t.indexOf(e.highlighted),d=Array.from(a.$.cardContainer.getElementsByClassName("highlighted"));d.forEach(e=>e.classList.remove("highlighted")),n=r?(i+1)%l:0<=i-1?i-1:l-1}e.highlighted=t[n];const d=a.ensureVisible(e.highlighted);d.classList.add("highlighted"),a.$.searchLabel.innerHTML=a.localize("found",{nth:n+1,n:t.length})}}_openSearchPanel(){const e=this;let t;if(e.$.headerDropDown.classList.add("search-panel"),e.$.headerDropDown.classList.remove("customize-panel","filter-panel","sort-panel"),e.$.search.classList.remove("smart-hidden"),e.$.customize.classList.add("smart-hidden"),e.$.filter.classList.add("smart-hidden"),e.$.sort.classList.add("smart-hidden"),e._openHeaderDropDown(e.$.searchButton),Array.isArray(e._visibleSource))t=new Smart.DataAdapter({dataSource:e._visibleSource,dataFields:e.dataSource.dataFields,id:"_id"});else{const a=e._appliedSorting;t=new Smart.DataAdapter({dataSource:e._visibleSource._dataSource,dataFields:e.dataSource.dataFields,id:e._visibleSource.id||void 0}),0<a.dataFields.length&&t.sortBy(a.dataFields,a.dataTypes,a.orderBy)}e._searchInfo={source:t,stringDataFields:e.dataSource.dataFields.filter(t=>"string"===t.dataType&&e.columns.find(e=>e.dataField===t.name&&!e.image)).map(e=>e.name)},""!==e.$.searchInput.value&&e._search(e.$.searchInput.value,!1)}_openHeaderDropDown(e){const t=this,a=t.$.headerDropDown;"top"===t.headerPosition?(a.style.bottom=null,a.style.top="100%"):(a.style.top=null,a.style.bottom="100%"),a.style.left=e===t.$.searchButton?e.offsetLeft+e.offsetWidth-a.offsetWidth+"px":e.offsetLeft+"px",a.classList.remove("smart-visibility-hidden")}_createTemplate(){const e=this,t=e.titleField;let a="";a+=t?`<div class="smart-card-view-title" data-field="${t}"><div>{{${t}}}</div><div class="smart-arrow-up"></div></div>`:"<div class=\"smart-card-view-title empty\"><div>&nbsp;</div><div class=\"smart-arrow-up\"></div></div>",a+="<div class=\"smart-card-view-content\">",e.columns.forEach(i=>{const r=i.dataField;!1!==i.visible&&(i.visible=!0);r===t||r===e.coverField||(a+=`<div class="smart-card-view-cell${i.visible?"":" smart-hidden"}" data-field="${r}"><div class="smart-card-view-label${i.icon?" icon "+i.icon:""}">${i.label}</div>
<div class="smart-card-view-value">{{${r}}}</div></div>`)}),a+="</div>",e._cardContent=a}_requestInitialCards(){const e=this;e.setAttribute("loading",""),e.$.loadingIndicatorContainer.classList.remove("smart-hidden"),e.dataSource.onVirtualDataSourceRequested(function(){e._createCards(),e.removeAttribute("loading"),e.$.loadingIndicatorContainer.classList.add("smart-hidden")},{first:1/0,last:1/0,sorting:[],filtering:[],grouping:[],action:""})}_createCards(){var e=Math.max;const t=this,a=t._visibleSource;if(!a||0===a.length)return;const i=t.scrolling,r="virtual"===i,l=t.$.scrollViewer.$.scrollViewerContainer.offsetHeight;let n,d=a.length,o=1,s=0,c=0;t._ignoreVerticalChange=!0,t.removeAttribute("empty"),r&&t.setAttribute("loading","");for(let r=0;r<d;r++){const i=t._createCard(a[r],r);if(t._cards.push(i),t.$.cardContainer.appendChild(i),t.$.scrollViewer.refresh(),t._autoCardHeight&&(c=e(i.offsetHeight,c)),i.offsetTop>s&&(o++,s=i.offsetTop,!n&&(t._getCardsPerRow(),n=t._cardsPerRow)),3<=o&&0==t._cards.length%n&&t.$.cardContainer.offsetHeight>l+2*(t.cardHeight||c)&&t._cards.length+5<d)break}if(n=n||t._cards.length,"infinite"===i)for(;0!=t._cards.length%n;)t._createEmptyCard();t._autoCardHeight&&(t._cardHeight=c,t._cards.forEach(e=>e.style.height=c+"px")),t._cardContentHeight=t._cards[0].getElementsByClassName("smart-card-view-content")[0].offsetHeight+t._verticalOffset,t._cards.forEach(e=>t._toggleCard(e,e.firstElementChild.lastElementChild,t._visibleSource[e.dataId].$.id));const m=Math.ceil(d/n),h=(t._cardHeight+t._gap)*m-t._gap;t.$.scrollViewer.$.scrollViewerContentContainer.style.top=0,t.$.scrollViewer.$.verticalScrollBar.max=e(0,h-l-t._numberOfCollapsedRows*t._cardContentHeight),t._cardsPerRow=n,t._scrollHeight=h,t._refreshedAtDimensions={width:t._cachedWidth,height:t._cachedHeight},t._getNumberOfCollapsedRows(),delete t._ignoreVerticalChange,delete t._suppressResizeHandler,r&&(t.$.loadingIndicatorContainer.classList.remove("smart-hidden"),t.dataSource.onVirtualDataSourceRequested(t._virtualDataSourceRequestedCallback.bind(t,0,0,!0),{first:0,last:t._cards.length,sorting:[],filtering:[],grouping:[],action:""}))}_virtualDataSourceRequestedCallback(e,t,a){const i=this;if(i._ignoreVerticalChange=!0,i.$.loadingIndicatorContainer.classList.add("smart-hidden"),i._updateVisibleCards(e,t,a),i.removeAttribute("loading"),delete i._ignoreVerticalChange,i._beginEditOnLoad){const e=i._cards.filter(e=>e.dataId===i._beginEditOnLoad),t=e[e.length-1];t&&i._openEditDialog(t.dataId),delete i._beginEditOnLoad}}_createCard(e={},t){const a=this,i=a.coverField,r=document.createElement("smart-card"),l=document.createElement("div");if(requestAnimationFrame(()=>r.hasStyleObserver=!1),r.dataId=t,r.whenReady(function(){r.firstElementChild.onscroll=function(){const e=a._visibleSource[this.parentElement.dataId].$.id;a._cardScrolling[e]=this.scrollTop}}),a._autoCardHeight||(r.style.height=a._cardHeight+"px"),l.className="smart-card-data-container",a._applyTemplate(e,l,!0),i){const t=document.createElement("smart-carousel");let l=e[i];a.shadowRoot&&(t._isInShadowDOM=!0),l="string"==typeof l?l.split(",").map(e=>e.trim()):[],t.dataSource=l,t.hideArrows=!0,t.unfocusable=!0,t.animation=a.animation,t.theme=a.theme,t.onIndexChange=function(e){a._cardSelectedCover[a._visibleSource[r.dataId].$.id]=e},t.whenReady(function(){t.hasStyleObserver=!1,t.$.arrowLeft.hasStyleObserver=!1,t.$.arrowRight.hasStyleObserver=!1}),r.appendChild(t)}return r.appendChild(l),r}_toggleCard(e,t,a){const i=this;e.setAttribute("updating",""),i._collapsed[a]?(e.classList.add("collapsed"),t.firstElementChild.children[1].classList.add("collapsed"),t.children[1].classList.add("smart-visibility-hidden")):(e.classList.remove("collapsed"),t.firstElementChild.children[1].classList.remove("collapsed"),t.children[1].classList.remove("smart-visibility-hidden")),setTimeout(function(){e.removeAttribute("updating")},100)}_createEmptyCard(e=!0){const t=this,a=t._createCard({});e&&a.classList.add("smart-hidden"),a.style.height=t._cardHeight+"px",t._cards.push(a),t.$.cardContainer.appendChild(a)}_applyTemplate(e,t,a){const r=this,l=r.columns;if(a){let a=r._cardContent;for(let t=0;t<l.length;t++){const i=l[t];if(!i.visible)continue;const n=i.dataField,d=new RegExp(`{{${n}}}`,"g"),o=r._formatValue(e[n],e,i);a=a.replace(d,o)}return void(t.innerHTML=a.replace(/{{\w+}}/g,""))}const i=r.titleField;for(let n=0;n<l.length;n++){const a=l[n];if(!a.visible)continue;const d=a.dataField,o=t.querySelector(`[data-field="${d}"]`);if(o){const t=r._formatValue(e[d],e,a);d===i?o.firstElementChild.innerHTML=t:o.children[1].innerHTML=t}}}_formatValue(e,t,a){const i=this;if(0===Object.keys(t).length)return"";const r={column:a,record:t,template:a.template,value:e};if(a.formatFunction&&a.formatFunction(r),e=r.value,r.template)return i._applyCellTemplate(r.template,e,t,a);if(a.formatSettings){let t="";return a.formatSettings.prefix&&(t+=a.formatSettings.prefix),a.formatSettings.formatString&&void 0!==e&&null!==e&&(e.constructor===Date?e=new Smart.Utilities.DateTime(e).toString(a.formatSettings.formatString):e instanceof Smart.Utilities.DateTime?e=e.toString(a.formatSettings.formatString):!isNaN(e)&&i._numericFormatter&&(e=i._numericFormatter.formatNumber(e,a.formatSettings.formatString))),t+=e,a.formatSettings.sufix&&(t+=a.formatSettings.sufix),t}return e}_applyCellTemplate(e,t="",a,i){let r="";if("function"==typeof e){const r={column:i,record:a,template:null,value:t};if(e(r),t=r.value,null===r.template)return t;e=r.template}if(e.startsWith("#")){const i=document.querySelector(e);if(i&&i instanceof HTMLTemplateElement){const e=i.content.cloneNode(!0),l=document.createElement("div");return l.appendChild(e),t=t.toString(),t=t.replace(/'/ig,"\\'"),t=t.replace(/"/ig,"\\\""),r=l.innerHTML.replace(/{{value}}/ig,t).replace(/{{id}}/ig,a.$.id),0<=r.indexOf("{{value=")&&(t?(r=r.substring(0,r.indexOf("{{value="))+t+r.substring(r.indexOf("}")),r=r.replace(/}/ig,""),r=r.replace(/{/ig,"")):(r=r.replace(/{{value=/ig,""),r=r.replace(/}}/ig,""))),r}}return r=e.replace(/{{value}}/ig,t).replace(/{{id}}/ig,a.$.id),r}_getCardsPerRow(){const e=this,t=e._cards;if(0===t.length)return void(e._cardsPerRow=0);let a=t[0].offsetTop,r=1;for(let e=1;e<t.length&&!(t[e].offsetTop>a);e++)r++;e._cardsPerRow=r}_onVerticalChange(e){var t=Math.floor;const a=this;if(a._ignoreVerticalChange)return;const r=a._visibleSource,i=a.scrolling,l=a._cardHeight+a._gap,n=a._cardsPerRow;let d=e.detail.value;if(a._cards.length===r.length){const e=t(d/l)*n;return a._start={view:e,data:e},a._dataSourceProcessed&&a._refreshCardContent(),a.$.scrollViewer.$.scrollViewerContentContainer.style.top=-d+"px",void("infinite"===i&&a.$.scrollViewer.$.verticalScrollBar.value===a.$.scrollViewer.$.verticalScrollBar.max&&a._onScrollBottomReached(e,e))}let o,s;if(clearTimeout(a._scrollingTimeout),0<a._numberOfCollapsedRows){const e=t((r.length-1)/n)+1;let i,c=0;o=n;for(let t=0;t<e;t++){const e=t,r=c;if(c+=a._collapsedRows[e]?l-a._cardContentHeight:l,null==s&&d<=c){s=e*n,i=d-r;break}}d=i+l}else{for(d=d%(2*l)+l,d<l&&(d+=l);d+a.$.scrollViewer.$.scrollViewerContainer.offsetHeight>a.$.cardContainer.offsetHeight;)d-=l;o=t(d/l)*n,s=t(e.detail.value/l)*n,0>o&&(s-=o,o=0)}const c=Math.min(s+a._cards.length-o-1,r.length-1);if("virtual"===i&&(r[s].isEmpty||r[c].isEmpty)){const e=c-s;let t,l;for(let e=s;e<=c;e++)if(r[e].isEmpty){t=e,l=t;break}for(;r[l+1]&&r[l+1].isEmpty&&l-t<e;)l++;return a.setAttribute("loading",""),a.$.loadingIndicatorContainer.classList.remove("smart-hidden"),a.$.scrollViewer.$.scrollViewerContentContainer.style.top=-d+"px",void(a._scrollingTimeout=setTimeout(function(){a.dataSource.onVirtualDataSourceRequested(a._virtualDataSourceRequestedCallback.bind(a,o,s),{first:t,last:l,sorting:[],filtering:[],grouping:[],action:""})},300))}a.$.scrollViewer.$.scrollViewerContentContainer.style.top=-d+"px",a._updateVisibleCards(o,s),"virtual"===i?(a.removeAttribute("loading"),a.$.loadingIndicatorContainer.classList.add("smart-hidden")):"infinite"===i&&a.$.scrollViewer.$.verticalScrollBar.value===a.$.scrollViewer.$.verticalScrollBar.max&&a._onScrollBottomReached(o,s)}_onScrollBottomReached(e,t){const a=this;a.$.loadingIndicatorContainer.classList.remove("smart-hidden"),a.dataSource.onVirtualDataSourceRequested(function(){a._updateVisibleCards(e,t);const i=Math.ceil(a._visibleSource.length/a._cardsPerRow),r=(a._cardHeight+a._gap)*i-a._gap,l=a.$.scrollViewer.$.scrollViewerContainer.offsetHeight;a.$.scrollViewer.$.verticalScrollBar.max=Math.max(0,r-l-a._numberOfCollapsedRows*a._cardContentHeight),a._scrollHeight=r,a.$.loadingIndicatorContainer.classList.add("smart-hidden")},{first:1/0,last:1/0,sorting:[],filtering:[],grouping:[],action:""})}_updateVisibleCards(e,t,a){const r=this;for(let l=e;l<r._cards.length;l++){const i=r._cards[l],n=t-e+l;n<r._visibleSource.length?(i.classList.remove("smart-hidden"),(i.dataId!==n||a||r._dataSourceProcessed)&&r._updateVirtualCard(i,n)):i.classList.add("smart-hidden")}r._start={view:e,data:t}}_toggleColumn(e,t,a){const i=this,r=i._visibleSource;if(e&&"string"==typeof e&&e!==i.coverField&&e!==i.titleField&&r&&0!==r.length){const r=i.columns.find(t=>t.dataField===e);r&&(i._close(),i._changedVisibility=new Map,i._changedVisibility.set(r,t),i._updateColumnsVisibility(void 0,a))}}_updateVirtualCard(e,t){const a=this,i=a._visibleSource[t],r=i.$.id,l=e.firstElementChild.lastElementChild,n=a.coverField;if(e.dataId=t,a._applyTemplate(i,l),e.firstElementChild.scrollTop=a._cardScrolling[r]||0,a._dragDetails&&(e.dataId===a._dragDetails.index?e.classList.add("dragged"):e.classList.remove("dragged")),a._searchInfo&&(a._searchInfo.foundIdsObject[r]?(e.classList.add("found"),a._searchInfo.highlighted===r?e.classList.add("highlighted"):e.classList.remove("highlighted")):e.classList.remove("found","highlighted")),a._toggleCard(e,l,r),n){const t=e.firstElementChild.firstElementChild;let l=i[n];if(l="string"==typeof l?l.split(",").map(e=>e.trim()):[],t.set("dataSource",l),0<l.length){const e=a._cardSelectedCover[r]||0;t._generateIndicators(),t._indicators[e].classList.add("smart-active"),t._generateItems(),t._items[e].classList.add("smart-active"),t._currentIndex=e}}}_updateCardHeight(e){const t=this,a=t._cards;if(null===e){let e=0,i=[];if(t._autoCardHeight=!0,0===t._cards.length)return;if(a.forEach(e=>{e.style.height=null,e.classList.contains("collapsed")&&(e.setAttribute("updating",""),e.classList.remove("collapsed"),e.getElementsByClassName("smart-card-view-content")[0].classList.remove("smart-visibility-hidden"),i.push(e))}),a.forEach(t=>e=Math.max(t.offsetHeight,e)),a.forEach(t=>t.style.height=e+"px"),t._cardContentHeight=t._cards[0].getElementsByClassName("smart-card-view-content")[0].offsetHeight+t._verticalOffset,0<i.length&&(i.forEach(e=>{e.classList.add("collapsed"),e.getElementsByClassName("smart-card-view-content")[0].classList.add("smart-visibility-hidden")}),setTimeout(function(){i.forEach(e=>e.removeAttribute("updating"))},100)),t._cardHeight===e)return;t._cardHeight=e}else{const i=t._cards[0];let r;if(t._autoCardHeight=!1,t._cardHeight===e)return;if(t._cardHeight=e,!i)return;a.forEach(t=>t.style.height=e+"px"),i.classList.contains("collapsed")&&(i.setAttribute("updating",""),i.classList.remove("collapsed"),i.getElementsByClassName("smart-card-view-content")[0].classList.remove("smart-visibility-hidden"),r=!0),t._cardContentHeight=t._cards[0].getElementsByClassName("smart-card-view-content")[0].offsetHeight+t._verticalOffset,r&&(i.classList.add("collapsed"),i.getElementsByClassName("smart-card-view-content")[0].classList.add("smart-visibility-hidden"),setTimeout(function(){i.removeAttribute("updating")},100))}t._partialRefresh()}_partialRefresh(){function e(){let e=(a+2*i)/i*l;for(e=e-e%l+l;0<r&&e*(i-t._cardContentHeight)<a+2*i;)e++;for(e=Math.min(e,t._visibleSource.length);t._cards.length<e;)t._createEmptyCard(!1);for(;t._cards.length>e;)t._cards[t._cards.length-1].remove(),t._cards.pop();for(;"infinite"===t.scrolling&&0!=t._cards.length%l;)t._createEmptyCard()}const t=this;if(t._refreshedAtDimensions={width:t._cachedWidth,height:t._cachedHeight},t._cards.length===t._visibleSource.length)return t._dataSourceProcessed&&t._refreshCardContent(),void t.$.scrollViewer.refresh();t._getCardsPerRow();const a=t.$.scrollViewer.$.scrollViewerContainer.offsetHeight,i=t._cardHeight+t._gap,r=Object.keys(t._collapsed).length;let l=t._cardsPerRow;e(),t._getCardsPerRow(),l!==t._cardsPerRow&&(l=t._cardsPerRow,e()),t._getNumberOfCollapsedRows();const n=t._getFractionOfMax(),d=Math.ceil(t._visibleSource.length/t._cardsPerRow),o=i*d-t._gap,s=Math.max(0,o-a-t._numberOfCollapsedRows*t._cardContentHeight);t.$.scrollViewer.$.verticalScrollBar.max=s,t._scrollHeight=o,0===s&&t.$.scrollViewer.refresh(),t._setFractionOfMax(n)}_getFractionOfMax(){const e=this.$.scrollViewer.$.verticalScrollBar,t=e.max;return 0===t?0:e.value/e.max}_setFractionOfMax(e){const t=this,a=this.$.scrollViewer.$.verticalScrollBar,i=a.max*e;a.value=i,t._onVerticalChange({detail:{value:i}})}_refreshCardContent(){const e=this;e._updateVisibleCards(e._start.view,e._start.data,!0)}_getVisibleRecords(){const e=this,t=e.dataSource;if(0===e._appliedFiltering.filters.length)e._visibleSource=t;else{e._visibleSource=[];for(let a=0;a<t.length;a++){const t=e.dataSource[a];!1!==t.$.filtered&&(e._visibleSource.push(t),e._visibleSource[e._visibleSource.length-1]._id=t.$.id)}}t&&0!==t.length?(e.removeAttribute("empty"),0===e._visibleSource.length?e.setAttribute("no-matches",""):e.removeAttribute("no-matches")):(e.setAttribute("empty",""),e.removeAttribute("no-matches"))}_clearFilterAndSortUI(){const e=this;e._appliedFiltering={filters:[],operator:"and"},e._appliedSorting={dataFields:[],dataTypes:[],orderBy:[]},e.$.filterButton.classList.remove("filtered"),e.$.sortButton.classList.remove("sorted"),e.$.filterButton.firstElementChild.innerHTML=e.localize("filter"),e.$.sortButton.firstElementChild.innerHTML=e.localize("sort")}_search(e,t=!0){const a=this;if(a._searchInfo.query=e,a._cards.forEach(e=>e.classList.remove("found","highlighted")),""===e)return a.$.search.classList.remove("matches","no-matches"),delete a._searchInfo.foundIdsArray,delete a._searchInfo.foundIdsObject,void delete a._searchInfo.highlighted;const r=a._searchInfo.source,i=[],l=[],n={};a._searchInfo.stringDataFields.forEach(t=>{const a=new Smart.Utilities.FilterGroup,r=a.createFilter("string",e,"CONTAINS");a.addFilter("or",r),i.push([t,a])}),r._filter(i,"or");for(let a=0;a<r.length;a++){const e=r[a];!1!==e.$.filtered&&(l.push(e.$.id),n[e.$.id]=!0)}let d=l[0];return a._searchInfo.foundIdsArray=l,a._searchInfo.foundIdsObject=n,0<l.length?(t&&(a._searchInfo.highlighted=d,a.ensureVisible(d)),a._cards.forEach(e=>{const i=a._visibleSource[e.dataId].$.id;n[i]&&(t&&d===i&&e.classList.add("highlighted"),e.classList.add("found"))}),a.$.search.classList.remove("no-matches"),a.$.search.classList.add("matches"),void(a.$.searchLabel.innerHTML=a.localize("found",{nth:t?1:0,n:l.length}))):void(a.$.search.classList.remove("matches"),a.$.search.classList.add("no-matches"),a.$.searchLabel.innerHTML=a.localize("found",{nth:0,n:0}))}_closeSearchPanel(){const e=this;e._searchInfo&&(e._cards.forEach(e=>e.classList.remove("found","highlighted")),delete e._searchInfo)}_searchInputKeyupHandler(){const e=this;clearTimeout(e._searchInputTimeout),e._searchInputTimeout=setTimeout(function(){e.$.searchInput.value!==e._searchInfo.query&&e._search(e.$.searchInput.value)},500)}_headerDropDownTransitionendHandler(e){const t=this;"visibility"===e.propertyName&&t.$.headerDropDown.classList.contains("search-panel")&&!t.$.headerDropDown.classList.contains("smart-visibility-hidden")&&t.$.searchInput.focus()}_cardContainerDownHandler(e){const t=this;if(delete t._clickToDrag,t.allowDrag&&(t._isMobile||0===e.button)){const a=e.originalEvent.target;if(a.closest(".smart-indicator")||a.closest(".smart-arrow-up"))return void(t._isMobile&&(t.$.scrollViewer._scrollView.disableSwipeScroll=!0));const i=e.originalEvent.target.closest("smart-card");i&&(t._dragDetails={card:i,coords:{x:e.pageX,y:e.pageY},index:i.dataId,originalEvent:e,record:t._visibleSource[i.dataId],startTime:new Date},t.$.scrollViewer._scrollView.disableSwipeScroll=!0,window.getSelection().removeAllRanges())}}_documentMoveHandler(e){var t=Math.abs,a=Math.min;const i=this,r=i._dragDetails;if(!r)return;if(!r.feedbackShown){const a=new Date,l=500<a.getTime()-r.startTime.getTime(),n=5<t(r.coords.x-e.pageX)||5<t(r.coords.y-e.pageY);if(n&&(!i._isMobile||i._isMobile&&l)){const t=i._startDragging(e);if(!t)return}else return void(i._isMobile&&n&&!l&&(delete i._dragDetails,i.$.scrollViewer._scrollView.disableSwipeScroll=!1))}const l=r.card,n=r.record,d=e.clientY,o=e.clientX;let s=e.originalEvent.target;if(i.$.fireEvent("dragging",{card:l,originalEvent:e,record:n}),r.feedback.style.left=e.pageX+10+"px",r.feedback.style.top=e.pageY+10+"px",i._isMobile){const e=document.elementFromPoint(o,d);e&&(s=e)}clearInterval(i._dragInterval),i._dragInterval=setInterval(function(){const e=i.$.scrollViewer.getBoundingClientRect();0<i.$.scrollViewer.scrollHeight&&e.left<=o&&e.left+e.width>=o?d>=e.top&&d<=e.top+36?i.$.scrollViewer.scrollTop-=i._autoScrollCoefficient:d>=e.top+e.height-36&&d<=e.top+e.height?i.$.scrollViewer.scrollTop+=i._autoScrollCoefficient:clearInterval(i._dragInterval):clearInterval(i._dragInterval)},2);let c,m=s.closest("smart-card");if(r.hoveredCard&&(r.hoveredCard.classList.remove("drop-target","left","right"),delete r.hoveredCard),!(m&&m.dataId===r.index)){if(m){const e=m.getBoundingClientRect(),a=t(o-e.left),i=t(o-e.right);c=a<i?"left":"right"}else if(s===i.$.addNewButton)return;else{let e,l;if(i._cards.forEach(i=>{var r=Math.pow;const n=i.getBoundingClientRect(),s=t(d-n.top),m=t(d-n.bottom),h=a(s,m),u=t(o-n.left),g=t(o-n.right),_=a(u,g),f=Math.sqrt(r(_,2)+r(h,2));(void 0===l||f<l)&&(e=i,l=f,c=u<g?"left":"right")}),m=e,m.dataId===r.index)return}m&&(m.classList.add(c,"drop-target"),r.hoveredCard=m,r.side=c)}}_startDragging(e){const t=this,a=t._dragDetails,i=a.card,r=a.record,l=t.$.fireEvent("dragStart",{card:i,originalEvent:e,record:r});return l.defaultPrevented?(delete t._dragDetails,t.$.scrollViewer._scrollView.disableSwipeScroll=!1,!1):(a.feedback=t._addDragFeedback(r),a.feedbackShown=!0,t.setAttribute("dragging",""),i.classList.add("dragged"),t.closePanel(),t._clickToDrag=!0,!0)}_addDragFeedback(e){const t=this,a=document.createElement("div");let i="";return a.className="smart-card-view-drag-feedback",t.coverField&&(i+=`<div class="drag-feedback-thumbnail" style="background-image: url('${e[t.coverField].split(",")[0].trim()}');"></div>`),t.titleField?i+=`<div class="drag-feedback-label">${e[t.titleField]}</div>`:!t.coverField&&(i+=`<div class="drag-feedback-label">${t.localize("draggedRecord",{id:e.$.id})}</div>`),a.innerHTML=i,document.body.appendChild(a),a}_documentUpHandler(e){const t=this,a=t._dragDetails;if(t.$.scrollViewer._scrollView.disableSwipeScroll=!1,!a){let a=e.originalEvent.target;const i=t.$.header;if(t.shadowRoot&&a===t&&(a=e.originalEvent.composedPath()[0]),"none"!==t.headerPosition&&!t.$.headerDropDown.classList.contains("smart-visibility-hidden")&&!t.$.headerDropDown.classList.contains("search-panel")&&(a===i||!i.contains(a))){const e=a.closest("smart-scroll-viewer"),r=a.closest(".smart-drop-down");e&&i.contains(e.ownerElement)||r&&(!r.ownerElement||i.contains(r.ownerElement))||t.closePanel()}return}const i=a.card,r=a.record,l=a.hoveredCard;if(delete t._dragDetails,!t.hasAttribute("dragging"))return;const n=t.$.cardContainer.getElementsByClassName("dragged");if(Array.from(n).forEach(e=>e.classList.remove("dragged")),t.removeAttribute("dragging"),a.feedback.remove(),clearInterval(t._dragInterval),window.getSelection().removeAllRanges(),!l)return void t.$.fireEvent("dragEnd",{card:i,originalEvent:e,record:r});const d=t._visibleSource[l.dataId],o=t.$.fireEvent("dragEnd",{card:i,originalEvent:e,record:r,targetCard:l,targetRecord:d,targetSide:a.side});if(l.classList.remove("drop-target","left","right"),o.defaultPrevented)return;const s=t.dataSource;let c,m;for(let t=0;t<s.length;t++){const e=s[t];if(!e.isEmpty&&(e===r?c=t:e===d&&(m=t),null!=c&&null!=m))break}"right"===a.side&&m++,s.move(c,m),t._getVisibleRecords(),t._dataSourceProcessed=!0,t._partialRefresh(),delete t._dataSourceProcessed}});